import{l as e}from"./lodash-505a6f45.js";import{d as t,aV as l,o as n,c as o,F as a,D as i,B as s,i as r,a_ as u,g as d,b as p,bz as c,a8 as m,e as g,f,a as v,bG as y,a2 as h,t as b,u as x,bV as w,a3 as k,E as _,r as C,bd as B,m as z,ay as $,aZ as S,n as P,w as V,G as D,bO as U,at as A,bg as L,an as q,bH as I}from"./rewrite-2fee0426.js";import{_ as M}from"./_plugin-vue_export-helper-1b428a4d.js";import{g as j}from"./system-fdbbef6b.js";const F={class:"extra-btns f-sb-c"},E=s("div",{class:"f-1"},null,-1),H=t({__name:"ExtraBtns",props:{btns:{default:()=>[]},checked:{type:Boolean,default:!1}},emits:["click"],setup(t,{emit:s}){const y=t,h={add:{text:"新增",type:"success",icon:"CirclePlus"},delete:{text:"删除",type:"danger",icon:"Delete"},forbid:{text:"禁用",type:"info",icon:"Remove"},allow:{text:"启用",type:"success",icon:"CircleCheck"},import:{text:"导入",type:"primary",icon:"Upload",plain:!0,right:!0},export:{text:"导出",type:"primary",icon:"Download",plain:!0,right:!0},download:{text:"下载",type:"primary",icon:"Download",plain:!0,right:!0}},b=l([]),x=l([]);function w(e){s("click",e)}return y.btns.map((t=>("string"==typeof t&&(t={name:t}),(null==(t=e.merge({},h[null==t?void 0:t.name],t))?void 0:t.right)?x.push(t):b.push(t),t))),(e,t)=>{const l=r("BaseIcon"),s=r("el-button"),y=r("el-popconfirm"),h=u("auth");return n(),o("div",F,[(n(!0),o(a,null,i(b,((e,t)=>(n(),d(y,{title:null==e?void 0:e.poptitle,onConfirm:t=>w(e),width:160,disabled:!(null==e?void 0:e.poptitle),key:t},{reference:p((()=>[c((n(),d(s,{class:"f-0",onClick:t=>!(null==e?void 0:e.poptitle)&&w(e),type:null==e?void 0:e.type,size:null==e?void 0:e.size,plain:null==e?void 0:e.plain},m({default:p((()=>[g(" "+f((null==e?void 0:e.text)||"name错误"),1)])),_:2},[(null==e?void 0:e.icon)?{name:"icon",fn:p((()=>[v(l,{name:null==e?void 0:e.icon},null,8,["name"])])),key:"0"}:void 0]),1032,["onClick","type","size","plain"])),[[h,null==e?void 0:e.auth]])])),_:2},1032,["title","onConfirm","disabled"])))),128)),E,(n(!0),o(a,null,i(x,((e,t)=>(n(),d(y,{title:null==e?void 0:e.poptitle,onConfirm:t=>w(e),width:160,disabled:!(null==e?void 0:e.poptitle),key:t},{reference:p((()=>[c((n(),d(s,{class:"f-0",onClick:t=>!(null==e?void 0:e.poptitle)&&w(e),type:null==e?void 0:e.type,size:null==e?void 0:e.size,plain:null==e?void 0:e.plain},m({default:p((()=>[g(" "+f((null==e?void 0:e.text)||"name错误"),1)])),_:2},[(null==e?void 0:e.icon)?{name:"icon",fn:p((()=>[v(l,{name:null==e?void 0:e.icon},null,8,["name"])])),key:"0"}:void 0]),1032,["onClick","type","size","plain"])),[[h,null==e?void 0:e.auth]])])),_:2},1032,["title","onConfirm","disabled"])))),128))])}}}),R={class:"group-btns f-c-c"},T=t({__name:"GroupBtns",props:{btns:{default:()=>["edit","delete"]},maxNum:{default:3}},emits:["click"],setup(t,{emit:l}){const s=t,C=y(),B={edit:{text:"编辑",type:"success",icon:"Edit"},delete:{text:"删除",type:"danger",icon:"Delete",poptitle:"确定删除吗？"},forbid:{text:"禁用",type:"primary",icon:"Remove",poptitle:"确定禁用吗？"},allow:{text:"启用",type:"primary",icon:"CircleCheck",poptitle:!0},repeal:{text:"撤销",type:"primary",icon:"TopLeft"},download:{text:"下载",type:"primary",icon:"Download",plain:!0},view:{text:"查看",type:"primary",icon:"View",plain:!0}},{maxNum:z}=s,$=s.btns.length>z,S=h((()=>s.btns.map((t=>{const l=b(t);return"String"===l?t=e.merge({name:t},B[t]):"Object"===l&&(t=e.merge({},t,B[t.name])),!0===(null==t?void 0:t.poptitle)&&(t.poptitle=`确定${t.text}吗？`),t.poptitle&&(t.popWidth=9+t.text.length+"em"),t}))));function P(e){const{text:t,to:n}=e;n?C.push(n):l("click",e,(e=>{_.success(e||`${t||"操作"}成功！`)}))}return(e,t)=>{const l=r("BaseIcon"),s=r("el-button"),y=r("el-popconfirm"),h=r("el-dropdown-item"),b=r("el-dropdown-menu"),_=r("el-dropdown"),C=u("auth");return n(),o("div",R,[x(S).length?(n(),o(a,{key:0},[(n(!0),o(a,null,i(x(S).slice(0,$?x(z)-1:x(z)),((e,t)=>(n(),d(y,{title:null==e?void 0:e.poptitle,onConfirm:t=>P(e),width:null==e?void 0:e.popWidth,disabled:!(null==e?void 0:e.poptitle),key:t},{reference:p((()=>[c((n(),d(s,{plain:"",size:"small",type:null==e?void 0:e.type,onClick:t=>!(null==e?void 0:e.poptitle)&&P(e),text:""},m({default:p((()=>[g(" "+f((null==e?void 0:e.text)||"name错误"),1)])),_:2},[(null==e?void 0:e.icon)?{name:"icon",fn:p((()=>[v(l,{name:null==e?void 0:e.icon},null,8,["name"])])),key:"0"}:void 0]),1032,["type","onClick"])),[[C,null==e?void 0:e.auth]])])),_:2},1032,["title","onConfirm","width","disabled"])))),128)),$?(n(),d(_,{key:0,class:"ml-12",trigger:"click","hide-on-click":!1},{dropdown:p((()=>[v(b,null,{default:p((()=>[(n(!0),o(a,null,i(x(S).slice(x(z)-1),((e,t)=>(n(),d(h,{key:t},{default:p((()=>[v(y,{title:null==e?void 0:e.poptitle,onConfirm:t=>P(e),width:null==e?void 0:e.popWidth,disabled:!(null==e?void 0:e.poptitle)},{reference:p((()=>[c((n(),d(s,{plain:"",size:"small",type:null==e?void 0:e.type,onClick:t=>!(null==e?void 0:e.poptitle)&&P(e),text:""},m({default:p((()=>[g(" "+f((null==e?void 0:e.text)||"name错误"),1)])),_:2},[(null==e?void 0:e.icon)?{name:"icon",fn:p((()=>[v(l,{name:null==e?void 0:e.icon},null,8,["name"])])),key:"0"}:void 0]),1032,["type","onClick"])),[[C,null==e?void 0:e.auth]])])),_:2},1032,["title","onConfirm","width","disabled"])])),_:2},1024)))),128))])),_:1})])),default:p((()=>[v(s,{icon:x(w),type:"primary",size:"small",text:""},{default:p((()=>[g(" 更多 ")])),_:1},8,["icon"])])),_:1})):k("",!0)],64)):(n(),o(a,{key:1},[g("-")],64))])}}}),G=M(t({__name:"QueryTable",props:{loading:{type:Boolean},cols:{default:()=>[]},rows:{default:()=>[]},groupBtns:{type:[Array,Function],default:()=>[]},pagination:{type:Boolean,default:!0},total:{default:0},currPage:{default:1},pageSize:{default:10},pageAttrs:null,index:{type:Boolean},selection:{type:Boolean}},emits:["update:currPage","update:pageSize","selectionChange","groupBtn","change"],setup(t,{emit:s}){const m=t,g={align:"center",headerAlign:"center"},{cols:f,index:y,selection:w}=m,V=C([]),{currPage:D,pageSize:U,total:A}=B(m),L=C([]),q=l(e.merge({maxHeight:"calc(100% + 36px)"},{rowKey:"id",border:!0,tableLayout:"auto",highlightCurrentRow:!0})),I=l(e.merge({},{background:!0,layout:"total, sizes, prev, pager, next, jumper",pageSizes:[10,20,30,40,50]},m.pageAttrs)),M=h((()=>e=>"Function"===b(m.groupBtns)?m.groupBtns(e):m.groupBtns));y&&(f.slice(0,2).find((e=>"index"===e.type))||f.unshift({prop:"$order",label:"序号",type:"index",fixed:"left",width:58,index:e=>e+1+(m.currPage-1)*m.pageSize})),w&&(f.slice(0,2).find((e=>"selection"===e.type))||f.unshift({prop:"$selection",label:"选择",type:"selection",fixed:"left",width:58}));const j=l(f.map((t=>{const{type:l}=t;let n={};return"operate"===l&&(n={fixed:"right",width:200}),t=e.merge(n,g,t)})));const F=e=>{s("update:pageSize",e)},E=e=>{s("update:currPage",e)};function H(e){V.value.push(...e);const t=V.value.map((e=>e[q.rowKey]));s("selectionChange",e,t)}return(l,m)=>{const g=r("el-table-column"),f=r("el-switch"),y=r("BaseEmpty"),h=r("el-table"),b=r("el-pagination"),C=u("loading");return n(),o(a,null,[j.length?c((n(),d(h,z({key:0,class:"base-table-query",data:t.rows},q,{onSelectionChange:H}),{empty:p((()=>[v(y)])),default:p((()=>[(n(!0),o(a,null,i(j,((t,i)=>(n(),o(a,{key:i},[t.type?(n(),d(g,z({key:1},t,{"reserve-selection":x(w)}),{default:p((({row:o,column:a,$index:i})=>["operate"===t.type?(n(),d(T,{key:0,btns:x(M)(o),onClick:(e,l)=>function(e,{row:t,col:l,$index:n},o){const{name:a}=e;s("groupBtn",a,{$index:n,...t},((e,l)=>{if(["forbid","allow"].includes(a)&&e){const l=j.find((t=>t.prop===e));if(!l){const t="prop属性错误："+e;return void _.error(t)}const{activeValue:n=!0,inactiveValue:o=!1}=l.attrs||{};"forbid"===a?t[e]=o:"allow"===a&&(t[e]=n)}o&&o(l)}))}(e,{row:o,col:t,$index:i},l)},null,8,["btns","onClick"])):"switch"===t.type?(n(),d(f,z({key:1,onChange:l=>function({row:t,col:l,$index:n}){const{prop:o,attrs:a={}}=l,{activeValue:i=!0,inactiveValue:r=!1}=a,u=t[o];L.value.push(n),s("change",o,e.cloneDeep(t),(e=>{L.value=L.value.filter((e=>e!==n)),t[o]=u===r?i:r;const l=u===r?"启用":"禁用";_.success(e||`${l||"操作"}成功！`)}))}({row:o,col:t,$index:i}),modelValue:o[t.prop],loading:L.value.includes(i)},t.attrs),null,16,["onChange","modelValue","loading"])):"custom"===t.type?S(l.$slots,"custom",P(z({key:2},{row:o,col:t,ind:i})),void 0,!0):k("",!0)])),_:2},1040,["reserve-selection"])):(n(),d(g,z({key:0},t,{formatter:e=>e[t.prop]||"-","reserve-selection":x(w)}),null,16,["formatter","reserve-selection"]))],64)))),128))])),_:3},16,["data"])),[[C,t.loading]]):k("",!0),t.pagination?(n(),d(b,z({key:1,class:"f-c-c mt-h f-0"},I,{"current-page":x(D),"onUpdate:currentPage":m[0]||(m[0]=e=>$(D)?D.value=e:null),"page-size":x(U),"onUpdate:pageSize":m[1]||(m[1]=e=>$(U)?U.value=e:null),total:x(A),onSizeChange:F,onCurrentChange:E,"hide-on-single-page":""}),null,16,["current-page","page-size","total"])):k("",!0)],64)}}}),[["__scopeId","data-v-51d24b89"]]),W=M(t({__name:"QueryForm",props:{fields:{default:()=>[]},loading:{type:Boolean,default:!1},extraParams:null},emits:["search","change"],setup(t,{emit:s}){const m=t,{extraParams:y}=m,b=A("colNum"),w=C(!0),_=C(),B=h((()=>{const e=m.fields.length,t=24/b.value;return e>b.value-1&&w.value?t:(b.value-e%b.value)*t})),$=h((()=>j(m.fields))),P=l(e.merge({labelWidth:$.value+"em"},{})),L=l(function(){const e={};return m.fields.forEach((t=>{const{prop:l,value:n}=t;e[l]=n})),e}());V(L,(e=>{s("change",e)}),{deep:!0});const q=()=>{s("search",e.merge({},y,L))},I=()=>{const e=_.value;e&&e.resetFields()};return(e,l)=>{const s=r("BaseFormItem"),m=r("el-col"),y=r("BaseIcon"),h=r("el-button"),C=r("el-row"),$=r("el-form"),V=u("debounce");return t.fields.length?(n(),d($,z({key:0,class:"base-form-query",model:L},P,{ref_key:"formRef",ref:_}),{default:p((()=>[v(C,null,{default:p((()=>[(n(!0),o(a,null,i(t.fields.slice(0,w.value?x(b)-1:void 0),((t,l)=>(n(),d(m,{span:24/x(b),key:l},{default:p((()=>[v(s,{style:{width:"100%"},field:t,modelValue:L[t.prop],"onUpdate:modelValue":e=>L[t.prop]=e},{custom:p((({field:t})=>[S(e.$slots,"custom",{field:t},void 0,!0)])),_:2},1032,["field","modelValue","onUpdate:modelValue"])])),_:2},1032,["span"])))),128)),v(m,{span:x(B),class:D(["f-fe-fs",24===x(B)?"mb-20":""])},{default:p((()=>[c((n(),d(h,{type:"primary",disabled:t.loading},{icon:p((()=>[v(y,{class:D({rotate:t.loading}),name:t.loading?"Loading":"Search"},null,8,["class","name"])])),default:p((()=>[g("搜索")])),_:1},8,["disabled"])),[[V,q,void 0,{immediate:!0}]]),v(h,{icon:x(U),onClick:I,disabled:t.loading},{default:p((()=>[g("重置")])),_:1},8,["icon","disabled"]),t.fields.length>x(b)-1?(n(),d(h,{key:0,onClick:l[0]||(l[0]=e=>w.value=!w.value),text:"",type:"primary"},{icon:p((()=>[v(y,{name:"ArrowDown",class:D({"rotate-180":!w.value})},null,8,["class"])])),default:p((()=>[g(" "+f(w.value?"展开":"折叠"),1)])),_:1})):k("",!0)])),_:1},8,["span","class"])])),_:3})])),_:3},16,["model"])):k("",!0)}}}),[["__scopeId","data-v-8d77c4d3"]]),N={class:"base-crud f-fs-s-c"},K=M(t({__name:"BaseCrud",props:{formAttrs:null,tableAttrs:null,fields:{default:()=>[]},cols:{default:()=>[]},request:null,immediate:{type:Boolean,default:!0},extraBtns:{default:()=>[]},groupBtns:null,reqMap:null,resMap:null,index:{type:Boolean},selection:{type:Boolean},exportLimit:{default:1e4},extraParams:null},emits:["extraBtn","groupBtn","selectionChange","tableChange"],setup(t,{emit:a}){const i=t,s="#ff5000",r={currPage:"currPage",pageSize:"pageSize"},u={currPage:"currPage",pageSize:"pageSize",total:"total",list:"list"},{pagination:c=!0}=L(),{immediate:m,reqMap:g=r,resMap:f=u,exportLimit:y,request:b,extraParams:w}=i,B={[`${g.currPage}`]:1,[`${g.pageSize}`]:20},$=l(e.cloneDeep(B)),D=C(!1),U=C([]),A=C([]),M=C([]);let j=l(e.cloneDeep(B)),F=C(0);const E=h((()=>e=>{const t=i.cols.find((t=>t.prop===e));return t&&"custom"===t.type?"form-"+e:e}));function R(){e.merge($,B),j=e.cloneDeep(B),O(j)}function T(t){j=e.merge({},j,{[`${g.currPage}`]:1}),O(j)}function K(t){j=e.merge(j,t)}function O(t=e.cloneDeep(B),l){b?(D.value=!0,t=e.pickBy(e.merge(t,w)),b(t).then((e=>{c?(F.value=e[f.total],U.value=e[f.list]):U.value=e,l&&l()})).finally((()=>{D.value=!1}))):_.error("请传入request参数！")}function Q(e){const{name:t,text:l}=e;if(["delete","export"].includes(t))if(A.value.length)I.confirm(`确定 <b style="color:${s};">${l}</b> 共 <b style="color:${s};">${A.value.length}</b> 条记录？`,"温馨提示",{type:"delete"===t?"error":"warning",dangerouslyUseHTMLString:!0}).then((()=>{a("extraBtn",t,M.value,(e=>{_.success(e||`${l}成功！`)}))})).catch((()=>{}));else{if("export"===t&&F.value>y)return void _.warning({message:`一次性${l}数据不能超过 <b>${y}</b> 条，请缩小查询范围！`,dangerouslyUseHTMLString:!0});I.confirm(`确定 <b style="color:${s};">全部${l}</b> ？ 共 <b style="color:${s};">${F.value}</b> 条记录。`,"温馨提示",{type:"delete"===t?"error":"warning",dangerouslyUseHTMLString:!0}).then((()=>{a("extraBtn",t,[],(e=>{_.success(e||`${l}成功！`)}))})).catch((()=>{}))}else a("extraBtn",t)}function Z(e,t,l){a("groupBtn",e,t,((e,t)=>{e?l&&l(e,t):O(j,l)}))}function J(e,t){A.value=e,M.value=t,a("selectionChange",e,t)}function X(e,t,l){a("tableChange",e,t,((e,t)=>{l&&l(t)}))}return V($,(t=>{O(e.merge({},j,t))}),{immediate:m,deep:!0}),(e,l)=>(n(),o("div",N,[v(W,z({class:"f-0"},t.formAttrs,{fields:t.fields,loading:D.value,onReset:R,onSearch:T,onChange:K}),{custom:p((({field:t})=>[S(e.$slots,x(E)(t.prop),{field:t},void 0,!0)])),_:3},16,["fields","loading"]),S(e.$slots,"default",{},void 0,!0),t.extraBtns.length?(n(),d(H,{key:0,class:"mb-h f-0",btns:t.extraBtns,onClick:Q},null,8,["btns"])):k("",!0),v(G,z(t.tableAttrs,{loading:D.value,cols:t.cols,rows:U.value,total:x(F),index:t.index,selection:t.selection,groupBtns:t.groupBtns,onGroupBtn:Z,onSelectionChange:J,onChange:X,currPage:$[x(g).currPage],"onUpdate:currPage":l[0]||(l[0]=e=>$[x(g).currPage]=e),pageSize:$[x(g).pageSize],"onUpdate:pageSize":l[1]||(l[1]=e=>$[x(g).pageSize]=e)}),{custom:p((({row:t,col:l,ind:n})=>[S(e.$slots,l.prop,P(q({row:t,col:l,ind:n})),void 0,!0)])),_:3},16,["loading","cols","rows","total","index","selection","groupBtns","currPage","pageSize"])]))}}),[["__scopeId","data-v-806748de"]]);export{K as default};

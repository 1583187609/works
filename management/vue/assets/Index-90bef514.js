import{M as se,ak as te,aK as le,c7 as ae,bd as oe,aM as b,q as C,bs as M,bL as ne,cA as re,s as S,bx as z,am as F,bA as ue,t as $,cp as E,aR as ie,aE as d,u as p,F as V,aP as _,v as R,b3 as me,bc as P,aQ as Q,aq as j,I as de,c8 as D,bN as ce,bH as fe}from"./index-346f95fe.js";import K from"./QueryFields-7db98284.js";import{_ as O}from"./QueryBtns.vue_vue_type_script_setup_true_lang-42b46820.js";import{h as U}from"./_utils-e1c645e6.js";import{d as ve}from"./_config-c76f4e31.js";const pe={class:"f-fs-fs"},ge={class:"sec-label f-0"},he={class:"sec-fields f-fs-fs-w f-1"};var T,W,G;const be=se({__name:"Index",props:te({modelValue:{},fields:{},sections:{},loading:{type:Boolean},rowNum:{},extraParams:{},inputDebounce:{type:Boolean},colSpanAttrs:{},isCompact:{type:Boolean},noFieldsHide:{type:Boolean}},Object.assign({rowNum:2,fields:()=>[],modelValue:()=>le({}),noFieldsHide:!0},(G=(W=(T=ae)==null?void 0:T.BaseCrud)==null?void 0:W._components)==null?void 0:G.QueryForm)),emits:["update:modelValue","search","change","reset"],setup(J,{expose:X,emit:Y}){const n=J,v=Y;let y=!0;const B=oe(),w=b(),c=b(2),i=b(!0),g=b([]),u=b([]),f=B.size==="small",N=C(()=>{if(!i.value)return;const{sections:e,rowNum:s}=n;return e?l=>{const t=u.value.length,a=l===t-1;return t<=s?c.value>1?c.value-(a?1:0):1:c.value-(l===s-1?1:0)}:c.value>1?c.value*s-1:1*s}),x=C(()=>{const{sections:e,rowNum:s}=n;if(e){const l=u.value.map((a,o)=>{const m=o===u.value.length-1;return a.fields.length<=c.value-(m?1:0)?1:2});let t=0;for(let a=0;a<l.length;a++)if(t+=l[a],t>s)return!0;return!1}else return g.value.length>c.value*s-1}),r=C({get(){return n.modelValue},set(e){v("update:modelValue",e)}});M(()=>n.fields,e=>{var o;if((o=n.sections)!=null&&o.length)return;const{modelValue:s}=n,l=U(e,void 0,s),{data:t,fields:a}=l;g.value=a,D.merge(r.value,t),v("change",r.value,y?!!s:!1),y=!1},{immediate:!0,deep:!0}),M(()=>n.sections,e=>{if(!e)return;const{modelValue:s}=n;u.value=(e==null?void 0:e.map(l=>{const{label:t,fields:a}=l,o=U(a,void 0,s),{data:m,fields:A}=o;return l.fields=A,D.merge(r.value,m),l}))??[],v("change",r.value,y?!!s:!1),y=!1},{immediate:!0,deep:!0}),ne("resize",()=>c.value=I(),!0);function q(){return i.value?(c.value>1?n.rowNum:n.rowNum+1)*(f?28:40)+"px":"35vh"}function Z(){const{fields:e,isCompact:s,sections:l}=n;let t=1;if(l){const a=l.map((o,m)=>E(o.fields,f?.5:s?1:void 0));t=Math.max(...a)}else t=E(e,f?.5:s?1:void 0);return Object.assign({labelWidth:t+"em"},ve)}function I(){const{colSpanAttrs:e}=n,s={},l=re();for(const t in e)s[t]=24/e[t];return s[l]}function H(e){const{colSpanAttrs:s}=n,{span:l,type:t}=e;return l?{span:l}:s}function k(){const e=w.value;e&&e.validate((s,l)=>{if(s){const{extraParams:t}=n;v("search",D.merge({},t,r.value))}else{const t=Object.values(l)[0][0];ce.error(t.message)}})}function L(){var e;(e=w.value)==null||e.resetFields(),v("reset")}return X({formRef:w,getFields(){var e;return(e=n.sections)!=null&&e.length?u.value.map(s=>s.fields).flat(1):g.value}}),(e,s)=>{const l=ie("el-form");return!e.noFieldsHide||g.value.length||u.value.length?(d(),S(l,F({key:0,class:["query-form",{compact:e.isCompact,small:f}],model:r.value},Z(),{onKeyup:ue(k,["enter"]),ref_key:"formRef",ref:w}),{default:z(()=>[u.value.length?(d(),p("div",{key:0,class:"all-hide-scroll wrap-box",style:j({maxHeight:q()})},[(d(!0),p(V,null,_(u.value.slice(0,i.value?e.rowNum:void 0),(t,a)=>{var o;return d(),p("div",pe,[R("div",ge,me(t.label),1),R("div",he,[(d(!0),p(V,null,_(t.fields.slice(0,(o=N.value)==null?void 0:o.call(N,a)),(m,A)=>(d(),S(K,F({modelValue:r.value,"onUpdate:modelValue":s[0]||(s[0]=h=>r.value=h),field:m,className:f?"mb-qtr":"mb-half",inputDebounce:e.inputDebounce,size:P(B).size,onChange:s[1]||(s[1]=(h,ee)=>v("change",{[h]:ee}))},H(m),{key:A}),{custom:z(({field:h})=>[Q(e.$slots,"custom",{field:h,form:r.value},void 0,!0)]),_:2},1040,["modelValue","field","className","inputDebounce","size"]))),128)),(u.value.length<=e.rowNum?a===u.value.length-1:i.value?a===e.rowNum-1:a===u.value.length-1)?(d(),S(O,F({key:0},e.colSpanAttrs,{class:[f?"mb-qtr":"mb-half","fold-col"],small:f,loading:e.loading,isFold:i.value,showFoldBtn:x.value,onSubmit:k,onFold:s[2]||(s[2]=m=>i.value=!i.value),onReset:L}),null,16,["class","loading","isFold","showFoldBtn"])):$("",!0)])])}),256))],4)):(d(),p("div",{key:1,class:"f-fs-fs-w wrap-box all-hide-scroll",style:j({maxHeight:q()})},[(d(!0),p(V,null,_(g.value.slice(0,N.value),(t,a)=>(d(),S(K,F({modelValue:r.value,"onUpdate:modelValue":s[3]||(s[3]=o=>r.value=o),field:t,className:f?"mb-qtr":"mb-half",inputDebounce:e.inputDebounce,size:P(B).size,onChange:s[4]||(s[4]=(o,m)=>v("change",{[o]:m}))},H(t),{key:a}),{custom:z(({field:o})=>[Q(e.$slots,"custom",{field:o,form:r.value},void 0,!0)]),_:2},1040,["modelValue","field","className","inputDebounce","size"]))),128)),de(O,F(e.colSpanAttrs,{class:[f?"mb-qtr":"mb-half","fold-col"],loading:e.loading,isFold:i.value,showFoldBtn:x.value,onSubmit:k,onFold:s[5]||(s[5]=t=>i.value=!i.value),onReset:L}),null,16,["class","loading","isFold","showFoldBtn"])],4))]),_:3},16,["class","model"])):$("",!0)}}});const Be=fe(be,[["__scopeId","data-v-2c3a3a55"]]);export{Be as default};

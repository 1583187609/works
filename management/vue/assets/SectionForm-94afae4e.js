import{M as Q,aK as H,c4 as Z,aM as B,q as R,c3 as k,bZ as T,cp as N,bs as G,aR as F,aE as n,s as d,bx as S,v as h,ao as O,u as y,F as $,aP as A,b3 as J,ap as X,am as L,bc as M,ck as Y,ci as I,t as V,aQ as x,aq as ee,bA as oe,bH as te}from"./index-0bf49a0e.js";import{h as U}from"./_utils-9ecd71f9.js";import ae from"./FooterBtns-fc0c5450.js";import{d as se}from"./_config-c76f4e31.js";import"./index-2f1ff7f6.js";const le=["onClick"],re={class:"title f-fs-c"},ne={class:"line-1"},ue={key:1,class:"f-c-c pb-o"},pe=Q({__name:"SectionForm",props:{modelValue:{default:()=>H({})},sections:{default:()=>[]},pureText:{type:Boolean},foldable:{type:Boolean,default:!0},fetch:{},fetchSuccess:{},fetchFail:{},footer:{type:Boolean,default:!0},span:{default:24},submitText:{},resetText:{},extraParams:{},moreBtns:{},loading:{type:Boolean},isOmit:{type:Boolean,default:!0},log:{type:Boolean,default:!Z},debug:{type:Boolean},autoFixedFoot:{type:Boolean,default:!0},noSubmitProps:{},labelWidthBySection:{type:Boolean,default:!0},handleReq:{}},emits:["update:modelValue","submit","change","moreBtns"],setup(z,{expose:E,emit:W}){const c=z,i=W,C=B(null),m=B([]),_=B(),j=R(()=>{const e=Math.max(...c.sections.map((a,p)=>{var f;if(k(a)!=="Object")return 0;const l=a,{fold:v=!1}=l;return m.value[p]=v,(f=l.fields)==null||f.map(o=>{if(k(o)!=="Object")return o;const r=o;return r.attrs=T.merge({},l.attrs,r.attrs),r}),N(l==null?void 0:l.fields)}));return T.merge({labelWidth:e+"em"},se)}),g=B([]),u=R({get(){return c.modelValue},set(e){i("update:modelValue",e)}}),q=R(()=>T.merge({},u.value,c.extraParams));G(()=>c.sections,e=>{const{modelValue:a,labelWidthBySection:p}=c;g.value=e.filter(l=>{if(k(l)!=="Object")return!1;const{type:v,prop:f,fields:o,fieldAttrs:r}=l;if(k(f)!=="Undefined"){const t=a==null?void 0:a[f];u.value[f]=v==="custom"?t:U(o,i,t).data}else{const t=U(o,i,a,r);let{data:P,fields:s}=t;if(T.merge(u.value,P),p){const b=N(o);s=s.map((w,ie)=>(w.labelWidth=b+"em",w))}l.fields=s}return!0})},{immediate:!0,deep:!0});function K(e,a){var p,l;(l=(p=e.target)==null?void 0:p.classList)!=null&&l.contains("head")&&(m.value[a]=!m.value[a])}function D(){c.fetch?C.value.submit():i("submit",q.value)}return E({formRef:_,formValidate(){return C.value.formValidate()}}),(e,a)=>{const p=F("BaseIcon"),l=F("el-popover"),v=F("BaseFormItem"),f=F("el-form");return n(),d(f,L({class:"section-form f-fs-s-c",model:u.value},j.value,{onKeyup:oe(D,["enter"]),ref_key:"formRef",ref:_}),{default:S(()=>[h("div",{class:O(["all-hide-scroll f-fs-s-w",{"auto-fixed-foot":e.autoFixedFoot}])},[g.value.length?(n(!0),y($,{key:0},A(g.value,(o,r)=>(n(),y("section",{class:O(["section",{[`f-span-${o.span??24}`]:!0}]),key:r},[h("div",{onClick:t=>K(t,r),class:"head f-sb-c"},[h("div",re,[h("span",ne,J(o.title),1),o.popover?(n(),d(l,X(L({key:0},M(Y)(o.popover))),{reference:S(()=>[o.popover?(n(),d(p,{key:0,color:M(I).colorInfo,class:"ml-q",name:"QuestionFilled"},null,8,["color"])):V("",!0)]),_:2},1040)):V("",!0)]),x(e.$slots,"right-"+(o.prop??r),{},void 0,!0),e.foldable?(n(),d(p,{key:0,onClick:t=>m.value[r]=!m.value[r],class:O(["fold-btn f-0",m.value[r]?"rotate-180":""]),size:"1.5em",name:"CaretTop"},null,8,["onClick","class"])):V("",!0)],8,le),h("div",{class:"body f-fs-fs-w",style:ee({"max-height":m.value[r]?"0":"100vh"})},[o.type==="custom"?x(e.$slots,o.prop,{key:0,form:u.value},void 0,!0):(n(!0),y($,{key:1},A(o.fields,(t,P)=>(n(),y($,{key:t.key||P},[o.prop?(n(),d(v,{key:0,className:`f-span-${t.span||e.span}`,field:t,pureText:t.pureText||o.pureText||e.pureText,modelValue:u.value[o.prop][t.prop],"onUpdate:modelValue":s=>u.value[o.prop][t.prop]=s,onChange:a[0]||(a[0]=(s,b)=>i("change",s,b))},{custom:S(({field:s})=>[x(e.$slots,s.prop,{field:s,form:u.value},void 0,!0)]),_:2},1032,["className","field","pureText","modelValue","onUpdate:modelValue"])):(n(),d(v,{key:1,className:`f-span-${t.span||e.span}`,field:t,pureText:t.pureText||o.pureText||e.pureText,modelValue:u.value[t.prop],"onUpdate:modelValue":s=>u.value[t.prop]=s,onChange:a[1]||(a[1]=(s,b)=>i("change",s,b))},{custom:S(({field:s})=>[x(e.$slots,s.prop,{field:s,form:u.value},void 0,!0)]),_:2},1032,["className","field","pureText","modelValue","onUpdate:modelValue"]))],64))),128))],4)],2))),128)):(n(),y("div",ue,"空空如也~"))],2),!e.pureText&&e.footer?(n(),d(ae,{key:0,loading:e.loading,moreBtns:e.moreBtns,submitText:e.submitText,resetText:e.resetText,formRef:_.value,isOmit:e.isOmit,log:e.log,debug:e.debug,params:q.value,fetch:e.fetch,fetchSuccess:e.fetchSuccess,fetchFail:e.fetchFail,noSubmitProps:e.noSubmitProps,handleReq:e.handleReq,disabled:!g.value.length,onMoreBtns:a[2]||(a[2]=(o,r,t)=>i("moreBtns",o,r,t)),onSubmit:a[3]||(a[3]=o=>i("submit",o)),ref_key:"footerBtnsRef",ref:C},null,8,["loading","moreBtns","submitText","resetText","formRef","isOmit","log","debug","params","fetch","fetchSuccess","fetchFail","noSubmitProps","handleReq","disabled"])):V("",!0)]),_:3},16,["model"])}}});const be=te(pe,[["__scopeId","data-v-1b59c48f"]]);export{be as default};

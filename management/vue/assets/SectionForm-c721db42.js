import{a9 as Q}from"./index-79ac556c.js";import{t as B,l as k,f as G}from"./common-f4827de9.js";import{i as H,a as q,d as J}from"./system-a8d5b9ab.js";import{h as z}from"./_utils-eb832563.js";import{F as X}from"./FooterBtns-f1b9b194.js";import{q as Y,O as Z,r as T,e as R,w as I,a6 as F,t as n,D as d,E as S,x as h,z as O,v as g,F as $,a0 as A,K as ee,a3 as oe,V as L,u as U,I as V,y as x,A as te}from"./runtime-core.esm-bundler-95bf9971.js";import{_ as ae}from"./_plugin-vue_export-helper-c27b6911.js";const se=["onClick"],re={class:"title f-fs-c"},le={class:"line-1"},ne={key:1,class:"f-c-c pb-o"},ue=Y({__name:"SectionForm",props:{modelValue:{default:()=>Z({})},sections:{default:()=>[]},pureText:{type:Boolean},foldable:{type:Boolean,default:!0},fetch:{},fetchSuccess:{},fetchFail:{},footer:{type:Boolean,default:!0},span:{default:24},submitText:{},resetText:{},extraParams:{},moreBtns:{},loading:{type:Boolean},isOmit:{type:Boolean,default:!0},log:{type:Boolean,default:!H},debug:{type:Boolean},autoFixedFoot:{type:Boolean,default:!0},noSubmitProps:{},labelWidthBySection:{type:Boolean,default:!0},handleReq:{}},emits:["update:modelValue","submit","change","moreBtns"],setup(W,{expose:j,emit:D}){const E={},v=W,i=D,w=T(null),f=T([]),C=T(),K=R(()=>{const e=Math.max(...v.sections.map((t,p)=>{var m;if(B(t)!=="Object")return 0;const r=t,{fold:c=!1}=r;return f.value[p]=c,(m=r.fields)==null||m.map(o=>{if(B(o)!=="Object")return o;const l=o;return l.attrs=k.merge({},r.attrs,l.attrs),l}),q(r==null?void 0:r.fields)}));return k.merge({labelWidth:e+"em"},E)}),b=T([]),u=R({get(){return v.modelValue},set(e){i("update:modelValue",e)}}),_=R(()=>k.merge({},u.value,v.extraParams));I(()=>v.sections,e=>{const{modelValue:t,labelWidthBySection:p}=v;b.value=e.filter(r=>{if(B(r)!=="Object")return!1;const{type:c,prop:m,fields:o,fieldAttrs:l}=r;if(B(m)!=="Undefined"){const a=t==null?void 0:t[m];u.value[m]=c==="custom"?a:z(o,i,a).data}else{const a=z(o,i,t,l);let{data:P,fields:s}=a;if(k.merge(u.value,P),p){const y=q(o);s=s.map((N,pe)=>(N.labelWidth=y+"em",N))}r.fields=s}return!0})},{immediate:!0,deep:!0});function M(e,t){var p,r;(r=(p=e.target)==null?void 0:p.classList)!=null&&r.contains("head")&&(f.value[t]=!f.value[t])}return j({formRef:C,formValidate(){return w.value.formValidate()}}),(e,t)=>{const p=F("BaseIcon"),r=F("el-popover"),c=F("BaseFormItem"),m=F("el-form");return n(),d(m,L({class:"section-form f-fs-s-c",model:u.value},K.value,{onKeyup:t[4]||(t[4]=Q(o=>i("submit",_.value),["enter"])),ref_key:"formRef",ref:C}),{default:S(()=>[h("div",{class:O(["all-hide-scroll f-fs-s-w",{"auto-fixed-foot":e.autoFixedFoot}])},[b.value.length?(n(!0),g($,{key:0},A(b.value,(o,l)=>(n(),g("section",{class:O(["section",{[`f-span-${o.span??24}`]:!0}]),key:l},[h("div",{onClick:a=>M(a,l),class:"head f-sb-c"},[h("div",re,[h("span",le,ee(o.title),1),o.popover?(n(),d(r,oe(L({key:0},U(J)(o.popover))),{reference:S(()=>[o.popover?(n(),d(p,{key:0,color:U(G).colorInfo,class:"icon-popover",name:"QuestionFilled"},null,8,["color"])):V("",!0)]),_:2},1040)):V("",!0)]),x(e.$slots,"right-"+(o.prop??l),{},void 0,!0),e.foldable?(n(),d(p,{key:0,onClick:a=>f.value[l]=!f.value[l],class:O(["fold-btn f-0",f.value[l]?"rotate-180":""]),size:"1.5em",name:"CaretTop"},null,8,["onClick","class"])):V("",!0)],8,se),h("div",{class:"body f-fs-fs-w",style:te({"max-height":f.value[l]?"0":"100vh"})},[o.type==="custom"?x(e.$slots,o.prop,{key:0,form:u.value},void 0,!0):(n(!0),g($,{key:1},A(o.fields,(a,P)=>(n(),g($,{key:a.key||P},[o.prop?(n(),d(c,{key:0,className:`f-span-${a.span||e.span}`,field:a,pureText:a.pureText||o.pureText||e.pureText,modelValue:u.value[o.prop][a.prop],"onUpdate:modelValue":s=>u.value[o.prop][a.prop]=s,onChange:t[0]||(t[0]=(s,y)=>i("change",s,y))},{custom:S(({field:s})=>[x(e.$slots,s.prop,{field:s,form:u.value},void 0,!0)]),_:2},1032,["className","field","pureText","modelValue","onUpdate:modelValue"])):(n(),d(c,{key:1,className:`f-span-${a.span||e.span}`,field:a,pureText:a.pureText||o.pureText||e.pureText,modelValue:u.value[a.prop],"onUpdate:modelValue":s=>u.value[a.prop]=s,onChange:t[1]||(t[1]=(s,y)=>i("change",s,y))},{custom:S(({field:s})=>[x(e.$slots,s.prop,{field:s,form:u.value},void 0,!0)]),_:2},1032,["className","field","pureText","modelValue","onUpdate:modelValue"]))],64))),128))],4)],2))),128)):(n(),g("div",ne,"空空如也~"))],2),!e.pureText&&e.footer?(n(),d(X,{key:0,loading:e.loading,moreBtns:e.moreBtns,submitText:e.submitText,resetText:e.resetText,formRef:C.value,isOmit:e.isOmit,log:e.log,debug:e.debug,params:_.value,fetch:e.fetch,fetchSuccess:e.fetchSuccess,fetchFail:e.fetchFail,noSubmitProps:e.noSubmitProps,handleReq:e.handleReq,disabled:!b.value.length,onMoreBtns:t[2]||(t[2]=o=>i("moreBtns",o,_.value)),onSubmit:t[3]||(t[3]=o=>i("submit",o)),ref_key:"footerBtnsRef",ref:w},null,8,["loading","moreBtns","submitText","resetText","formRef","isOmit","log","debug","params","fetch","fetchSuccess","fetchFail","noSubmitProps","handleReq","disabled"])):V("",!0)]),_:3},16,["model"])}}});const he=ae(ue,[["__scopeId","data-v-2ec6d434"]]);export{he as S};

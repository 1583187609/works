import{c0 as e,bJ as a,bO as t,bK as s,c1 as o,bP as l,M as n,aa as r,bI as u,aM as c,aK as p,q as i,aR as d,aE as m,u as f,v,b3 as b,bc as h,I as _,bx as g,af as y,H as I,c2 as k,bH as w}from"./index-31bd5f7b.js";import{a as x,b as M,G as S}from"./user-3e3a0c56.js";import{_ as j}from"./FindPassword.vue_vue_type_script_setup_true_lang-461422bc.js";import{_ as V}from"./Register.vue_vue_type_script_setup_true_lang-0b076c05.js";import q from"./Captcha-e62da067.js";import{p as C}from"./package-3a4aa718.js";const P=e("user",(()=>{const e=a(),n=t();return{login:async function(a){const{user:t,navs:r}=a;return x(a).then((async a=>{var u;s.setItem("token",(null==t?void 0:t.token)??""),s.setItem("userInfo",t),s.setItem("allNavs",r.filter((e=>!["monitor","demo"].includes(e.path)))),await n.initMap(),e.push("/"),o({type:"success",title:"登录成功",duration:2e3,dangerouslyUseHTMLString:!0,message:`欢迎回来，<b>${null==(u=l(t))?void 0:u._title}</b>`})}))},logout:async function(a=e.currentRoute.value.fullPath){M().then((()=>{s.removeItem("token"),s.removeItem("userInfo"),s.removeItem("allNavs"),n.clearMap()}))}}})),R={class:"wrap f-c-c"},H={class:"bounce-in login-box"},L={class:"head f-c-c"},U={class:"foot f-sb-c"},z=w(n({__name:"index",setup(e){const n=r("openPopup");P();const w=t(),M=a(),z=u(),T=c(!1),A=c([]),F=s.getItem("store_account");let K=p({phone:(null==F?void 0:F.phone)??"superAdmin_1",psd:(null==F?void 0:F.psd)??"superAdmin123456",captcha:"",remember:!!F});const N=i((()=>[{prop:"phone",label:"账号",valid:/^\d/.test(K.phone)?"phone":void 0,required:!0,type:"autocomplete",attrs:{placeholder:"请输入账号 / 手机号",autocomplete:"off",onSelect:B,fetchSuggestions:$}},{prop:"psd",label:"密码",valid:"password",required:!0,attrs:{type:"password",autocomplete:"off"}},{prop:"captcha",label:"验证码",type:"custom",required:!0},{prop:"remember",label:"记住我",type:"checkbox"}]));function O(e){const{remember:a,...t}=e;T.value=!0,a?s.setItem("store_account",{phone:t.phone,psd:t.psd}):s.removeItem("store_account"),x(t).then((e=>{var a;k(e),w.initMap();const t=(null==(a=z.query.redirect)?void 0:a.toString())??"/";M.push(t),o({type:"success",title:"登录成功",duration:2e3,dangerouslyUseHTMLString:!0,message:`欢迎回来，<b>${l()._title}</b>`})})).finally((()=>{T.value=!1}))}function $(e,a){let t=A.value;e&&(t=A.value.filter((e=>a=>0===a.value.toLowerCase().indexOf(e.toLowerCase())))),a(t)}function B(e){K.psd=e.psd}return S().then((e=>{A.value=e.map((e=>{const{account:a,...t}=e;return{value:a,...t}}))})),(e,a)=>{const t=d("BaseForm"),s=d("el-button");return m(),f("div",R,[v("div",H,[v("h1",L,b(h(C).name),1),_(t,{class:"body",modelValue:h(K),"onUpdate:modelValue":a[1]||(a[1]=e=>y(K)?K.value=e:K=e),size:"large",loading:T.value,fields:N.value,onSubmit:O,submitText:"登录",ref:"formRef"},{captcha:g((()=>[_(q,{modelValue:h(K).captcha,"onUpdate:modelValue":a[0]||(a[0]=e=>h(K).captcha=e),prop:"captcha"},null,8,["modelValue"])])),_:1},8,["modelValue","loading","fields"]),v("div",U,[_(s,{onClick:a[2]||(a[2]=e=>h(n)({title:"免费注册",direction:"ltr"},V,"drawer")),class:"btn",type:"info",size:"small",link:""},{default:g((()=>[I(" 免费注册 ")])),_:1}),_(s,{onClick:a[3]||(a[3]=e=>h(n)("找回密码",j,"drawer")),class:"btn",type:"info",size:"small",link:""},{default:g((()=>[I(" 找回密码 ")])),_:1})])])])}}}),[["__scopeId","data-v-fd3dc40f"]]);export{z as default};

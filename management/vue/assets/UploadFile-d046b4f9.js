import{M as k,ak as B,aK as I,c7 as U,co as E,cq as L,cn as M,aM as R,aR as d,aE as j,u as N,I as p,bx as g,H as D,ao as H,bc as h,bK as K,bN as y,bH as O}from"./index-346f95fe.js";const P={class:"upload-file f-fs-c"};var v;const q=k({__name:"UploadFile",props:B({modelValue:{},size:{},showFileList:{type:Boolean},drag:{type:Boolean},accept:{},limitSize:{},action:{},showTips:{type:Boolean},handleSuccessRes:{type:Function}},Object.assign({modelValue:()=>I({name:"",url:""}),size:80,showFileList:!1,limitSize:1024*1024*10,action:"/proxy/common/uploadImage",showTips:!0,handleSuccessRes:i=>i.path},(v=U)==null?void 0:v.BaseCrud)),emits:["update:modelValue","change"],setup(i,{emit:z}){const l=i,r=z,{formItem:u}=E(),{value:S}=L();M(l.size);const n=R(l.modelValue||{url:"",name:""});computed(()=>{const{accept:e,limitSize:s}=l,t=m(e),o=f(s);return`仅支持${t}，不超过${o}`});const V=e=>{const{limitSize:s,accept:t}=l,{type:o,size:c}=e,a=T(t,o)||C(s,c);return a?(y.error(a),!1):!0},F=e=>{console.log(e,"onProgress--------------------")},x=(e,s)=>{const{code:t,message:o,data:c}=e;if(t===1e3){const a=l.handleSuccessRes(c),$=s.name.lastIndexOf("."),_=s.name.slice(0,$),b={url:a,name:_};n.value={url:a,name:_},console.log(b),r("update:modelValue",b),u==null||u.validate("blur"),r("change",n)}else y.error(o)},w=e=>{};function m(e){return e.split(",").map(t=>t.split("/")[1]).join("，")}function f(e){let s=e/1024,t="";return s<1024?t=`${s.toFixed(1)}kb`:(s=s/1024,t=`${s.toFixed(1)}Mb`),t}function T(e,s){let t="";return e&&(e.split(",").includes(s)||(t=`仅支持上传${m(e)}格式的文件`)),t}function C(e,s){return s>e?`文件大小不能超过${f(e)}`:""}return(e,s)=>{const t=d("el-input"),o=d("el-button"),c=d("el-upload");return j(),N("div",P,[p(t,{placeholder:"请点击右侧按钮选择文件",clearable:"",modelValue:n.value.name,"onUpdate:modelValue":s[0]||(s[0]=a=>n.value.name=a),disabled:!n.value.url,onClear:s[1]||(s[1]=a=>r("update:modelValue",{name:"",url:""}))},null,8,["modelValue","disabled"]),p(c,{class:H(["upload f-c-c",{disabled:h(S)}]),action:e.action,"show-file-list":e.showFileList,"before-upload":V,"on-progress":F,"on-success":x,"on-error":w,headers:{token:h(K).getItem("token"),source:1}},{default:g(()=>[p(o,{type:"primary"},{default:g(()=>[D("选择文件")]),_:1})]),_:1},8,["class","action","show-file-list","headers"])])}}});const G=O(q,[["__scopeId","data-v-820f5fde"]]);export{G as default};

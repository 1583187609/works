import{M as N,ak as x,c8 as P,aM as h,cq as q,cn as O,q as B,u as r,I as _,bx as A,ao as F,b3 as H,t as g,bN as y,aR as m,bf as G,co as J,aE as t,F as C,s as b,bC as K,bc as I,aI as Q,aF as W,v as X,bH as Y}from"./index-0bf49a0e.js";const Z=c=>(Q("data-v-47efca98"),c=c(),W(),c),ee={class:"base-upload"},se={key:0,class:"f-c-c-c upload-err-mask"},ae=Z(()=>X("div",null,"上传失败",-1)),te={key:0,class:"tips"};var V;const oe=N({__name:"BaseUpload",props:x({modelValue:{},size:{},fit:{},showFileList:{type:Boolean},drag:{type:Boolean},accept:{},limitSize:{},headers:{},action:{},showTips:{type:Boolean},handleSuccessResponse:{type:Function}},Object.assign({size:100,fit:"cover",showFileList:!1,showTips:!0,accept:"image/png,image/jpg,image/jpeg",limitSize:1024*1024*10},(V=P)==null?void 0:V.BaseUpload)),emits:["update:modelValue","change"],setup(c,{emit:T}){G(e=>({"0ca550ec":I(S)}));const l=c,z=T,p=h(0),{formItem:f}=J(),n=h(q().value),S=O(l.size),i=h(""),u=B({get(){return l.modelValue||""},set(e){z("update:modelValue",e),f==null||f.validate("blur")}}),U=B(()=>{const{accept:e,limitSize:a}=l,s=w(e),o=k(a);return`仅支持${s}，不超过${o}`}),L=e=>{const{limitSize:a,accept:s}=l,{type:o,size:v}=e,d=D(s,o)||E(a,v);return d?(y.error(d),!1):!0},M=e=>{const{loaded:a,total:s}=e;p.value=Math.floor(a/s*100)},$=(e,a)=>{l.handleSuccessResponse(e,a).then(s=>{u.value=s,z("change",s)}).catch(s=>{y.error(s)})},j=(e,a,s)=>{y.error("文件上传失败"),i.value=URL.createObjectURL(a.raw)};function R(){n.value||(u.value="")}function w(e){return e.split(",").map(s=>s.split("/")[1]).join("，")}function k(e){let a=e/1024,s="";return a<1024?s=`${a.toFixed(1)}kb`:(a=a/1024,s=`${a.toFixed(1)}Mb`),s}function D(e,a){let s="";return e.split(",").includes(a)||(s=`仅支持上传${w(e)}格式的图片`),s}function E(e,a){return a>e?`图片大小不能超过${k(e)}`:""}return(e,a)=>{const s=m("BaseIcon"),o=m("BaseImg"),v=m("el-progress"),d=m("el-upload");return t(),r("div",ee,[_(d,{class:F(["upload f-c-c",{disabled:n.value}]),action:e.action,"show-file-list":e.showFileList,"before-upload":L,"on-progress":M,"on-success":$,"on-error":j,headers:e.headers},{default:A(()=>[i.value?(t(),r("div",se,[_(s,{size:"26",name:"Picture"}),ae])):g("",!0),u.value||i.value?(t(),r(C,{key:1},[!n.value&&!i.value?(t(),b(s,{key:0,onClick:K(R,["stop"]),class:F(["icon-del",{disabled:n.value}]),size:"24",name:"CircleCloseFilled"},null,8,["class"])):g("",!0),_(o,{class:"img",src:u.value||i.value,fit:e.fit,preview:n.value},null,8,["src","fit","preview"])],64)):(t(),r(C,{key:2},[p.value>0&&p.value<100?(t(),b(v,{key:0,type:"circle",width:parseInt(e.size.toString())*.8,percentage:p.value,"stroke-width":4},null,8,["width","percentage"])):(t(),b(s,{key:1,class:"icon-add",size:parseFloat(I(S).toString())/4,name:"Plus"},null,8,["size"]))],64))]),_:1},8,["class","action","show-file-list","headers"]),e.showTips?(t(),r("div",te,H(U.value),1)):g("",!0)])}}});const le=Y(oe,[["__scopeId","data-v-47efca98"]]);export{le as default};

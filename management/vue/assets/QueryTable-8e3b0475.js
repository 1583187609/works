var e,t,s;import{ar as o,M as a,ak as n,cz as l,c8 as r,bd as u,aM as i,aK as c,bt as p,q as d,bz as m,s as g,A as h,bx as f,am as y,bc as v,t as _,aR as B,aS as b,aE as S,I as x,u as w,aP as j,aQ as A,ap as C,a3 as M,F as R,c3 as $,cA as k,cB as z,bH as E}from"./index-e84f6b3a.js";import{_ as F}from"./Column.vue_vue_type_script_name_Column_setup_true_lang-06e3ab32.js";import{n as T,a as L}from"./_utils-dbaa0fd3.js";import{g as O,a as W}from"./_utils-dad6d8a4.js";import{d as q}from"./_config-0a862e30.js";import"./GroupBtns-6660c8e8.js";import"./index-9636325c.js";import"./cascader-191e4a24.js";import"./BaseRender.vue_vue_type_script_setup_true_lang-91a8853e.js";const G=E(a({__name:"QueryTable",props:n({tableAttrs:{},groupBtnsAttrs:{},loading:{type:Boolean},cols:{},rows:{},groupBtns:{type:[Array,Function]},sort:{type:Boolean},index:{type:Boolean},disabled:{type:Boolean},selection:{type:Boolean},showSummary:{type:Boolean},currPage:{},pageSize:{},refreshList:{type:Function},summaryMethod:{type:Function},filterBtnsByAuth:{type:Function}},Object.assign({cols:()=>[],rows:()=>[],summaryMethod:l},null==(s=null==(t=null==(e=r)?void 0:e.BaseCrud)?void 0:t._components)?void 0:s.QueryTable)),emits:["update:cols","selectionChange","groupBtn","change"],setup(e,{expose:t,emit:s}){const a=e,n=s,l=u(),{handleScroll:r}=(()=>{let e=null,t=0;return o((()=>{null==e||e.scrollTo(0,t)})),{handleScroll:function(s,o){let a=s.target;if(o&&(a=a.querySelector(o)),!a)return;const{scrollTop:n}=a;!e&&(e=a),t=n}}})();let E=0,G=a.showSummary?2:1;const P=i(null),Q=i([]),H=c([]);p((()=>{const{cols:e,currPage:t,pageSize:s}=a,o=O(t,s),{index:r,sort:u,selection:i,operate:c}=o;T("index",a)&&e.unshift(r),T("sort",a)&&e.unshift(u),T("selection",a)&&e.unshift(i),T("operate",a)&&e.push(c);const p=e.map((e=>{if("Object"!==$(e))return 1;const{col:t,level:s}=W(e,1,o,"small"===l.size);return H.push(t),s})),d=Math.max(...p);G+=d-1,n("update:cols",H)}))();const I=d((()=>{const{showSummary:e,summaryMethod:t}=a;return Object.assign({maxHeight:`calc(100% + ${40*G}px)`},q,{showSummary:e,summaryMethod:t})}));function K(e,{row:t,col:s,$index:o},a){n("groupBtn",e,{$index:o,...t},a)}function N(e){Q.value=e;const t=e.map((e=>e[I.value.rowKey]));n("selectionChange",e,t)}function Y(e,t){const{groupBtns:s=[],rows:o,filterBtnsByAuth:n}=a,l=L(e,t,s),r=Z(l);return E<r&&(E=r,H.slice(-1)[0].minWidth=E),t===o.length-1&&E<30&&(E=Z(),H.slice(-1)[0].minWidth=E),n(l)}function Z(e){if(!e){return 66}let t=0,s=0;const{groupBtnsAttrs:o={}}=a,{vertical:n,maxNum:l=z}=o;return e.length>l&&(e=e.slice(0,l-1).concat([{text:"更多"}])),n?e.forEach((e=>{t=k(e.text)+1;const o=12*t+6+24;o>s&&(s=o)})):(e.forEach((e=>{t+=k(e.text)+1})),s=12*t+3*e.length*2+12*(e.length-1)+24),s}return t({tableRef:P,clearSelection(){var e;return null==(e=null==P?void 0:P.value)?void 0:e.clearSelection()},allSelection(){var e;return null==(e=null==P?void 0:P.value)?void 0:e.toggleAllSelection()},invertSelection(){var e;null==(e=null==Q?void 0:Q.value)||e.forEach(((e,t)=>{var s;null==(s=null==P?void 0:P.value)||s.toggleRowSelection(e,!1)}))}}),(e,t)=>{const s=B("BaseEmpty"),o=B("el-table"),a=b("loading");return H.length?m((S(),g(o,y({key:0,class:"query-table",data:e.rows,onSelectionChange:N,onScrollCapture:v(r)},I.value,{ref_key:"tableRef",ref:P}),h({default:f((()=>[(S(!0),w(R,null,j(H,((t,s)=>(S(),g(F,{col:t,selection:e.selection,refreshList:e.refreshList,groupBtnsAttrs:e.groupBtnsAttrs,getGroupBtnsOfRow:Y,onGroupBtn:K,disabled:e.disabled,key:s},{custom:f((({row:t,col:s,ind:o})=>[A(e.$slots,"custom",C(M({row:t,col:s,$index:o})),void 0,!0)])),_:2},1032,["col","selection","refreshList","groupBtnsAttrs","disabled"])))),128))])),_:2},[e.loading?void 0:{name:"empty",fn:f((()=>[x(s)])),key:"0"}]),1040,["data","onScrollCapture"])),[[a,e.loading]]):_("",!0)}}}),[["__scopeId","data-v-c9cd8beb"]]);export{G as default};

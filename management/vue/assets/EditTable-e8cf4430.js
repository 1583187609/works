import{M as se,aa as ae,aM as g,aK as S,c8 as V,bs as oe,aR as i,aS as le,aE as o,s as p,bx as l,am as x,I as k,u as f,F as w,aP as ne,ap as j,A as re,v as ie,t as q,H as _,b3 as B,aQ as de,bc as C,cO as ue,bz as ce,ao as pe,cG as fe,bN as L,bH as me}from"./index-346f95fe.js";const _e={key:0,class:"required"},be={key:1,class:"f-c-c"},ye={key:2,class:"f-c-c f-0 pt-h pb-h",style:{width:"100%"}},ve=1,he=se({__name:"EditTable",props:{cols:{default:()=>[]},rows:{default:()=>[]},footer:{type:Boolean,default:!0},text:{type:Boolean,default:!1},request:{},total:{},currPage:{},pageSize:{},pageAttrs:{},submitText:{default:"提交"},resetText:{default:"重置"},index:{type:Boolean},extraParams:{},autoAddRow:{type:Boolean,default:!1},submitCb:{}},emits:["submit","update:rows"],setup($,{expose:z,emit:D}){const O={border:!0,tableLayout:"auto",highlightCurrentRow:!0},H={align:"center",headerAlign:"center"},n=$,E=D,M=ae("closePopup"),b=g(null),d=g(!1),u=g(n.rows),{extraParams:ge,submitText:P,submitCb:A,index:U,cols:v}=n,G=S(V.merge({maxHeight:`calc(100% + ${ve*36}px)`},O));U&&(v.slice(0,2).find(e=>e.type==="index")||v.unshift({prop:"$index",label:"序号",type:"index",fixed:"left",width:58,index:1}));const I=S(v.map(e=>{const{type:r}=(e==null?void 0:e.field)||{};let s={};return r==="operate"&&(s={prop:"$operate",fixed:"right",width:80}),e=V.merge(s,H,e),e}));function K(e,r){const{field:s,label:a,prop:c="",...T}=e,h=`${r}[${c}]`;return s.prop=h,s}oe(u,(e=[])=>{if(!e.length&&n.autoAddRow&&!Object.values(e.slice(-1)[0]).every(a=>a==="")){const a={};Object.keys(e.slice(-1)[0]).forEach(c=>{a[c]=""}),e.push(a)}E("update:rows",e)},{immediate:!0,deep:!0});function Q(e){u.value.splice(e,1)}const J=()=>{const e=b.value;e&&e.validate((r,s)=>{if(r){const a=u.value.slice(0,-1);n!=null&&n.request?(d.value=!0,n.request(a).then(c=>{L.success(P+"成功"),A?A():M()}).finally(()=>{d.value=!1})):E("submit",a)}else{const a=Object.values(s)[0][0];L.error(a.message)}})},W=()=>{const e=b.value;e&&e.resetFields()};return z({formRef:b}),(e,r)=>{const s=i("el-button"),a=i("BaseFormItem"),c=i("el-table-column"),T=i("BaseEmpty"),h=i("el-table"),X=i("BaseIcon"),Y=i("el-form"),Z=le("debounce");return o(),p(Y,{ref_key:"formRef",ref:b,class:"edit-table f-fs-s-c",model:u.value},{default:l(()=>[I.length?(o(),p(h,x({key:0,data:u.value},G,{class:"table"}),{empty:l(()=>[k(T)]),default:l(()=>[(o(!0),f(w,null,ne(I,(t,ee)=>(o(),p(c,j(x({key:ee},t)),re({header:l(({row:y,colum:te,$index:m})=>[ie("span",null,[t.required?(o(),f("span",_e,"*")):q("",!0),_(" "+B(t.label),1)])]),_:2},[t.field?{name:"default",fn:l(({row:y,column:te,$index:m})=>{var F,N;return[((F=t==null?void 0:t.field)==null?void 0:F.type)==="custom"?de(e.$slots,t.prop,j(x({key:0},{row:y,col:t,$index:m})),void 0,!0):((N=t==null?void 0:t.field)==null?void 0:N.type)==="operate"?(o(),f(w,{key:1},[m<u.value.length-1?(o(),p(s,{key:0,icon:C(ue),type:"danger",link:"",onClick:R=>Q(m)},{default:l(()=>[_("删除")]),_:2},1032,["icon","onClick"])):(o(),f(w,{key:1},[_("-")],64))],64)):(o(),p(a,{key:2,field:K(t,m),modelValue:y[t.prop],"onUpdate:modelValue":R=>y[t.prop]=R},null,8,["field","modelValue","onUpdate:modelValue"]))]}),key:"0"}:void 0]),1040))),128))]),_:3},16,["data"])):(o(),f("div",be,"空空如也~")),!e.text&&e.footer?(o(),f("div",ye,[ce((o(),p(s,{type:"primary",disabled:d.value},{icon:l(()=>[k(X,{class:pe({rotate:d.value}),name:d.value?"Loading":"Promotion"},null,8,["class","name"])]),default:l(()=>[_(" "+B(C(P)),1)]),_:1},8,["disabled"])),[[Z,J,void 0,{immediate:!0}]]),k(s,{icon:C(fe),onClick:W,disabled:d.value},{default:l(()=>[_(B(e.resetText),1)]),_:1},8,["icon","disabled"])])):q("",!0)]),_:3},8,["model"])}}});const ke=me(he,[["__scopeId","data-v-752334e7"]]);export{ke as default};

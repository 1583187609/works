import{M as e,aK as a,c5 as t,aM as o,q as l,c4 as s,b_ as r,cq as u,bs as n,aR as i,aE as d,s as f,bx as p,v as m,ao as c,u as v,F as b,aP as h,b3 as x,ap as y,am as g,bc as B,cl as T,cj as k,t as V,aQ as F,aq as S,bA as _,bH as R}from"./index-050c1617.js";import{h as j}from"./_utils-775776d1.js";import q from"./FooterBtns-103dee48.js";import{d as C}from"./_config-c0994392.js";import"./index-605a54c6.js";const O=["onClick"],P={class:"title f-fs-c"},$={class:"line-1"},U={key:1,class:"f-c-c pb-o"},I=R(e({__name:"SectionForm",props:{modelValue:{default:()=>a({})},sections:{default:()=>[]},pureText:{type:Boolean},foldable:{type:Boolean,default:!0},fetch:{},fetchSuccess:{},fetchFail:{},footer:{type:Boolean,default:!0},span:{default:24},submitText:{},resetText:{},extraParams:{},moreBtns:{},loading:{type:Boolean},isOmit:{type:Boolean,default:!0},log:{type:Boolean,default:!t},debug:{type:Boolean},autoFixedFoot:{type:Boolean,default:!0},noSubmitProps:{},labelWidthBySection:{type:Boolean,default:!0},handleReq:{}},emits:["update:modelValue","submit","change","moreBtns"],setup(e,{expose:a,emit:t}){const R=e,I=t,M=o(null),N=o([]),W=o(),w=l((()=>{const e=Math.max(...R.sections.map(((e,a)=>{var t;if("Object"!==s(e))return 0;const o=e,{fold:l=!1}=o;return N.value[a]=l,null==(t=o.fields)||t.map((e=>{if("Object"!==s(e))return e;const a=e;return a.attrs=r.merge({},o.attrs,a.attrs),a})),u(null==o?void 0:o.fields)})));return r.merge({labelWidth:e+"em"},C)})),A=o([]),K=l({get:()=>R.modelValue,set(e){I("update:modelValue",e)}}),Q=l((()=>r.merge({},K.value,R.extraParams)));function z(){R.fetch?M.value.submit():I("submit",Q.value)}return n((()=>R.sections),(e=>{const{modelValue:a,labelWidthBySection:t}=R;A.value=e.filter((e=>{if("Object"!==s(e))return!1;const{type:o,prop:l,fields:n,fieldAttrs:i}=e;if("Undefined"!==s(l)){const e=null==a?void 0:a[l];K.value[l]="custom"===o?e:j(n,I,e).data}else{const o=j(n,I,a,i);let{data:l,fields:s}=o;if(r.merge(K.value,l),t){const e=u(n);s=s.map(((a,t)=>(a.labelWidth=e+"em",a)))}e.fields=s}return!0}))}),{immediate:!0,deep:!0}),a({formRef:W,formValidate:()=>M.value.formValidate()}),(e,a)=>{const t=i("BaseIcon"),o=i("el-popover"),l=i("BaseFormItem"),s=i("el-form");return d(),f(s,g({class:"section-form f-fs-s-c",model:K.value},w.value,{onKeyup:_(z,["enter"]),ref_key:"formRef",ref:W}),{default:p((()=>[m("div",{class:c(["all-hide-scroll f-fs-s-w",{"auto-fixed-foot":e.autoFixedFoot}])},[A.value.length?(d(!0),v(b,{key:0},h(A.value,((s,r)=>(d(),v("section",{class:c(["section",{[`f-span-${s.span??24}`]:!0}]),key:r},[m("div",{onClick:e=>{return a=r,void((null==(o=null==(t=e.target)?void 0:t.classList)?void 0:o.contains("head"))&&(N.value[a]=!N.value[a]));var a,t,o},class:"head f-sb-c"},[m("div",P,[m("span",$,x(s.title),1),s.popover?(d(),f(o,y(g({key:0},B(T)(s.popover))),{reference:p((()=>[s.popover?(d(),f(t,{key:0,color:B(k).colorInfo,class:"ml-q",name:"QuestionFilled"},null,8,["color"])):V("",!0)])),_:2},1040)):V("",!0)]),F(e.$slots,"right-"+(s.prop??r),{},void 0,!0),e.foldable?(d(),f(t,{key:0,onClick:e=>N.value[r]=!N.value[r],class:c(["fold-btn f-0",N.value[r]?"rotate-180":""]),size:"1.5em",name:"CaretTop"},null,8,["onClick","class"])):V("",!0)],8,O),m("div",{class:"body f-fs-fs-w",style:S({"max-height":N.value[r]?"0":"100vh"})},["custom"===s.type?F(e.$slots,s.prop,{key:0,form:K.value},void 0,!0):(d(!0),v(b,{key:1},h(s.fields,((t,o)=>(d(),v(b,{key:t.key||o},[s.prop?(d(),f(l,{key:0,className:`f-span-${t.span||e.span}`,field:t,pureText:t.pureText||s.pureText||e.pureText,modelValue:K.value[s.prop][t.prop],"onUpdate:modelValue":e=>K.value[s.prop][t.prop]=e,onChange:a[0]||(a[0]=(e,a)=>I("change",e,a))},{custom:p((({field:a})=>[F(e.$slots,a.prop,{field:a,form:K.value},void 0,!0)])),_:2},1032,["className","field","pureText","modelValue","onUpdate:modelValue"])):(d(),f(l,{key:1,className:`f-span-${t.span||e.span}`,field:t,pureText:t.pureText||s.pureText||e.pureText,modelValue:K.value[t.prop],"onUpdate:modelValue":e=>K.value[t.prop]=e,onChange:a[1]||(a[1]=(e,a)=>I("change",e,a))},{custom:p((({field:a})=>[F(e.$slots,a.prop,{field:a,form:K.value},void 0,!0)])),_:2},1032,["className","field","pureText","modelValue","onUpdate:modelValue"]))],64)))),128))],4)],2)))),128)):(d(),v("div",U,"空空如也~"))],2),!e.pureText&&e.footer?(d(),f(q,{key:0,loading:e.loading,moreBtns:e.moreBtns,submitText:e.submitText,resetText:e.resetText,formRef:W.value,isOmit:e.isOmit,log:e.log,debug:e.debug,params:Q.value,fetch:e.fetch,fetchSuccess:e.fetchSuccess,fetchFail:e.fetchFail,noSubmitProps:e.noSubmitProps,handleReq:e.handleReq,disabled:!A.value.length,onMoreBtns:a[2]||(a[2]=(e,a,t)=>I("moreBtns",e,a,t)),onSubmit:a[3]||(a[3]=e=>I("submit",e)),ref_key:"footerBtnsRef",ref:M},null,8,["loading","moreBtns","submitText","resetText","formRef","isOmit","log","debug","params","fetch","fetchSuccess","fetchFail","noSubmitProps","handleReq","disabled"])):V("",!0)])),_:3},16,["model"])}}}),[["__scopeId","data-v-1b59c48f"]]);export{I as default};

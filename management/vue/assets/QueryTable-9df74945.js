import{ar as G,M as $,ak as j,cy as q,c8 as D,bd as H,aM as z,aK as K,bt as V,q as I,bz as J,s as k,A as R,bx as w,am as U,bc as X,t as Y,aR as T,aS as Z,aE as x,I as ee,u as te,aP as oe,aQ as ne,ap as ae,a3 as se,F as re,c3 as le,cz as ce,bH as ie}from"./index-0bf49a0e.js";import{_ as ue}from"./Column.vue_vue_type_script_name_Column_setup_true_lang-84205a12.js";import{n as _,a as pe}from"./_utils-81590a01.js";import{g as de,a as me}from"./_utils-2def5d6e.js";import{d as ge}from"./_config-02df11e8.js";import"./GroupBtns-4d5303c9.js";import"./index-2f1ff7f6.js";import"./cascader-54e0629f.js";import"./BaseRender.vue_vue_type_script_setup_true_lang-ceb9aa7b.js";const fe=()=>{let u=null,y=0;function b(n,d){let p=n.target;if(d&&(p=p.querySelector(d)),!p)return;const{scrollTop:C}=p;!u&&(u=p),y=C}return G(()=>{u==null||u.scrollTo(0,y)}),{handleScroll:b}};var E,L,O;const he=$({__name:"QueryTable",props:j({tableAttrs:{},groupBtnsAttrs:{},loading:{type:Boolean},cols:{},rows:{},groupBtns:{type:[Array,Function]},sort:{type:Boolean},index:{type:Boolean},disabled:{type:Boolean},selection:{type:Boolean},showSummary:{type:Boolean},currPage:{},pageSize:{},refreshList:{type:Function},summaryMethod:{type:Function},filterBtnsByAuth:{type:Function}},Object.assign({cols:()=>[],rows:()=>[],summaryMethod:q},(O=(L=(E=D)==null?void 0:E.BaseCrud)==null?void 0:L._components)==null?void 0:O.QueryTable)),emits:["update:cols","selectionChange","groupBtn","change"],setup(u,{expose:y,emit:b}){const n=u,d=b,p=H(),{handleScroll:C}=fe();let m=0,A=n.showSummary?2:1;const a=z(null),B=z([]),g=K([]);V(()=>{const{cols:e,currPage:t,pageSize:l}=n,o=de(t,l),{index:c,sort:s,selection:r,operate:h}=o;_("index",n)&&e.unshift(c),_("sort",n)&&e.unshift(s),_("selection",n)&&e.unshift(r),_("operate",n)&&e.push(h);const f=e.map(S=>{if(le(S)!=="Object")return 1;const{col:v,level:Q}=me(S,1,o,p.size==="small");return g.push(v),Q}),i=Math.max(...f);A+=i-1,d("update:cols",g)})();const P=I(()=>{const{showSummary:e,summaryMethod:t}=n;return Object.assign({maxHeight:`calc(100% + ${A*40}px)`},ge,{showSummary:e,summaryMethod:t})});function W(e,{row:t,col:l,$index:o},c){d("groupBtn",e,{$index:o,...t},c)}function F(e){B.value=e;const t=e.map(l=>l[P.value.rowKey]);d("selectionChange",e,t)}function N(e,t){const{groupBtns:l=[],rows:o,filterBtnsByAuth:c}=n,s=pe(e,t,l),r=M(s);return m<r&&(m=r,g.slice(-1)[0].minWidth=m),t===o.length-1&&m<30&&(m=M(),g.slice(-1)[0].minWidth=m),c(s)}function M(e){if(!e)return 66;let s=0,r=0;const{vertical:h,maxNum:f=ce}=n.groupBtnsAttrs||{};return e.length>f&&(e=e.slice(0,f-1).concat([{text:"更多"}])),h?e.forEach((i,S)=>{s=i.text.replace(/[^\x00-\xff]/g,"**").length/2+1;const v=s*12+3*2+12*2;v>r&&(r=v)}):(e.forEach((i,S)=>{s+=i.text.replace(/[^\x00-\xff]/g,"**").length/2+1}),r=s*12+e.length*3*2+(e.length-1)*12+12*2),r}return y({tableRef:a,clearSelection(){var e;return(e=a==null?void 0:a.value)==null?void 0:e.clearSelection()},allSelection(){var e;return(e=a==null?void 0:a.value)==null?void 0:e.toggleAllSelection()},invertSelection(){var e;(e=B==null?void 0:B.value)==null||e.forEach((t,l)=>{var o;(o=a==null?void 0:a.value)==null||o.toggleRowSelection(t,!1)})}}),(e,t)=>{const l=T("BaseEmpty"),o=T("el-table"),c=Z("loading");return g.length?J((x(),k(o,U({key:0,class:"query-table",data:e.rows,onSelectionChange:F,onScrollCapture:X(C)},P.value,{ref_key:"tableRef",ref:a}),R({default:w(()=>[(x(!0),te(re,null,oe(g,(s,r)=>(x(),k(ue,{col:s,selection:e.selection,refreshList:e.refreshList,groupBtnsAttrs:e.groupBtnsAttrs,getGroupBtnsOfRow:N,onGroupBtn:W,disabled:e.disabled,key:r},{custom:w(({row:h,col:f,ind:i})=>[ne(e.$slots,"custom",ae(se({row:h,col:f,$index:i})),void 0,!0)]),_:2},1032,["col","selection","refreshList","groupBtnsAttrs","disabled"]))),128))]),_:2},[e.loading?void 0:{name:"empty",fn:w(()=>[ee(l)]),key:"0"}]),1040,["data","onScrollCapture"])),[[c,e.loading]]):Y("",!0)}}});const Pe=ie(he,[["__scopeId","data-v-9672bcb1"]]);export{Pe as default};

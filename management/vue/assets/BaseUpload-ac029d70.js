import{ay as v,aT as E,a5 as M}from"./index-79ac556c.js";import{i as P}from"./common-f4827de9.js";import{s as x}from"./storage-f5c2149e.js";import{c as N}from"./use-form-item-f859f9c0.js";import{F as O}from"./index-54c669c3.js";import{q,be as A,r as y,v as d,L as z,E as K,z as C,K as X,u,I as S,a6 as g,t as o,F as I,D as w,bn as G,bl as H,x as J}from"./runtime-core.esm-bundler-95bf9971.js";import{_ as Q}from"./_plugin-vue_export-helper-c27b6911.js";import"./index-4a03ead4.js";const W={headers:()=>({"X-Token":x.getItem("token")}),action:"/api/admin/upload/image",handleSuccessResponse:(a,b)=>new Promise((n,m)=>{const{code:l,message:c,data:i}=a;l===2e3?n(i.fullUrl):m(c)})},Y=a=>(G("data-v-db707361"),a=a(),H(),a),Z={class:"base-upload"},ee={key:0,class:"f-c-c-c upload-err-mask"},se=Y(()=>J("div",null,"上传失败",-1)),te={key:0,class:"tips"},oe=q({__name:"BaseUpload",props:A({modelValue:{},size:{},fit:{},showFileList:{type:Boolean},drag:{type:Boolean},accept:{},limitSize:{},headers:{},action:{},showTips:{type:Boolean},handleSuccessResponse:{type:Function}},{...Object.assign({size:100,fit:"cover",showFileList:!1,showTips:!0,accept:"image/png,image/jpg,image/jpeg",limitSize:1024*1024*10},W)}),emits:["update:modelValue","change"],setup(a,{emit:b}){E(e=>({"3797805d":u(k)}));const n=a,m=b,l=y(0),{formItem:c}=N(),i=y(O().value),k=P(n.size),p=y(""),f=computed({get(){return n.modelValue||""},set(e){m("update:modelValue",e),c==null||c.validate("blur")}}),T=computed(()=>{const{accept:e,limitSize:t}=n,s=B(e),r=F(t);return`仅支持${s}，不超过${r}`}),V=e=>{const{limitSize:t,accept:s}=n,{type:r,size:_}=e,h=D(s,r)||R(t,_);return h?(v.error(h),!1):!0},U=e=>{const{loaded:t,total:s}=e;l.value=Math.floor(t/s*100)},L=(e,t)=>{n.handleSuccessResponse(e,t).then(s=>{f.value=s,m("change",s)}).catch(s=>{v.error(s)})},$=(e,t,s)=>{v.error("文件上传失败"),p.value=URL.createObjectURL(t.raw)};function j(){i.value||(f.value="")}function B(e){return e.split(",").map(s=>s.split("/")[1]).join("，")}function F(e){let t=e/1024,s="";return t<1024?s=`${t.toFixed(1)}kb`:(t=t/1024,s=`${t.toFixed(1)}Mb`),s}function D(e,t){let s="";return e.split(",").includes(t)||(s=`仅支持上传${B(e)}格式的图片`),s}function R(e,t){return t>e?`图片大小不能超过${F(e)}`:""}return(e,t)=>{const s=g("BaseIcon"),r=g("BaseImg"),_=g("el-progress"),h=g("el-upload");return o(),d("div",Z,[z(h,{class:C(["upload f-c-c",{disabled:i.value}]),action:e.action,"show-file-list":e.showFileList,"before-upload":V,"on-progress":U,"on-success":L,"on-error":$,headers:e.headers},{default:K(()=>[p.value?(o(),d("div",ee,[z(s,{size:"26",name:"Picture"}),se])):S("",!0),u(f)||p.value?(o(),d(I,{key:1},[!i.value&&!p.value?(o(),w(s,{key:0,onClick:M(j,["stop"]),class:C(["icon-del",{disabled:i.value}]),size:"24",name:"CircleCloseFilled"},null,8,["class"])):S("",!0),z(r,{class:"img",src:u(f)||p.value,fit:e.fit,preview:i.value},null,8,["src","fit","preview"])],64)):(o(),d(I,{key:2},[l.value>0&&l.value<100?(o(),w(_,{key:0,type:"circle",width:parseInt(e.size.toString())*.8,percentage:l.value,"stroke-width":4},null,8,["width","percentage"])):(o(),w(s,{key:1,class:"icon-add",size:parseFloat(u(k).toString())/4,name:"Plus"},null,8,["size"]))],64))]),_:1},8,["class","action","show-file-list","headers"]),e.showTips?(o(),d("div",te,X(u(T)),1)):S("",!0)])}}});const ue=Q(oe,[["__scopeId","data-v-db707361"]]);export{ue as default};

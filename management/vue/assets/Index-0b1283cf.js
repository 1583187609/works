import{s as Ie,t as ge,i as Te,f as Ue,l as ee}from"./common-f4827de9.js";import{V as Qe,W as We,X as He,r as Ke}from"./index-4a03ead4.js";import{g as _e,b as Ge}from"./index-d2b43e08.js";import{B as Je,_ as Xe,g as Ye,n as me,a as Ze,G as et,d as tt,b as ot,c as nt,h as st,e as lt}from"./BaseTable-9cd398a4.js";import{bg as at,q as Y,r as x,a6 as R,t as B,D as j,E as P,L as q,V as T,v as W,be as re,a0 as ne,J as ue,K as Be,F as se,u as I,e as H,I as le,Q as De,T as Ee,O as fe,f as rt,G as Me,a1 as it,af as Le,y as te,a3 as je,a9 as xe,z as ve,w as be,x as ze,A as Fe,o as ut,k as ct}from"./runtime-core.esm-bundler-95bf9971.js";import{_ as ce}from"./_plugin-vue_export-helper-c27b6911.js";import{h as pt,g as dt,a as Pe,i as mt,o as Ae,b as $e,r as gt,s as ft,p as ke,c as ht}from"./system-a8d5b9ab.js";/* empty css                                                                      */import"./index-1a9ed3b5.js";import"./all-tags-eaeb4056.js";import{u as yt}from"./event-c4cbe7a2.js";import{h as Ve}from"./_utils-eb832563.js";import{ay as vt}from"./index-79ac556c.js";import"./vue-router-f1520cd3.js";import"./platform-fba39571.js";import"./storage-f5c2149e.js";import"./_config-82a4d737.js";import"./index-1d56dfd6.js";import"./pinia-680d6f3f.js";import"./index-54c669c3.js";import"./use-form-item-f859f9c0.js";import"./index-a0dfeff6.js";import"./index-eafd3d73.js";const bt=()=>{let A=null,N=0;function z(m,o){let s=m.target;if(o&&(s=s.querySelector(o)),!s)return;const{scrollTop:g}=s;!A&&(A=s),N=g}return at(()=>{A==null||A.scrollTo(0,N)}),{handleScroll:z}},_t=Y({__name:"SetTable",props:{rows:{default:()=>[]},size:{},handleShowChange:{},handleExportChange:{},handleOrderChange:{},handleResetColSet:{}},setup(A){const N={inlinePrompt:!0,activeText:"是",inactiveText:"否"},z=x(Date.now()),m=[{prop:"colName",label:"列名",minWidth:110},{prop:"isShow",label:"是否显示",minWidth:70,type:"custom"},{prop:"isExport",label:"是否导出",minWidth:70,type:"custom"},{prop:"isOrder",label:"是否排序",minWidth:70,type:"custom"}];return(o,s)=>{const g=R("el-switch");return B(),j(Je,{style:{width:"400px"},cols:m,rows:o.rows,submitText:"确定",key:z.value,size:o.size},{isShow:P(({row:f,col:S,$index:c})=>[q(g,T({onChange:r=>o.handleShowChange(f.colProp,r,c),modelValue:f.isShow,"onUpdate:modelValue":r=>f.isShow=r},N),null,16,["onChange","modelValue","onUpdate:modelValue"])]),isExport:P(({row:f,col:S,$index:c})=>[q(g,T({onChange:r=>o.handleExportChange(f.colProp,r,c),modelValue:f.isExport,"onUpdate:modelValue":r=>f.isExport=r},N,{disabled:""}),null,16,["onChange","modelValue","onUpdate:modelValue"])]),isOrder:P(({row:f,col:S,$index:c})=>[q(g,T({onChange:r=>o.handleOrderChange(f.colProp,r,c),modelValue:f.isOrder,"onUpdate:modelValue":r=>f.isOrder=r},N,{disabled:""}),null,16,["onChange","modelValue","onUpdate:modelValue"])]),_:1},8,["rows","size"])}}}),Bt={class:"base-print"},St=Y({__name:"SetPrint",setup(A){return(N,z)=>(B(),W("div",Bt,"base-print.vue"))}});const Ct=ce(St,[["__scopeId","data-v-26f5a2c0"]]),wt={},zt=Y({__name:"BatchBtns",props:re({disabled:{type:Boolean},allSelection:{type:Function},clearSelection:{type:Function},invertSelection:{type:Function}},{...Object.assign({},wt)}),setup(A){const N=[{name:"all",text:"全选",attrs:{type:"success",plain:!0}},{name:"not",text:"全不选",attrs:{type:"danger",plain:!0}},{name:"invert",text:"反选",attrs:{type:"info",plain:!0}}],z=A;function m(o){console.log(o,"name-------------"),o==="all"?console.log(z.allSelection(),"allSelection----------------"):o==="not"?console.log(z.clearSelection(),"notSelection----------------"):o==="invert"?console.log(z==null?void 0:z.invertSelection(),"notSelection----------------"):console.error("不存在该name值：",o)}return(o,s)=>{const g=R("el-button"),f=R("el-dropdown-item"),S=R("el-dropdown-menu"),c=R("el-dropdown");return B(),j(c,{class:"batch-btns"},{dropdown:P(()=>[q(S,null,{default:P(()=>[(B(),W(se,null,ne(N,(r,u)=>q(f,{key:u},{default:P(()=>[q(g,T({onClick:D=>m(r.name),style:{width:"100%"}},r.attrs),{default:P(()=>[ue(Be(r.text),1)]),_:2},1040,["onClick"])]),_:2},1024)),64))]),_:1})]),default:P(()=>[q(g,{disabled:o.disabled,icon:I(Qe),type:"primary"},{default:P(()=>[ue("批量")]),_:1},8,["disabled","icon"])]),_:1})}}}),Ft={},Pt={class:"extra-btns f-fs-c"},At=Y({__name:"Index",props:re({columns:{},allColumns:{},btns:{},toolBtns:{},total:{},isEmpty:{type:Boolean},batchBtn:{type:Boolean},size:{},allSelection:{type:Function},clearSelection:{type:Function},invertSelection:{type:Function}},{columns:()=>[],allColumns:()=>[],btns:()=>[],...Object.assign({toolBtns:()=>["set"]},Ft)}),emits:["click","toolBtn","update:cols"],setup(A,{emit:N}){const z={print:{name:"print",title:"打印",attrs:{type:"primary",icon:We,plain:!0,circle:!0}},set:{name:"colSet",title:"设置",attrs:{type:"primary",icon:He,plain:!0,circle:!0}}},m=A,o=N,s=De("openPopup"),g=H(()=>{const d=m.btns.map(h=>_e(h));return Ie(d),d}),f=H(()=>m.toolBtns.map(d=>z[d]));function S(d){o("click",d)}function c(d){d==="colSet"?M():d==="print"&&s("打印设置",Ct,"dialog")}function r(d,h,$){const{columns:O,allColumns:k}=m;if(h){let t=-1;O.findIndex((y,a)=>{const n=k.findIndex(l=>l.prop===y.prop);if(n>$)return t=a,!0;if(n<$)return a===O.length-1?(t=O.length,!0):!1}),O.splice(t,0,k[$])}else{const t=O.findIndex(y=>y.prop===d);O.splice(t,1)}o("update:cols",O.slice())}function u(d,h,$){console.log(d,h,$,"ddddd--------------------")}function D(d,h,$){console.log(d,h,$,"ddddd--------------------")}function M(){const{columns:d,allColumns:h}=m,$=h.filter(O=>{var k;return!((k=O.prop)!=null&&k.startsWith("$"))}).map(O=>{const{prop:k,label:t,sortable:y=!1}=O;return{colName:t,colProp:k,isShow:!!d.find(a=>a.prop===k),isExport:!0,isOrder:y}});s("列设置",{component:_t,attrs:{rows:$,size:m.size,handleShowChange:r,handleExportChange:u,handleOrderChange:D,handleResetColSet:G}},"drawer")}function G(){o("update:cols",m.allColumns.slice()),setTimeout(()=>{M()})}return(d,h)=>{const $=R("BaseBtn"),O=R("el-button"),k=R("el-tooltip");return B(),W("div",Pt,[d.batchBtn?(B(),j(zt,{key:0,class:"mr-12",allSelection:d.allSelection,clearSelection:d.clearSelection,invertSelection:d.invertSelection,size:d.size,disabled:!d.total},null,8,["allSelection","clearSelection","invertSelection","size","disabled"])):le("",!0),(B(!0),W(se,null,ne(g.value,(t,y)=>(B(),j($,{onClick:a=>S(t),name:t,size:d.size,key:y},null,8,["onClick","name","size"]))),128)),(B(!0),W(se,null,ne(f.value,(t,y)=>(B(),j(k,{content:t.title,"show-after":500,key:y},{default:P(()=>[q(O,T({style:{marginLeft:y===0?"auto":void 0},size:d.size,onClick:a=>c(t.name)},t.attrs),null,16,["style","size","onClick"])]),_:2},1032,["content"]))),128))])}}}),$t={},kt=Y({__name:"QueryTable",props:re({tableAttrs:{},groupBtnsAttrs:{},loading:{type:Boolean},cols:{},rows:{},groupBtns:{type:[Array,Function]},sort:{type:Boolean},index:{type:Boolean},disabled:{type:Boolean},selection:{type:Boolean},showSummary:{type:Boolean},bodySpaceHeight:{type:Boolean},currPage:{},pageSize:{},refreshList:{type:Function},summaryMethod:{type:Function},filterBtnsByAuth:{type:Function}},{cols:()=>[],rows:()=>[],...Object.assign({summaryMethod:pt},$t)}),emits:["update:cols","selectionChange","groupBtn","change"],setup(A,{expose:N,emit:z}){const m={rowKey:"id",border:!0,tableLayout:"auto",highlightCurrentRow:!0,defaultExpandAll:!1},o={align:"center",headerAlign:"center"},s=A,g=z,f=Ee(),{handleScroll:S}=bt();let c=0,r=s.showSummary?2:1;const u=x(null),D=x([]),M=fe([]);rt(()=>{const{cols:t,currPage:y,pageSize:a}=s,n=Ye(y,a),{index:l,sort:p,selection:i,operate:b}=n;me("index",s)&&t.unshift(l),me("sort",s)&&t.unshift(p),me("selection",s)&&t.unshift(i),me("operate",s)&&t.push(b);const w=t.map(J=>{if(ge(J)!=="Object")return 1;const{col:K,level:ie}=Ze(J,1,n,o,f.size==="small");return M.push(K),ie}),L=Math.max(...w);r+=L-1,g("update:cols",M)})();const d=H(()=>{const{bodySpaceHeight:t,showSummary:y,summaryMethod:a}=s,{top:n}=Ue;return Object.assign({maxHeight:t?`calc(100vh - ${n} - ${n} - 170px - ${Te(t===!0?0:t||0)} + ${r*40}px)`:`calc(100% + ${r*40}px)`},m,{showSummary:y,summaryMethod:a})});function h(t,{row:y,col:a,$index:n},l){g("groupBtn",t,{$index:n,...y},l)}function $(t){D.value=t;const y=t.map(a=>a[d.rowKey]);g("selectionChange",t,y)}function O(t){const{groupBtns:y=[],filterBtnsByAuth:a}=s,l=ge(y)==="Function"?y(t):y,p=l==null?void 0:l.map((b,w)=>_e(b,t)).filter(b=>!!b.name),i=k(p);return c<i&&(c=i,M.slice(-1)[0].minWidth=c),t.$index===s.rows.length-1&&c<30&&(c=k(),M.slice(-1)[0].minWidth=c),a(p)}function k(t){if(!t)return 66;let p=0,i=0;const{vertical:b,maxNum:w=et.maxNum??tt}=s.groupBtnsAttrs||{};return t.length>w&&(t=t.slice(0,w-1).concat([{text:"更多"}])),b?t.forEach((L,J)=>{p=L.text.replace(/[^\x00-\xff]/g,"**").length/2+1;const K=p*12+3*2+12*2;K>i&&(i=K)}):(t.forEach((L,J)=>{p+=L.text.replace(/[^\x00-\xff]/g,"**").length/2+1}),i=p*12+t.length*3*2+(t.length-1)*12+12*2),i}return N({tableRef:u,clearSelection(){var t;return(t=u==null?void 0:u.value)==null?void 0:t.clearSelection()},allSelection(){var t;return(t=u==null?void 0:u.value)==null?void 0:t.toggleAllSelection()},invertSelection(){var t;console.log(u.value.getSelectionRows(),"点击反选按钮-暴露出来的-----------------"),(t=D==null?void 0:D.value)==null||t.forEach((y,a)=>{var n;(n=u==null?void 0:u.value)==null||n.toggleRowSelection(y,!1)})}}),(t,y)=>{const a=R("BaseEmpty"),n=R("el-table"),l=Le("loading");return M.length?Me((B(),j(n,T({key:0,class:"query-table",data:t.rows,onSelectionChange:$,onScrollCapture:I(S)},d.value,{ref_key:"tableRef",ref:u}),it({default:P(()=>[(B(!0),W(se,null,ne(M,(p,i)=>(B(),j(Xe,{col:p,selection:t.selection,refreshList:t.refreshList,groupBtnsAttrs:t.groupBtnsAttrs,getGroupBtnsOfRow:O,onGroupBtn:h,disabled:t.disabled,key:i},{custom:P(({row:b,col:w,ind:L})=>[te(t.$slots,"custom",je(xe({row:b,col:w,$index:L})),void 0,!0)]),_:2},1032,["col","selection","refreshList","groupBtnsAttrs","disabled"]))),128))]),_:2},[t.loading?void 0:{name:"empty",fn:P(()=>[q(a)]),key:"0"}]),1040,["data","onScrollCapture"])),[[l,t.loading]]):le("",!0)}}});const Vt=ce(kt,[["__scopeId","data-v-ac588089"]]),Nt=Y({__name:"QueryFields",props:{modelValue:{default:()=>({})},field:{},size:{},className:{},inputDebounce:{type:Boolean}},emits:["update:modelValue","change"],setup(A,{emit:N}){const z=A,m=N;let o=H({get(){return z.modelValue},set(s){m("update:modelValue",s)}});return(s,g)=>{const f=R("BaseFormItem"),S=R("el-col");return B(),j(S,{class:"query-fields"},{default:P(()=>[q(f,{style:{width:"100%"},className:s.className,field:s.field,inputDebounce:s.inputDebounce,size:s.size,onChange:g[0]||(g[0]=(c,r)=>m("change",c,r)),modelValue:I(o)[s.field.prop],"onUpdate:modelValue":g[1]||(g[1]=c=>I(o)[s.field.prop]=c)},{custom:P(({field:c})=>[te(s.$slots,"custom",{field:c},void 0,!0)]),_:3},8,["className","field","inputDebounce","size","modelValue"])]),_:3})}}});const Ne=ce(Nt,[["__scopeId","data-v-626d6534"]]),Oe=Y({__name:"QueryBtns",props:{isFold:{type:Boolean,default:!0},loading:{type:Boolean},showFoldBtn:{type:Boolean}},emits:["submit","reset","fold"],setup(A,{emit:N}){const z=N;return(m,o)=>{const s=R("BaseIcon"),g=R("el-button"),f=R("el-col"),S=Le("debounce");return B(),j(f,{class:"query-btns f-fe-fs"},{default:P(()=>[Me((B(),j(g,{type:"primary",disabled:m.loading},{icon:P(()=>[q(s,{class:ve({rotate:m.loading}),name:m.loading?"Loading":"Search"},null,8,["class","name"])]),default:P(()=>[ue("搜索")]),_:1},8,["disabled"])),[[S,()=>z("submit"),void 0,{immediate:!0}]]),q(g,{icon:I(Ke),onClick:o[0]||(o[0]=c=>z("reset")),disabled:m.loading},{default:P(()=>[ue("重置")]),_:1},8,["icon","disabled"]),m.showFoldBtn?(B(),j(g,{key:0,onClick:o[1]||(o[1]=c=>z("fold")),text:"",type:"primary"},{icon:P(()=>[q(s,{name:"ArrowDown",class:ve({"rotate-180":!m.isFold,"icon-fold":!0})},null,8,["class"])]),default:P(()=>[ue(" "+Be(m.isFold?"展开":"折叠"),1)]),_:1})):le("",!0)]),_:1})}}}),Ot={},Dt={class:"f-fs-fs"},Et={class:"sec-label f-0"},Mt={class:"sec-fields f-fs-fs-w f-1"},Lt=Y({__name:"Index",props:re({modelValue:{},fields:{},sections:{},loading:{type:Boolean},rowNum:{},extraParams:{},inputDebounce:{type:Boolean},colSpanAttrs:{},isCompact:{type:Boolean},noFieldsHide:{type:Boolean}},{fields:()=>[],modelValue:()=>fe({}),noFieldsHide:!0,...Object.assign({rowNum:2},Ot)}),emits:["update:modelValue","search","change","reset"],setup(A,{expose:N,emit:z}){const m={},o=A,s=z;let g=!0;const f=Ee(),S=x(),c=x(2),r=x(!0),u=x([]),D=x([]),M=f.size==="small",G=H(()=>{if(!r.value)return;const{sections:n,rowNum:l}=o;return n?p=>{const i=D.value.length,b=p===i-1;return i<=l?c.value>1?c.value-(b?1:0):1:c.value-(p===l-1?1:0)}:c.value>1?c.value*l-1:1*l}),d=H(()=>{const{sections:n,rowNum:l}=o;if(n){const p=D.value.map((b,w)=>{const L=w===D.value.length-1;return b.fields.length<=c.value-(L?1:0)?1:2});let i=0;for(let b=0;b<p.length;b++)if(i+=p[b],i>l)return!0;return!1}else return u.value.length>c.value*l-1}),h=H({get(){return o.modelValue},set(n){s("update:modelValue",n)}});be(()=>o.fields,n=>{var w;if((w=o.sections)!=null&&w.length)return;const{modelValue:l}=o,p=Ve(n,void 0,l),{data:i,fields:b}=p;u.value=b,ee.merge(h.value,i),s("change",h.value,g?!!l:!1),g=!1},{immediate:!0,deep:!0}),be(()=>o.sections,n=>{if(!n)return;const{modelValue:l}=o;D.value=(n==null?void 0:n.map(p=>{const{label:i,fields:b}=p,w=Ve(b,void 0,l),{data:L,fields:J}=w;return p.fields=J,ee.merge(h.value,L),p}))??[],s("change",h.value,g?!!l:!1),g=!1},{immediate:!0,deep:!0}),yt("resize",()=>c.value=k(),!0);function $(){return r.value?(c.value>1?o.rowNum:o.rowNum+1)*(M?28:40)+"px":"35vh"}function O(){const{fields:n,isCompact:l,sections:p}=o;let i=1;if(p){const b=p.map((w,L)=>Pe(w.fields,M?.5:l?1:void 0));i=Math.max(...b)}else i=Pe(n,M?.5:l?1:void 0);return Object.assign({labelWidth:i+"em"},m)}function k(){const{colSpanAttrs:n}=o,l={},p=dt();for(const i in n)l[i]=24/n[i];return l[p]}function t(n){const{colSpanAttrs:l}=o,{span:p,type:i}=n;return p?{span:p}:l}function y(){const n=S.value;n&&n.validate((l,p)=>{if(l){const{extraParams:i}=o;s("search",ee.merge({},i,h.value))}else{const i=Object.values(p)[0][0];vt.error(i.message)}})}function a(){var n;(n=S.value)==null||n.resetFields(),s("reset")}return N({formRef:S,fields:u.value}),(n,l)=>{const p=R("el-form");return!n.noFieldsHide||u.value.length||D.value.length?(B(),j(p,T({key:0,class:["query-form",{compact:n.isCompact,small:M}],model:h.value},O(),{ref_key:"formRef",ref:S}),{default:P(()=>[D.value.length?(B(),W("div",{key:0,class:"all-hide-scroll wrap-box",style:Fe({maxHeight:$()})},[(B(!0),W(se,null,ne(D.value.slice(0,r.value?n.rowNum:void 0),(i,b)=>{var w;return B(),W("div",Dt,[ze("div",Et,Be(i.label),1),ze("div",Mt,[(B(!0),W(se,null,ne(i.fields.slice(0,(w=G.value)==null?void 0:w.call(G,b)),(L,J)=>(B(),j(Ne,T({modelValue:h.value,"onUpdate:modelValue":l[0]||(l[0]=K=>h.value=K),field:L,className:M?"mb-qtr":"mb-half",inputDebounce:n.inputDebounce,size:I(f).size,onChange:l[1]||(l[1]=(K,ie)=>s("change",{[K]:ie}))},t(L),{key:J}),{custom:P(({field:K})=>[te(n.$slots,"custom",{field:K,form:h.value},void 0,!0)]),_:2},1040,["modelValue","field","className","inputDebounce","size"]))),128)),(D.value.length<=n.rowNum?b===D.value.length-1:r.value?b===n.rowNum-1:b===D.value.length-1)?(B(),j(Oe,T({key:0},n.colSpanAttrs,{class:[M?"mb-qtr":"mb-half","fold-col"],small:M,loading:n.loading,isFold:r.value,showFoldBtn:d.value,onSubmit:y,onFold:l[2]||(l[2]=L=>r.value=!r.value),onReset:a}),null,16,["class","loading","isFold","showFoldBtn"])):le("",!0)])])}),256))],4)):(B(),W("div",{key:1,class:"f-fs-fs-w wrap-box all-hide-scroll",style:Fe({maxHeight:$()})},[(B(!0),W(se,null,ne(u.value.slice(0,G.value),(i,b)=>(B(),j(Ne,T({modelValue:h.value,"onUpdate:modelValue":l[3]||(l[3]=w=>h.value=w),field:i,className:M?"mb-qtr":"mb-half",inputDebounce:n.inputDebounce,size:I(f).size,onChange:l[4]||(l[4]=(w,L)=>s("change",{[w]:L}))},t(i),{key:b}),{custom:P(({field:w})=>[te(n.$slots,"custom",{field:w,form:h.value},void 0,!0)]),_:2},1040,["modelValue","field","className","inputDebounce","size"]))),128)),q(Oe,T(n.colSpanAttrs,{class:[M?"mb-qtr":"mb-half","fold-col"],loading:n.loading,isFold:r.value,showFoldBtn:d.value,onSubmit:y,onFold:l[5]||(l[5]=i=>r.value=!r.value),onReset:a}),null,16,["class","loading","isFold","showFoldBtn"])],4))]),_:3},16,["class","model"])):le("",!0)}}});const jt=ce(Lt,[["__scopeId","data-v-65361392"]]),xt={},Rt=Y({__name:"Pagination",props:re({currPage:{},pageSize:{},total:{},pageSizes:{}},{...Object.assign({pageSize:10,currPage:1,pageSizes:()=>[10,20,30,50,100]},xt)}),emits:["update:currPage","update:pageSize","update:sizeChange","update:currentChange"],setup(A,{emit:N}){const z={background:!0,layout:"total, sizes, prev, pager, next, jumper"},m=A,o=N,s=H({get:()=>m.currPage,set:f=>o("update:currPage",f)}),g=H({get:()=>m.pageSize,set:f=>o("update:pageSize",f)});return(f,S)=>{const c=R("el-pagination");return B(),j(c,T({class:"f-c-c mt-h f-0",currentPage:s.value,"onUpdate:currentPage":S[0]||(S[0]=r=>s.value=r),pageSize:g.value,"onUpdate:pageSize":S[1]||(S[1]=r=>g.value=r),total:f.total,pageSizes:f.pageSizes,onSizeChange:S[2]||(S[2]=r=>o("update:sizeChange",r)),onCurrentChange:S[3]||(S[3]=r=>o("update:currentChange",r))},z),null,16,["currentPage","pageSize","total","pageSizes"])}}}),qt=Y({__name:"Index",props:re({modelValue:{},rowKey:{},formAttrs:{},tableAttrs:{},pageAttrs:{},disabled:{type:Boolean},groupBtnsAttrs:{},pagination:{type:[Boolean,Object]},fields:{},sections:{},cols:{},selectAll:{type:Boolean},fetch:{},fetchSuccess:{type:Function},fetchFail:{type:Function},immediate:{type:Boolean},extraBtns:{},groupBtns:{type:[Array,Function]},reqMap:{},resMap:{},showPagination:{type:Boolean},summaryList:{type:[Boolean,Function]},sort:{type:Boolean},index:{type:Boolean},selection:{type:Boolean},batchBtn:{type:Boolean},exportLimit:{},extraParams:{},log:{type:Boolean},debug:{type:Boolean},isOmit:{type:Boolean},changeFetch:{type:Boolean},inputDebounce:{type:Boolean},filterByAuth:{type:Function},colSpanAttrs:{},isCompact:{type:Boolean},size:{},rowNum:{},bodySpaceHeight:{type:Boolean},handleReq:{type:Function},handleRes:{type:Function}},{...Object.assign({rowKey:"id",log:!mt,fields:()=>[],cols:()=>[],immediate:!0,changeFetch:!0,batchBtn:!1,isOmit:!0,inputDebounce:!0,exportLimit:1e4,pagination:()=>({currPage:1,pageSize:20}),reqMap:()=>({curr_page:"page",page_size:"pageSize"}),resMap:()=>({curr_page:"currentPage",page_size:"pageSize",total_num:"total",has_more:"hasMore",records:"list"}),showPagination:!0,colSpanAttrs:()=>({xs:12,sm:12,md:8,lg:6,xl:4}),isCompact:A=>A.colSpanAttrs.xl<6,filterByAuth:A=>!0},ot)}),emits:["update:modelValue","extraBtn","groupBtn","selectionChange","rows"],setup(A,{expose:N,emit:z}){const m=x([]),o=A,s=z,g=x(!1),f=De("closePopup"),S=x(null),c=x(null),r=x(null),{reqMap:u,resMap:D,extraParams:M={}}=o,G=o.pagination?{[`${u.curr_page}`]:o.pagination.currPage,[`${u.page_size}`]:o.pagination.pageSize}:{},d={...G,...M},h=fe(ee.cloneDeep(G)),$=fe({total:0,hasMore:!0}),O=x(!1),k=x([]),t=x([]);let y=H({get(){return o.modelValue},set(e){s("update:modelValue",e)}}),a=ee.cloneDeep(d);const n=H(()=>{const{extraBtns:e,disabled:v}=o,V=(e==null?void 0:e.map(_=>{var Q;const C=_e(_),{name:F,attrs:E,customRules:U}=C;return(Q=lt)!=null&&Q.includes(F)&&(C.popconfirm=!1,U?E.disabled=!$.total:E.disabled=!t.value.length),v&&(E.disabled=v),C}))||[];return Ce(V)}),l=H(()=>!!n.value.find(e=>Ge.includes(e.name)&&!e.customRules)),p=H(()=>o.selection||l.value),i=x(o.cols.slice());be(()=>o.extraParams,e=>{ee.merge(a,e),Z(a)},{deep:!0}),ut(()=>{g.value=w("base-dialog")});function b(){Object.assign(h,G),a=ee.cloneDeep(d),Z(a)}function w(e="base-dialog",v=5){let V=!1;_(v);function _(C=0){var E;let F=r.value.parentNode;for(;C>0;)if(F=F==null?void 0:F.parentNode,C--,(E=F==null?void 0:F.classList)!=null&&E.contains(e)){V=!0;break}}return V}function L(e){Object.assign(a,{[`${u.curr_page}`]:1}),Z(a)}function J(e){Object.assign(a,{[`${u.curr_page}`]:1,[`${u.page_size}`]:e}),Z(a)}function K(e){Object.assign(a,{[`${u.curr_page}`]:e}),Z(a)}function ie(e,v){const{immediate:V,changeFetch:_}=o;if(e=ft(e),v)ee.merge(a,e),Object.assign(d,a);else{if(!_)return;Object.assign(a,e,{[`${u.curr_page}`]:1})}V&&Z(a)}function Z(e=a,v){const{fetch:V,handleReq:_,isOmit:C,handleRes:F,selectAll:E,summaryList:U,fetchSuccess:Q,fetchFail:ae,log:de}=o;V&&(O.value=!0,_&&(e=_(e)),C&&(e=Ae(e)),de&&ke(e,"req"),V(e).then(X=>{if(!X)return;F&&(X=F(X));let oe=X[D.records];if(!oe){console.error("响应数据不是标准的分页数据结构，请自测：",X);return}de&&ke(oe,"res");const he=e[u.curr_page];if(U){const ye=ge(U),we=k.value;if(ye==="Boolean")k.value=he===1?oe:[...we,...oe];else if(ye==="Function")k.value=U(he,we,oe);else throw new Error(`暂未处理此种类型：${ye}`)}else k.value=oe;Object.assign($,{total:X[D.total_num],hasMore:X[D.has_more]}),Object.assign(h,{[u.curr_page]:he,[u.page_size]:e[u.page_size]}),E&&(t.value=oe),Q==null||Q(X),s("rows",k.value,e),v==null||v()}).catch(X=>{ae==null||ae(X)}).finally(()=>{O.value=!1}))}function Re(e){const{rowKey:v,exportLimit:V}=o,{text:_}=e;st({btnObj:e,cols:m.value,seledRows:t.value,seledKeys:t.value.map(C=>C[v]),total:$.total,exportLimit:V,emits:s,next:(C=`${_||"操作"}成功`,F,E,U=!0)=>{ht(C),f(F),U&&pe(),p.value&&S.value.clearSelection(),E==null||E()}})}function Se(e,v,V,_=!0){const{name:C,text:F}=e;s("groupBtn",C,v,(E,U,Q)=>{V(E,U,Q),_&&pe()})}function qe(e,v){t.value=e,s("selectionChange",e,v)}function Ce(e=[]){const{filterByAuth:v}=o;return v?e.filter(({auth:V})=>V!=null&&V.length?v(V):!0):e}function pe(e){Z(a,e)}return N({refreshList:pe,getList:Z,getQueryParams(e=o.isOmit){return e?Ae(a):a},getQueryFields(e=[u.curr_page,u.page_size]){const v=[],V=[],_=c.value.fields;_.forEach(C=>{var F;(F=C.prop)!=null&&F.includes($e)&&V.push(C.prop)});for(const C in a)if(e&&!e.includes(C)){const F=_.find(E=>E.prop===C);if(F){const E=a[C];(ge(E)!=="Array"||E.some(Q=>Q!==""))&&v.push({label:F.label,value:nt(F,E)})}}return V.forEach(C=>{const[F,E]=C.split($e),U=a[F],Q=a[E],ae=_.find(de=>de.prop.includes(C));ae&&(U||Q)&&v.push({label:ae.label,value:[U,Q].join(gt)})}),v}}),(e,v)=>{var V;return B(),W("div",{class:"base-crud f-fs-s-c",ref_key:"baseCrudRef",ref:r},[q(jt,T({class:["f-0",e.size==="small"?"mb-6":"mb-h"],modelValue:I(y),"onUpdate:modelValue":v[0]||(v[0]=_=>ct(y)?y.value=_:y=_),disabled:e.disabled,fields:e.fields,sections:e.sections,loading:O.value,inputDebounce:e.inputDebounce,colSpanAttrs:e.colSpanAttrs,isCompact:e.isCompact,onReset:b,onSearch:L,onChange:ie,size:e.size,rowNum:e.rowNum},e.formAttrs,{ref_key:"queryFormRef",ref:c}),{custom:P(({field:_,form:C})=>[te(e.$slots,_.prop,{field:_,form:C},void 0,!0)]),_:3},16,["class","modelValue","disabled","fields","sections","loading","inputDebounce","colSpanAttrs","isCompact","size","rowNum"]),te(e.$slots,"middle",{},void 0,!0),n.value.length?(B(),j(At,{key:0,class:ve(["f-0",e.size==="small"?"mb-q":"mb-h"]),columns:i.value,allColumns:m.value,btns:n.value,isEmpty:!((V=k.value)!=null&&V.length),"onUpdate:cols":v[1]||(v[1]=_=>{i.value=_}),onClick:Re,total:$.total,batchBtn:e.batchBtn&&e.selection,size:e.size},null,8,["class","columns","allColumns","btns","isEmpty","total","batchBtn","size"])):le("",!0),te(e.$slots,"default",{loading:O.value,rows:k.value,total:$.total,hasMore:$.hasMore,params:I(a),onGroupBtn:Se},()=>[q(Vt,T({groupBtnsAttrs:e.groupBtnsAttrs,loading:O.value,cols:i.value,rows:k.value,total:$.total,sort:e.sort,index:e.index,selection:p.value,groupBtns:e.groupBtns,bodySpaceHeight:e.bodySpaceHeight||g.value,currPage:e.pagination?h[I(u).curr_page]:1,pageSize:e.pagination?h[I(u).page_size]:20,filterBtnsByAuth:Ce,refreshList:pe,onGroupBtn:Se,onSelectionChange:qe,"onUpdate:cols":v[2]||(v[2]=_=>{m.value=_}),disabled:e.disabled},e.tableAttrs,{size:e.size,ref_key:"queryTableRef",ref:S}),{custom:P(({row:_,col:C,$index:F})=>[te(e.$slots,C.prop,je(xe({row:_,col:C,$index:F})),void 0,!0)]),_:3},16,["groupBtnsAttrs","loading","cols","rows","total","sort","index","selection","groupBtns","bodySpaceHeight","currPage","pageSize","disabled","size"])],!0),e.pagination&&e.showPagination?(B(),j(Rt,T({key:1},e.pageAttrs,{currPage:h[I(u).curr_page],"onUpdate:currPage":v[3]||(v[3]=_=>h[I(u).curr_page]=_),pageSize:h[I(u).page_size],"onUpdate:pageSize":v[4]||(v[4]=_=>h[I(u).page_size]=_),total:$.total,onSizeChange:J,onCurrentChange:K,small:e.size==="small"}),null,16,["currPage","pageSize","total","small"])):le("",!0)],512)}}});const po=ce(qt,[["__scopeId","data-v-361e993e"]]);export{po as default};

var e;import{M as a,ak as s,aK as l,c9 as t,cp as o,cr as n,co as i,aM as u,aR as c,aE as r,u as d,I as p,bx as m,H as f,ao as h,bc as b,bK as v,bN as V,bH as g}from"./index-050c1617.js";const y={class:"upload-file f-fs-c"},z=g(a({__name:"UploadFile",props:s({modelValue:{},size:{},showFileList:{type:Boolean},drag:{type:Boolean},accept:{},limitSize:{},action:{},showTips:{type:Boolean},handleSuccessRes:{type:Function}},Object.assign({modelValue:()=>l({name:"",url:""}),size:80,showFileList:!1,limitSize:10485760,action:"/proxy/common/uploadImage",showTips:!0,handleSuccessRes:e=>e.path},null==(e=t)?void 0:e.BaseCrud)),emits:["update:modelValue","change"],setup(e,{emit:a}){const s=e,l=a,{formItem:t}=o(),{value:g}=n();i(s.size);const z=u(s.modelValue||{url:"",name:""});computed((()=>{const{accept:e,limitSize:a}=s;return`仅支持${I(e)}，不超过${$(a)}`}));const w=e=>{const{limitSize:a,accept:l}=s,{type:t,size:o}=e,n=function(e,a){let s="";if(!e)return s;const l=e.split(",");l.includes(a)||(s=`仅支持上传${I(e)}格式的文件`);return s}(l,t)||function(e,a){return a>e?`文件大小不能超过${$(e)}`:""}(a,o);return!n||(V.error(n),!1)},x=e=>{},F=(e,a)=>{const{code:o,message:n,data:i}=e;if(1e3===o){const e=s.handleSuccessRes(i),o=a.name.lastIndexOf("."),n=a.name.slice(0,o),u={url:e,name:n};z.value={url:e,name:n},l("update:modelValue",u),null==t||t.validate("blur"),l("change",z)}else V.error(n)},S=e=>{};function I(e){return e.split(",").map((e=>e.split("/")[1])).join("，")}function $(e){let a=e/1024,s="";return a<1024?s=`${a.toFixed(1)}kb`:(a/=1024,s=`${a.toFixed(1)}Mb`),s}return(e,a)=>{const s=c("el-input"),t=c("el-button"),o=c("el-upload");return r(),d("div",y,[p(s,{placeholder:"请点击右侧按钮选择文件",clearable:"",modelValue:z.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>z.value.name=e),disabled:!z.value.url,onClear:a[1]||(a[1]=e=>l("update:modelValue",{name:"",url:""}))},null,8,["modelValue","disabled"]),p(o,{class:h(["upload f-c-c",{disabled:b(g)}]),action:e.action,"show-file-list":e.showFileList,"before-upload":w,"on-progress":x,"on-success":F,"on-error":S,headers:{token:b(v).getItem("token"),source:1}},{default:m((()=>[p(t,{type:"primary"},{default:m((()=>[f("选择文件")])),_:1})])),_:1},8,["class","action","show-file-list","headers"])])}}}),[["__scopeId","data-v-820f5fde"]]);export{z as default};

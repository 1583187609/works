import{M as ee,aa as te,aM as g,aK as S,bZ as V,bs as se,aR as i,aS as ae,aE as o,s as f,bx as l,am as x,I as k,u as p,F as w,aP as oe,ap as j,A as le,v as ne,t as q,H as _,b3 as B,aQ as re,bc as C,cO as ie,bz as de,ao as ce,cG as ue,bN as $,bH as fe}from"./index-0bf49a0e.js";import{d as pe,b as me}from"./_config-02df11e8.js";const _e={key:0,class:"required"},be={key:1,class:"f-c-c"},ye={key:2,class:"f-c-c f-0 pt-h pb-h",style:{width:"100%"}},ve=1,he=ee({__name:"EditTable",props:{cols:{default:()=>[]},rows:{default:()=>[]},footer:{type:Boolean,default:!0},text:{type:Boolean,default:!1},request:{},total:{},currPage:{},pageSize:{},pageAttrs:{},submitText:{default:"提交"},resetText:{default:"重置"},index:{type:Boolean},extraParams:{},autoAddRow:{type:Boolean,default:!1},submitCb:{}},emits:["submit","update:rows"],setup(z,{expose:D,emit:L}){const n=z,E=L,O=te("closePopup"),b=g(null),d=g(!1),c=g(n.rows),{extraParams:ge,submitText:P,submitCb:T,index:H,cols:v}=n,M=S(V.merge({maxHeight:`calc(100% + ${ve*36}px)`},pe));H&&(v.slice(0,2).find(e=>e.type==="index")||v.unshift({prop:"$index",label:"序号",type:"index",fixed:"left",width:58,index:1}));const A=S(v.map(e=>{const{type:r}=(e==null?void 0:e.field)||{};let s={};return r==="operate"&&(s={prop:"$operate",fixed:"right",width:80}),e=V.merge(s,me,e),e}));function U(e,r){const{field:s,label:a,prop:u="",...I}=e,h=`${r}[${u}]`;return s.prop=h,s}se(c,(e=[])=>{if(!e.length&&n.autoAddRow&&!Object.values(e.slice(-1)[0]).every(a=>a==="")){const a={};Object.keys(e.slice(-1)[0]).forEach(u=>{a[u]=""}),e.push(a)}E("update:rows",e)},{immediate:!0,deep:!0});function G(e){c.value.splice(e,1)}const K=()=>{const e=b.value;e&&e.validate((r,s)=>{if(r){const a=c.value.slice(0,-1);n!=null&&n.request?(d.value=!0,n.request(a).then(u=>{$.success(P+"成功"),T?T():O()}).finally(()=>{d.value=!1})):E("submit",a)}else{const a=Object.values(s)[0][0];$.error(a.message)}})},Q=()=>{const e=b.value;e&&e.resetFields()};return D({formRef:b}),(e,r)=>{const s=i("el-button"),a=i("BaseFormItem"),u=i("el-table-column"),I=i("BaseEmpty"),h=i("el-table"),Z=i("BaseIcon"),J=i("el-form"),W=ae("debounce");return o(),f(J,{ref_key:"formRef",ref:b,class:"edit-table f-fs-s-c",model:c.value},{default:l(()=>[A.length?(o(),f(h,x({key:0,data:c.value},M,{class:"table"}),{empty:l(()=>[k(I)]),default:l(()=>[(o(!0),p(w,null,oe(A,(t,X)=>(o(),f(u,j(x({key:X},t)),le({header:l(({row:y,colum:Y,$index:m})=>[ne("span",null,[t.required?(o(),p("span",_e,"*")):q("",!0),_(" "+B(t.label),1)])]),_:2},[t.field?{name:"default",fn:l(({row:y,column:Y,$index:m})=>{var F,N;return[((F=t==null?void 0:t.field)==null?void 0:F.type)==="custom"?re(e.$slots,t.prop,j(x({key:0},{row:y,col:t,$index:m})),void 0,!0):((N=t==null?void 0:t.field)==null?void 0:N.type)==="operate"?(o(),p(w,{key:1},[m<c.value.length-1?(o(),f(s,{key:0,icon:C(ie),type:"danger",link:"",onClick:R=>G(m)},{default:l(()=>[_("删除")]),_:2},1032,["icon","onClick"])):(o(),p(w,{key:1},[_("-")],64))],64)):(o(),f(a,{key:2,field:U(t,m),modelValue:y[t.prop],"onUpdate:modelValue":R=>y[t.prop]=R},null,8,["field","modelValue","onUpdate:modelValue"]))]}),key:"0"}:void 0]),1040))),128))]),_:3},16,["data"])):(o(),p("div",be,"空空如也~")),!e.text&&e.footer?(o(),p("div",ye,[de((o(),f(s,{type:"primary",disabled:d.value},{icon:l(()=>[k(Z,{class:ce({rotate:d.value}),name:d.value?"Loading":"Promotion"},null,8,["class","name"])]),default:l(()=>[_(" "+B(C(P)),1)]),_:1},8,["disabled"])),[[W,K,void 0,{immediate:!0}]]),k(s,{icon:C(ue),onClick:Q,disabled:d.value},{default:l(()=>[_(B(e.resetText),1)]),_:1},8,["icon","disabled"])])):q("",!0)]),_:3},8,["model"])}}});const we=fe(he,[["__scopeId","data-v-c7366af1"]]);export{we as default};

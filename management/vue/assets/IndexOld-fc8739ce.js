import{M as e,c5 as t,c4 as a,aa as s,aM as o,aK as r,bZ as u,q as n,aR as l,aS as p,aE as i,u as c,I as m,bx as d,aQ as f,am as g,bc as _,af as v,s as B,t as y,bz as h,F as b,aP as j,cf as x,cd as $,c9 as S,ce as w,bH as P}from"./index-31bd5f7b.js";import{_ as A}from"./Index.vue_vue_type_script_setup_true_lang-48163982.js";import z from"./Index-db944f57.js";import{_ as k}from"./Pagination.vue_vue_type_script_setup_true_lang-ff9d0e9c.js";import{b as I}from"./_config-0a862e30.js";import{g as G}from"./index-3780be65.js";import M from"./AvatarItem-7a1d7fd4.js";import C from"./AboutItem-504f0e0f.js";import D from"./FaceItem-98666fee.js";import F from"./PhotoItem-3524b8f9.js";import{a as V}from"./_utils-18cac365.js";import{b as O,a as E,h as R}from"./_utils-0af7a6f9.js";import"./SetTable.vue_vue_type_script_setup_true_lang-2e4440c8.js";import"./BaseTable-14b98eb1.js";import"./Column.vue_vue_type_script_name_Column_setup_true_lang-db5033e5.js";import"./GroupBtns-c1b5c996.js";import"./cascader-bca925ec.js";import"./BaseRender.vue_vue_type_script_setup_true_lang-a705a252.js";import"./_utils-98259d43.js";import"./SetPrint-4800bbf1.js";import"./BatchBtns.vue_vue_type_script_setup_true_lang-4de00e17.js";import"./QueryFields-ae7cf3ea.js";import"./QueryBtns.vue_vue_type_style_index_0_lang-37ae20cd.js";import"./_utils-595c60d1.js";import"./_config-c0994392.js";import"./BarsImg-860e42cf.js";const q={class:"card-crud f-fs-s-c"},K={class:"list-box f-fs-fs-w f-1"},U="status",L=P(e({__name:"IndexOld",props:{modelValue:{},formAttrs:{},pageAttrs:{default:()=>({pageSizes:[10,15,20,25,30]})},pagination:{type:[Boolean,Object],default:()=>({currPage:1,pageSize:15})},type:{default:"avatar-audit"},rowKey:{default:"id"},fields:{default:()=>[]},fetch:{},fetchSuccess:{},fetchFail:{},groupBtns:{},immediate:{type:Boolean,default:!0},extraBtns:{},reqMap:{default:t},resMap:{default:t},batchBtn:{type:Boolean,default:!1},extraParams:{},log:{type:Boolean,default:!a},debug:{type:Boolean},isOmit:{type:Boolean,default:!0},changeFetch:{type:Boolean,default:!0},inputDebounce:{type:Boolean,default:!0},filterByAuth:{type:Function,default:e=>!0},colSpanAttrs:{default:I},compact:{type:Boolean,default:e=>e.colSpanAttrs.xl<6}},emits:["update:modelValue","extraBtn","groupBtn","selectionChange"],setup(e,{expose:t,emit:a}){const P=s("closePopup"),I=e,L=a,Q=o(null),{immediate:T,exportLimit:W,pagination:Y,fetch:Z,fetchSuccess:H,fetchFail:X,extraParams:J,log:N,debug:ee}=I;let{reqMap:te,resMap:ae}=I;const se=Y?{[`${te.curr_page}`]:Y.currPage,[`${te.page_size}`]:Y.pageSize}:{},oe={...se,...J},re=r(u.cloneDeep(se)),ue=o(!1),ne=o([]);let le=n({get:()=>I.modelValue,set(e){L("update:modelValue",e)}});const pe=n((()=>ne.value.filter(((e,t)=>2===e[U])))),ie=n((()=>pe.value.map((e=>e[I.rowKey])))),ce=n((()=>ne.value.map(((e,t)=>e[U]))));let me=o(0),de=u.cloneDeep(oe);const fe=n((()=>{var e;return!(null==(e=ne.value)?void 0:e.length)})),ge=n((()=>{var e;return(null==(e=I.extraBtns)?void 0:e.map((e=>{var t;const a=G(e);return(null==(t=O)?void 0:t.includes(a.name))&&(a.popconfirm=!1,a.attrs.disabled=!pe.value.length),a})))||[]}));function _e(e,t){const{groupBtns:a}=I;return Se(E(e,t,a))}function ve(e){const{text:t}=e;R({btnObj:e,seledRows:pe.value,seledKeys:ie.value,total:me.value,exportLimit:W,emits:L,next:(e=`${t||"操作"}成功`,a,s)=>{x(e),P(a),we(),null==s||s()}})}function Be(e,t){const{name:a,text:s}=e,{$index:o}=t;L("groupBtn",a,t,((e=`${s||"操作"}成功！`,t,r)=>{x(e),P(t);we([o,{pass:0,reject:1}[a]]),null==r||r()}),de)}function ye(){u.merge(re,se),de=u.cloneDeep(oe),$e(de)}function he(e){de=u.merge({},de,{[`${te.curr_page}`]:1}),re[te.curr_page]=1,$e(de)}function be(e){re[te.curr_page]=1,u.merge(de,{[`${te.curr_page}`]:1,[`${te.page_size}`]:e}),$e(de)}function je(e){re[te.curr_page]=e,de=u.merge({},de,{[`${te.curr_page}`]:e}),$e(de)}function xe(e,t){if(e=$(e),t)u.merge(de,e),Object.assign(oe,de);else{if(!I.changeFetch)return;Object.assign(de,e,{[`${te.curr_page}`]:1}),re[te.curr_page]=1}T&&$e(de)}function $e(e=de,t){Z&&(ue.value=!0,I.isOmit&&(e=S(e)),(N||ee)&&(w(e,"req"),ee)||Z(e).then((e=>{const a=e[ae.records];N&&w(a,"res"),me.value=e[ae.total_num],ne.value=a,null==H||H(e),null==t||t()})).catch((e=>{null==X||X(e)})).finally((()=>{ue.value=!1})))}function Se(e=[]){const{filterByAuth:t}=I;return t?e.filter((({auth:e})=>!(null==e?void 0:e.length)||t(e))):e}function we(e,t){const{type:a}=I;if("avatar-audit"===a){if(e){const[t,a]=e;ne.value[t][U]=a}!ne.value.filter((e=>2===e[U])).length&&$e(de,t)}else $e(de,t)}return t({refreshList:we}),(e,t)=>{const a=l("BaseEmpty"),s=p("loading");return i(),c("div",q,[m(z,g({class:"f-0"},e.formAttrs,{fields:e.fields,modelValue:_(le),"onUpdate:modelValue":t[0]||(t[0]=e=>v(le)?le.value=e:le=e),loading:ue.value,inputDebounce:e.inputDebounce,colSpanAttrs:e.colSpanAttrs,compact:e.compact,onReset:ye,onSearch:he,onChange:xe}),{custom:d((({field:t,form:a})=>[f(e.$slots,t.prop,{field:t,formData:a},void 0,!0)])),_:3},16,["fields","modelValue","loading","inputDebounce","colSpanAttrs","compact"]),f(e.$slots,"middle",{},void 0,!0),ge.value.length?(i(),B(A,g({key:0,class:"mb-h f-0",btns:Se(ge.value),isEmpty:fe.value,onClick:ve,total:_(me),toolBtns:[]},Q.value),null,16,["btns","isEmpty","total"])):y("",!0),h((i(),c("div",K,[(i(!0),c(b,null,j(ne.value,((t,a)=>(i(),c(b,{key:a},[["avatar-audit","avatar-patrol"].includes(e.type)?(i(),B(M,{key:0,class:"item",row:_(V)({...t,$index:a}),withMask:"avatar-audit"===e.type&&[2,""].includes(_(le).status),status:ce.value[a],groupBtns:_e(t,a),onGroupBtn:e=>Be(e,{...t,$index:a}),isPatrol:"avatar-patrol"===e.type},null,8,["row","withMask","status","groupBtns","onGroupBtn","isPatrol"])):"about"===e.type?(i(),B(C,{key:1,class:"item",row:{...t,$index:a},status:ce.value[a],groupBtns:_e(t,a),onGroupBtn:e=>Be(e,{...t,$index:a}),bottomBar:1===ce.value[a]?t.reason||"~原因为空~":""},null,8,["row","status","groupBtns","onGroupBtn","bottomBar"])):"face"===e.type?(i(),B(D,{key:2,class:"item",row:{...t,$index:a},status:ce.value[a],groupBtns:_e(t,a),onGroupBtn:e=>Be(e,{...t,$index:a}),bottomBar:1===ce.value[a]?t.rejectReason||"~原因为空~":""},null,8,["row","status","groupBtns","onGroupBtn","bottomBar"])):"photo"===e.type?(i(),B(F,{key:3,class:"item",row:{...t,$index:a},status:ce.value[a],groupBtns:_e(t,a),onGroupBtn:e=>Be(e,{...t,$index:a})},null,8,["row","status","groupBtns","onGroupBtn"])):y("",!0)],64)))),128)),ue.value||ne.value.length?y("",!0):(i(),B(a,{key:0}))])),[[s,ue.value]]),_(Y)?(i(),B(k,g({key:1},e.pageAttrs,{currPage:re[_(te).curr_page],"onUpdate:currPage":t[1]||(t[1]=e=>re[_(te).curr_page]=e),pageSize:re[_(te).page_size],"onUpdate:pageSize":t[2]||(t[2]=e=>re[_(te).page_size]=e),total:_(me),onSizeChange:be,onCurrentChange:je}),null,16,["currPage","pageSize","total"])):y("",!0)])}}}),[["__scopeId","data-v-782701dc"]]);export{L as default};

import{ar as ut,M as J,ak as le,c2 as ae,aM as D,s as M,bx as F,aR as j,aE as B,I as q,am as T,u as U,bH as ue,aP as ne,H as ie,b3 as Be,F as oe,bc as L,c3 as ct,q as Q,t as se,aa as et,ao as ve,c4 as pt,c5 as dt,c6 as mt,c7 as ft,bd as tt,aK as me,bt as gt,bz as nt,A as ht,aS as ot,aQ as ee,ap as st,a3 as lt,c1 as ye,c8 as vt,c9 as yt,bs as be,bL as bt,ca as Bt,cb as we,v as ze,aq as Fe,cc as Z,bN as _t,cd as St,ce as Ct,cf as wt,cg as zt,ax as Ft,ch as Pe,ci as Ae,cj as Pt,ck as At,af as kt,cl as Vt,cm as ke,cn as $t}from"./index-8b36bd1b.js";import{g as at}from"./index-fc466e0a.js";import{B as Ot,_ as Nt,g as Mt,n as de,a as Et,d as Rt,b as Dt,c as jt,e as Lt,f as qt,h as Tt,i as Ve}from"./BaseTable-64f46e89.js";import{h as $e}from"./_utils-74d46e39.js";import{d as xt}from"./_config-c76f4e31.js";import"./cascader-261a3ee6.js";import"./BaseRender.vue_vue_type_script_setup_true_lang-a774565d.js";const It=()=>{let P=null,V=0;function w(o,s){let c=o.target;if(s&&(c=c.querySelector(s)),!c)return;const{scrollTop:f}=c;!P&&(P=c),V=f}return ut(()=>{P==null||P.scrollTo(0,V)}),{handleScroll:w}};var Me,Ee,Re;const Ut=J({__name:"SetTable",props:le({rows:{},size:{},handleShowChange:{type:Function},handleExportChange:{type:Function},handleOrderChange:{type:Function},handleResetColSet:{type:Function}},Object.assign({rows:()=>[]},(Re=(Ee=(Me=ae)==null?void 0:Me.BaseCrud)==null?void 0:Ee._components)==null?void 0:Re.SetTable)),setup(P){const V={inlinePrompt:!0,activeText:"是",inactiveText:"否"},w=D(Date.now()),o=[{prop:"colName",label:"列名",minWidth:110},{prop:"isShow",label:"是否显示",minWidth:70,type:"custom"},{prop:"isExport",label:"是否导出",minWidth:70,type:"custom"},{prop:"isOrder",label:"是否排序",minWidth:70,type:"custom"}];return(s,c)=>{const f=j("el-switch");return B(),M(Ot,{style:{width:"400px"},cols:o,rows:s.rows,submitText:"确定",key:w.value,size:s.size},{isShow:F(({row:i,col:S,$index:a})=>[q(f,T({onChange:h=>s.handleShowChange(i.colProp,h,a),modelValue:i.isShow,"onUpdate:modelValue":h=>i.isShow=h},V),null,16,["onChange","modelValue","onUpdate:modelValue"])]),isExport:F(({row:i,col:S,$index:a})=>[q(f,T({onChange:h=>s.handleExportChange(i.colProp,h,a),modelValue:i.isExport,"onUpdate:modelValue":h=>i.isExport=h},V,{disabled:""}),null,16,["onChange","modelValue","onUpdate:modelValue"])]),isOrder:F(({row:i,col:S,$index:a})=>[q(f,T({onChange:h=>s.handleOrderChange(i.colProp,h,a),modelValue:i.isOrder,"onUpdate:modelValue":h=>i.isOrder=h},V,{disabled:""}),null,16,["onChange","modelValue","onUpdate:modelValue"])]),_:1},8,["rows","size"])}}}),Qt={class:"base-print"},Wt=J({__name:"SetPrint",setup(P){return(V,w)=>(B(),U("div",Qt,"base-print.vue"))}});const Kt=ue(Wt,[["__scopeId","data-v-83cd6022"]]);var De,je,Le;const Ht=J({__name:"BatchBtns",props:le({disabled:{type:Boolean},allSelection:{type:Function},clearSelection:{type:Function},invertSelection:{type:Function}},Object.assign({},(Le=(je=(De=ae)==null?void 0:De.BaseCrud)==null?void 0:je._components)==null?void 0:Le.BatchBtns)),setup(P){const V=[{name:"all",text:"全选",attrs:{type:"success",plain:!0}},{name:"not",text:"全不选",attrs:{type:"danger",plain:!0}},{name:"invert",text:"反选",attrs:{type:"info",plain:!0}}],w=P;function o(s){console.log(s,"name-------------"),s==="all"?console.log(w.allSelection(),"allSelection----------------"):s==="not"?console.log(w.clearSelection(),"notSelection----------------"):s==="invert"?console.log(w==null?void 0:w.invertSelection(),"notSelection----------------"):console.error("不存在该name值：",s)}return(s,c)=>{const f=j("el-button"),i=j("el-dropdown-item"),S=j("el-dropdown-menu"),a=j("el-dropdown");return B(),M(a,{class:"batch-btns"},{dropdown:F(()=>[q(S,null,{default:F(()=>[(B(),U(oe,null,ne(V,(h,u)=>q(i,{key:u},{default:F(()=>[q(f,T({onClick:E=>o(h.name),style:{width:"100%"}},h.attrs),{default:F(()=>[ie(Be(h.text),1)]),_:2},1040,["onClick"])]),_:2},1024)),64))]),_:1})]),default:F(()=>[q(f,{disabled:s.disabled,icon:L(ct),type:"primary"},{default:F(()=>[ie("批量")]),_:1},8,["disabled","icon"])]),_:1})}}}),Gt={class:"extra-btns f-fs-c-w"};var qe,Te,xe;const Jt=J({__name:"Index",props:le({columns:{},allColumns:{},btns:{},toolBtns:{},total:{},isEmpty:{type:Boolean},batchBtn:{type:Boolean},size:{},allSelection:{type:Function},clearSelection:{type:Function},invertSelection:{type:Function}},Object.assign({columns:()=>[],allColumns:()=>[],btns:()=>[],toolBtns:()=>["set"]},(xe=(Te=(qe=ae)==null?void 0:qe.BaseCrud)==null?void 0:Te._components)==null?void 0:xe.ExtraBtns)),emits:["click","toolBtn","update:cols"],setup(P,{emit:V}){const w={print:{name:"print",title:"打印",attrs:{type:"primary",icon:dt,plain:!0,circle:!0}},set:{name:"colSet",title:"设置",attrs:{type:"primary",icon:mt,plain:!0,circle:!0}}},o=P,s=V,c=et("openPopup"),f=Q(()=>{const r=o.btns.map(k=>at(k));return pt(r),r}),i=Q(()=>o.toolBtns.map(r=>w[r]));function S(r){s("click",r)}function a(r){r==="colSet"?W():r==="print"&&c("打印设置",Kt,"dialog")}function h(r,k,A){const{columns:n,allColumns:d}=o;if(k){let g=-1;n.findIndex((y,e)=>{const l=d.findIndex(p=>p.prop===y.prop);if(l>A)return g=e,!0;if(l<A)return e===n.length-1?(g=n.length,!0):!1}),n.splice(g,0,d[A])}else{const g=n.findIndex(y=>y.prop===r);n.splice(g,1)}s("update:cols",n.slice())}function u(r,k,A){console.log(r,k,A,"ddddd--------------------")}function E(r,k,A){console.log(r,k,A,"ddddd--------------------")}function W(){const{columns:r,allColumns:k}=o,A=k.filter(n=>{var d;return!((d=n.prop)!=null&&d.startsWith("$"))}).map(n=>{const{prop:d,label:g,sortable:y=!1}=n;return{colName:g,colProp:d,isShow:!!r.find(e=>e.prop===d),isExport:!0,isOrder:y}});c("列设置",{component:Ut,attrs:{rows:A,size:o.size,handleShowChange:h,handleExportChange:u,handleOrderChange:E,handleResetColSet:K}},"drawer")}function K(){s("update:cols",o.allColumns.slice()),setTimeout(()=>{W()})}return(r,k)=>{const A=j("BaseBtn"),n=j("el-button"),d=j("el-tooltip");return B(),U("div",Gt,[r.batchBtn?(B(),M(Ht,{key:0,class:"mr-12",allSelection:r.allSelection,clearSelection:r.clearSelection,invertSelection:r.invertSelection,size:r.size,disabled:!r.total},null,8,["allSelection","clearSelection","invertSelection","size","disabled"])):se("",!0),(B(!0),U(oe,null,ne(f.value,(g,y)=>(B(),M(A,{onClick:e=>S(g),class:ve(r.size==="small"?"mb-q":"mb-h"),name:g,size:r.size,key:y},null,8,["onClick","class","name","size"]))),128)),(B(!0),U(oe,null,ne(i.value,(g,y)=>(B(),M(d,{content:g.title,"show-after":500,key:y},{default:F(()=>[q(n,T({style:{marginLeft:y===0?"auto":void 0},size:r.size,onClick:e=>a(g.name)},g.attrs),null,16,["style","size","onClick"])]),_:2},1032,["content"]))),128))])}}});var Ie,Ue,Qe;const Xt=J({__name:"QueryTable",props:le({tableAttrs:{},groupBtnsAttrs:{},loading:{type:Boolean},cols:{},rows:{},groupBtns:{type:[Array,Function]},sort:{type:Boolean},index:{type:Boolean},disabled:{type:Boolean},selection:{type:Boolean},showSummary:{type:Boolean},currPage:{},pageSize:{},refreshList:{type:Function},summaryMethod:{type:Function},filterBtnsByAuth:{type:Function}},Object.assign({cols:()=>[],rows:()=>[],summaryMethod:ft},(Qe=(Ue=(Ie=ae)==null?void 0:Ie.BaseCrud)==null?void 0:Ue._components)==null?void 0:Qe.QueryTable)),emits:["update:cols","selectionChange","groupBtn","change"],setup(P,{expose:V,emit:w}){const o=P,s=w,c=tt(),{handleScroll:f}=It();let i=0,S=o.showSummary?2:1;const a=D(null),h=D([]),u=me([]);gt(()=>{const{cols:n,currPage:d,pageSize:g}=o,y=Mt(d,g),{index:e,sort:l,selection:p,operate:m}=y;de("index",o)&&n.unshift(e),de("sort",o)&&n.unshift(l),de("selection",o)&&n.unshift(p),de("operate",o)&&n.push(m);const b=n.map(R=>{if(ye(R)!=="Object")return 1;const{col:H,level:X}=Et(R,1,y,Rt,c.size==="small");return u.push(H),X}),C=Math.max(...b);S+=C-1,s("update:cols",u)})();const W=Q(()=>{const{showSummary:n,summaryMethod:d}=o;return Object.assign({maxHeight:`calc(100% + ${S*40}px)`},Dt,{showSummary:n,summaryMethod:d})});function K(n,{row:d,col:g,$index:y},e){s("groupBtn",n,{$index:y,...d},e)}function r(n){h.value=n;const d=n.map(g=>g[W.value.rowKey]);s("selectionChange",n,d)}function k(n,d){const{groupBtns:g=[],rows:y,filterBtnsByAuth:e}=o,l=jt(n,d,g),p=A(l);return i<p&&(i=p,u.slice(-1)[0].minWidth=i),d===y.length-1&&i<30&&(i=A(),u.slice(-1)[0].minWidth=i),e(l)}function A(n){if(!n)return 66;let l=0,p=0;const{vertical:m,maxNum:b=vt}=o.groupBtnsAttrs||{};return n.length>b&&(n=n.slice(0,b-1).concat([{text:"更多"}])),m?n.forEach((C,R)=>{l=C.text.replace(/[^\x00-\xff]/g,"**").length/2+1;const H=l*12+3*2+12*2;H>p&&(p=H)}):(n.forEach((C,R)=>{l+=C.text.replace(/[^\x00-\xff]/g,"**").length/2+1}),p=l*12+n.length*3*2+(n.length-1)*12+12*2),p}return V({tableRef:a,clearSelection(){var n;return(n=a==null?void 0:a.value)==null?void 0:n.clearSelection()},allSelection(){var n;return(n=a==null?void 0:a.value)==null?void 0:n.toggleAllSelection()},invertSelection(){var n;(n=h==null?void 0:h.value)==null||n.forEach((d,g)=>{var y;(y=a==null?void 0:a.value)==null||y.toggleRowSelection(d,!1)})}}),(n,d)=>{const g=j("BaseEmpty"),y=j("el-table"),e=ot("loading");return u.length?nt((B(),M(y,T({key:0,class:"query-table",data:n.rows,onSelectionChange:r,onScrollCapture:L(f)},W.value,{ref_key:"tableRef",ref:a}),ht({default:F(()=>[(B(!0),U(oe,null,ne(u,(l,p)=>(B(),M(Nt,{col:l,selection:n.selection,refreshList:n.refreshList,groupBtnsAttrs:n.groupBtnsAttrs,getGroupBtnsOfRow:k,onGroupBtn:K,disabled:n.disabled,key:p},{custom:F(({row:m,col:b,ind:C})=>[ee(n.$slots,"custom",st(lt({row:m,col:b,$index:C})),void 0,!0)]),_:2},1032,["col","selection","refreshList","groupBtnsAttrs","disabled"]))),128))]),_:2},[n.loading?void 0:{name:"empty",fn:F(()=>[q(g)]),key:"0"}]),1040,["data","onScrollCapture"])),[[e,n.loading]]):se("",!0)}}});const Yt=ue(Xt,[["__scopeId","data-v-18a65a44"]]),Zt=J({__name:"QueryFields",props:{modelValue:{default:()=>({})},field:{},size:{},className:{},inputDebounce:{type:Boolean}},emits:["update:modelValue","change"],setup(P,{emit:V}){const w=P,o=V;let s=Q({get(){return w.modelValue},set(c){o("update:modelValue",c)}});return(c,f)=>{const i=j("BaseFormItem"),S=j("el-col");return B(),M(S,{class:"query-fields"},{default:F(()=>[q(i,{style:{width:"100%"},className:c.className,field:c.field,inputDebounce:c.inputDebounce,size:c.size,onChange:f[0]||(f[0]=(a,h)=>o("change",a,h)),modelValue:L(s)[c.field.prop],"onUpdate:modelValue":f[1]||(f[1]=a=>L(s)[c.field.prop]=a)},{custom:F(({field:a})=>[ee(c.$slots,"custom",{field:a},void 0,!0)]),_:3},8,["className","field","inputDebounce","size","modelValue"])]),_:3})}}});const Oe=ue(Zt,[["__scopeId","data-v-626d6534"]]),Ne=J({__name:"QueryBtns",props:{isFold:{type:Boolean,default:!0},loading:{type:Boolean},showFoldBtn:{type:Boolean}},emits:["submit","reset","fold"],setup(P,{emit:V}){const w=V;return(o,s)=>{const c=j("BaseIcon"),f=j("el-button"),i=j("el-col"),S=ot("debounce");return B(),M(i,{class:"query-btns f-fe-fs"},{default:F(()=>[nt((B(),M(f,{type:"primary",disabled:o.loading},{icon:F(()=>[q(c,{class:ve({rotate:o.loading}),name:o.loading?"Loading":"Search"},null,8,["class","name"])]),default:F(()=>[ie("搜索")]),_:1},8,["disabled"])),[[S,()=>w("submit"),void 0,{immediate:!0}]]),q(f,{icon:L(yt),onClick:s[0]||(s[0]=a=>w("reset")),disabled:o.loading},{default:F(()=>[ie("重置")]),_:1},8,["icon","disabled"]),o.showFoldBtn?(B(),M(f,{key:0,onClick:s[1]||(s[1]=a=>w("fold")),text:"",type:"primary"},{icon:F(()=>[q(c,{name:"ArrowDown",class:ve({"rotate-180":!o.isFold,"icon-fold":!0})},null,8,["class"])]),default:F(()=>[ie(" "+Be(o.isFold?"展开":"折叠"),1)]),_:1})):se("",!0)]),_:1})}}}),en={class:"f-fs-fs"},tn={class:"sec-label f-0"},nn={class:"sec-fields f-fs-fs-w f-1"};var We,Ke,He;const on=J({__name:"Index",props:le({modelValue:{},fields:{},sections:{},loading:{type:Boolean},rowNum:{},extraParams:{},inputDebounce:{type:Boolean},colSpanAttrs:{},isCompact:{type:Boolean},noFieldsHide:{type:Boolean}},Object.assign({rowNum:2,fields:()=>[],modelValue:()=>me({}),noFieldsHide:!0},(He=(Ke=(We=ae)==null?void 0:We.BaseCrud)==null?void 0:Ke._components)==null?void 0:He.QueryForm)),emits:["update:modelValue","search","change","reset"],setup(P,{expose:V,emit:w}){const o=P,s=w;let c=!0;const f=tt(),i=D(),S=D(2),a=D(!0),h=D([]),u=D([]),E=f.size==="small",W=Q(()=>{if(!a.value)return;const{sections:e,rowNum:l}=o;return e?p=>{const m=u.value.length,b=p===m-1;return m<=l?S.value>1?S.value-(b?1:0):1:S.value-(p===l-1?1:0)}:S.value>1?S.value*l-1:1*l}),K=Q(()=>{const{sections:e,rowNum:l}=o;if(e){const p=u.value.map((b,C)=>{const R=C===u.value.length-1;return b.fields.length<=S.value-(R?1:0)?1:2});let m=0;for(let b=0;b<p.length;b++)if(m+=p[b],m>l)return!0;return!1}else return h.value.length>S.value*l-1}),r=Q({get(){return o.modelValue},set(e){s("update:modelValue",e)}});be(()=>o.fields,e=>{var C;if((C=o.sections)!=null&&C.length)return;const{modelValue:l}=o,p=$e(e,void 0,l),{data:m,fields:b}=p;h.value=b,Z.merge(r.value,m),s("change",r.value,c?!!l:!1),c=!1},{immediate:!0,deep:!0}),be(()=>o.sections,e=>{if(!e)return;const{modelValue:l}=o;u.value=(e==null?void 0:e.map(p=>{const{label:m,fields:b}=p,C=$e(b,void 0,l),{data:R,fields:H}=C;return p.fields=H,Z.merge(r.value,R),p}))??[],s("change",r.value,c?!!l:!1),c=!1},{immediate:!0,deep:!0}),bt("resize",()=>S.value=n(),!0);function k(){return a.value?(S.value>1?o.rowNum:o.rowNum+1)*(E?28:40)+"px":"35vh"}function A(){const{fields:e,isCompact:l,sections:p}=o;let m=1;if(p){const b=p.map((C,R)=>we(C.fields,E?.5:l?1:void 0));m=Math.max(...b)}else m=we(e,E?.5:l?1:void 0);return Object.assign({labelWidth:m+"em"},xt)}function n(){const{colSpanAttrs:e}=o,l={},p=Bt();for(const m in e)l[m]=24/e[m];return l[p]}function d(e){const{colSpanAttrs:l}=o,{span:p,type:m}=e;return p?{span:p}:l}function g(){const e=i.value;e&&e.validate((l,p)=>{if(l){const{extraParams:m}=o;s("search",Z.merge({},m,r.value))}else{const m=Object.values(p)[0][0];_t.error(m.message)}})}function y(){var e;(e=i.value)==null||e.resetFields(),s("reset")}return V({formRef:i,getFields(){var e;return(e=o.sections)!=null&&e.length?u.value.map(l=>l.fields).flat(1):h.value}}),(e,l)=>{const p=j("el-form");return!e.noFieldsHide||h.value.length||u.value.length?(B(),M(p,T({key:0,class:["query-form",{compact:e.isCompact,small:E}],model:r.value},A(),{ref_key:"formRef",ref:i}),{default:F(()=>[u.value.length?(B(),U("div",{key:0,class:"all-hide-scroll wrap-box",style:Fe({maxHeight:k()})},[(B(!0),U(oe,null,ne(u.value.slice(0,a.value?e.rowNum:void 0),(m,b)=>{var C;return B(),U("div",en,[ze("div",tn,Be(m.label),1),ze("div",nn,[(B(!0),U(oe,null,ne(m.fields.slice(0,(C=W.value)==null?void 0:C.call(W,b)),(R,H)=>(B(),M(Oe,T({modelValue:r.value,"onUpdate:modelValue":l[0]||(l[0]=X=>r.value=X),field:R,className:E?"mb-qtr":"mb-half",inputDebounce:e.inputDebounce,size:L(f).size,onChange:l[1]||(l[1]=(X,fe)=>s("change",{[X]:fe}))},d(R),{key:H}),{custom:F(({field:X})=>[ee(e.$slots,"custom",{field:X,form:r.value},void 0,!0)]),_:2},1040,["modelValue","field","className","inputDebounce","size"]))),128)),(u.value.length<=e.rowNum?b===u.value.length-1:a.value?b===e.rowNum-1:b===u.value.length-1)?(B(),M(Ne,T({key:0},e.colSpanAttrs,{class:[E?"mb-qtr":"mb-half","fold-col"],small:E,loading:e.loading,isFold:a.value,showFoldBtn:K.value,onSubmit:g,onFold:l[2]||(l[2]=R=>a.value=!a.value),onReset:y}),null,16,["class","loading","isFold","showFoldBtn"])):se("",!0)])])}),256))],4)):(B(),U("div",{key:1,class:"f-fs-fs-w wrap-box all-hide-scroll",style:Fe({maxHeight:k()})},[(B(!0),U(oe,null,ne(h.value.slice(0,W.value),(m,b)=>(B(),M(Oe,T({modelValue:r.value,"onUpdate:modelValue":l[3]||(l[3]=C=>r.value=C),field:m,className:E?"mb-qtr":"mb-half",inputDebounce:e.inputDebounce,size:L(f).size,onChange:l[4]||(l[4]=(C,R)=>s("change",{[C]:R}))},d(m),{key:b}),{custom:F(({field:C})=>[ee(e.$slots,"custom",{field:C,form:r.value},void 0,!0)]),_:2},1040,["modelValue","field","className","inputDebounce","size"]))),128)),q(Ne,T(e.colSpanAttrs,{class:[E?"mb-qtr":"mb-half","fold-col"],loading:e.loading,isFold:a.value,showFoldBtn:K.value,onSubmit:g,onFold:l[5]||(l[5]=m=>a.value=!a.value),onReset:y}),null,16,["class","loading","isFold","showFoldBtn"])],4))]),_:3},16,["class","model"])):se("",!0)}}});const sn=ue(on,[["__scopeId","data-v-c953ad22"]]);var Ge,Je,Xe;const ln=J({__name:"Pagination",props:le({currPage:{},pageSize:{},total:{},pageSizes:{}},Object.assign({pageSize:10,currPage:1,pageSizes:()=>[10,20,30,50,100]},(Xe=(Je=(Ge=ae)==null?void 0:Ge.BaseCrud)==null?void 0:Je._components)==null?void 0:Xe.Pagination)),emits:["update:currPage","update:pageSize","update:sizeChange","update:currentChange"],setup(P,{emit:V}){const w=P,o=V,s=Q({get:()=>w.currPage,set:f=>o("update:currPage",f)}),c=Q({get:()=>w.pageSize,set:f=>o("update:pageSize",f)});return(f,i)=>{const S=j("el-pagination");return B(),M(S,T({class:"f-c-c mt-h f-0",currentPage:s.value,"onUpdate:currentPage":i[0]||(i[0]=a=>s.value=a),pageSize:c.value,"onUpdate:pageSize":i[1]||(i[1]=a=>c.value=a),total:f.total,pageSizes:f.pageSizes,onSizeChange:i[2]||(i[2]=a=>o("update:sizeChange",a)),onCurrentChange:i[3]||(i[3]=a=>o("update:currentChange",a))},L(Lt)),null,16,["currentPage","pageSize","total","pageSizes"])}}});var Ye,Ze;const an=J({__name:"Index",props:le({modelValue:{},rowKey:{},formAttrs:{},tableAttrs:{},pageAttrs:{},disabled:{type:Boolean},groupBtnsAttrs:{},pagination:{type:[Boolean,Object]},fields:{},sections:{},cols:{},selectAll:{type:Boolean},fetch:{},fetchSuccess:{type:Function},fetchFail:{type:Function},immediate:{type:Boolean},extraBtns:{},groupBtns:{type:[Array,Function]},reqMap:{},resMap:{},showPagination:{type:Boolean},summaryList:{type:[Boolean,Function]},sort:{type:Boolean},index:{type:Boolean},selection:{type:Boolean},batchBtn:{type:Boolean},exportLimit:{},extraParams:{},log:{type:Boolean},debug:{type:Boolean},isOmit:{type:Boolean},changeFetch:{type:Boolean},inputDebounce:{type:Boolean},filterByAuth:{type:Function},colSpanAttrs:{},isCompact:{type:Boolean},size:{},rowNum:{},handleReq:{type:Function},handleRes:{type:Function}},Object.assign({rowKey:"id",log:!St,fields:()=>[],cols:()=>[],immediate:!0,changeFetch:!0,batchBtn:!1,isOmit:!0,inputDebounce:!0,exportLimit:1e4,pagination:()=>({currPage:1,pageSize:20}),reqMap:Ct,resMap:wt,showPagination:!0,colSpanAttrs:zt,isCompact:P=>P.colSpanAttrs.xl<6,filterByAuth:P=>!0},(Ze=(Ye=ae)==null?void 0:Ye.BaseCrud)==null?void 0:Ze.Index)),emits:["update:modelValue","extraBtn","groupBtn","selectionChange","rows"],setup(P,{expose:V,emit:w}){const o=D([]),s=P,c=w,f=et("closePopup"),i=D(null),S=D(null),a=D(null),h=D(null),{reqMap:u,resMap:E,extraParams:W={}}=s,K=s.pagination?{[`${u.curr_page}`]:s.pagination.currPage,[`${u.page_size}`]:s.pagination.pageSize}:{},r={...K,...W},k=me(Z.cloneDeep(K)),A=me({total:0,hasMore:!0}),n=D(!1),d=D([]),g=D([]);let y=Q({get(){return s.modelValue},set(t){c("update:modelValue",t)}}),e=Z.cloneDeep(r);const l=Q(()=>{const{extraBtns:t,disabled:v}=s,$=(t==null?void 0:t.map(_=>{var I;const z=at(_),{name:N,attrs:O,customRules:x}=z;return(I=Ve)!=null&&I.includes(N)&&(z.popconfirm=!1,x?O.disabled=!A.total:O.disabled=!g.value.length),v&&(O.disabled=v),z}))||[];return Se($)}),p=Q(()=>!!l.value.find(t=>Ve.includes(t.name)&&!t.customRules)),m=Q(()=>s.selection||p.value),b=D(s.cols.slice());be(()=>s.extraParams,t=>{Z.merge(e,t),Y(e)},{deep:!0}),Ft(()=>{});function C(){Object.assign(k,K),e=Z.cloneDeep(r),Y(e)}function R(t){Object.assign(e,{[`${u.curr_page}`]:1}),Y(e)}function H(t){Object.assign(e,{[`${u.curr_page}`]:1,[`${u.page_size}`]:t}),Y(e)}function X(t){Object.assign(e,{[`${u.curr_page}`]:t}),Y(e)}function fe(t,v){const{immediate:$,changeFetch:_}=s;if(t=Vt(t),v)Z.merge(e,t),Object.assign(r,e);else{if(!_)return;Object.assign(e,t,{[`${u.curr_page}`]:1})}$&&Y(e)}function Y(t=e,v){const{fetch:$,handleReq:_,isOmit:z,handleRes:N,selectAll:O,summaryList:x,fetchSuccess:I,fetchFail:re,log:pe}=s;$&&(n.value=!0,_&&(t=_(t)),z&&(t=Pe(t)),pe&&ke(t,"req"),$(t).then(G=>{if(!G)return;N&&(G=N(G));let te=G[E.records];if(!te){console.error("响应数据不是标准的分页数据结构，请自测：",G);return}pe&&ke(te,"res");const ge=t[u.curr_page];if(x){const he=ye(x),Ce=d.value;if(he==="Boolean")d.value=ge===1?te:[...Ce,...te];else if(he==="Function")d.value=x(ge,Ce,te);else throw new Error(`暂未处理此种类型：${he}`)}else d.value=te;Object.assign(A,{total:G[E.total_num],hasMore:G[E.has_more]}),Object.assign(k,{[u.curr_page]:ge,[u.page_size]:t[u.page_size]}),O&&(g.value=te),I==null||I(G),c("rows",d.value,t),v==null||v()}).catch(G=>{re==null||re(G)}).finally(()=>{n.value=!1}))}function rt(t){const{rowKey:v,exportLimit:$}=s,{text:_}=t;Tt({btnObj:t,cols:o.value,seledRows:g.value,seledKeys:g.value.map(z=>z[v]),total:A.total,exportLimit:$,emits:c,next:(z=`${_||"操作"}成功`,N,O,x=!0)=>{$t(z),f(N),x&&ce(),m.value&&i.value.clearSelection(),O==null||O()}})}function _e(t,v,$,_=!0){const{name:z,text:N}=t;c("groupBtn",z,v,(O,x,I)=>{$(O,x,I),_&&ce()})}function it(t,v){g.value=t,c("selectionChange",t,v)}function Se(t=[]){const{filterByAuth:v}=s;return v?t.filter(({auth:$})=>$!=null&&$.length?v($):!0):t}function ce(t){Y(e,t)}return V({refreshList:ce,getList:Y,getQueryParams(t=s.isOmit){return t?Pe(e):e},getQueryFields(t=[u.curr_page,u.page_size]){const v=[],$=[],_=S.value.getFields();_.forEach(z=>{var N;(N=z.prop)!=null&&N.includes(Ae)&&$.push(z.prop)});for(const z in e)if(t&&!t.includes(z)){const N=_.find(O=>O.prop===z);if(N){const O=e[z];!Pt.includes(O)&&(ye(O)!=="Array"||O.some(I=>I!==""))&&v.push({label:N.label,value:qt(N,O)})}}return $.forEach(z=>{const[N,O]=z.split(Ae),x=e[N],I=e[O],re=_.find(pe=>pe.prop.includes(z));re&&(x||I)&&v.push({label:re.label,value:[x,I].join(At)})}),v}}),(t,v)=>{var $;return B(),U("div",{class:"base-crud f-fs-s-c",ref_key:"baseCrudRef",ref:h},[q(sn,T({class:["f-0",t.size==="small"?"mb-6":"mb-h"],modelValue:L(y),"onUpdate:modelValue":v[0]||(v[0]=_=>kt(y)?y.value=_:y=_),disabled:t.disabled,fields:t.fields,sections:t.sections,loading:n.value,inputDebounce:t.inputDebounce,colSpanAttrs:t.colSpanAttrs,isCompact:t.isCompact,onReset:C,onSearch:R,onChange:fe,size:t.size,rowNum:t.rowNum},t.formAttrs,{ref_key:"queryFormRef",ref:S}),{custom:F(({field:_,form:z})=>[ee(t.$slots,_.prop,{field:_,form:z},void 0,!0)]),_:3},16,["class","modelValue","disabled","fields","sections","loading","inputDebounce","colSpanAttrs","isCompact","size","rowNum"]),ee(t.$slots,"middle",{},void 0,!0),l.value.length?(B(),M(Jt,{key:0,class:"f-0",columns:b.value,allColumns:o.value,btns:l.value,isEmpty:!(($=d.value)!=null&&$.length),"onUpdate:cols":v[1]||(v[1]=_=>{b.value=_}),onClick:rt,total:A.total,batchBtn:t.batchBtn&&t.selection,size:t.size,ref_key:"extraBtnsRef",ref:a},null,8,["columns","allColumns","btns","isEmpty","total","batchBtn","size"])):se("",!0),ee(t.$slots,"default",{loading:n.value,rows:d.value,total:A.total,hasMore:A.hasMore,params:L(e),onGroupBtn:_e},()=>[q(Yt,T({groupBtnsAttrs:t.groupBtnsAttrs,loading:n.value,cols:b.value,rows:d.value,total:A.total,sort:t.sort,index:t.index,selection:m.value,groupBtns:t.groupBtns,currPage:t.pagination?k[L(u).curr_page]:1,pageSize:t.pagination?k[L(u).page_size]:20,filterBtnsByAuth:Se,refreshList:ce,onGroupBtn:_e,onSelectionChange:it,"onUpdate:cols":v[2]||(v[2]=_=>{o.value=_}),disabled:t.disabled},t.tableAttrs,{size:t.size,ref_key:"queryTableRef",ref:i}),{custom:F(({row:_,col:z,$index:N})=>[ee(t.$slots,z.prop,st(lt({row:_,col:z,$index:N})),void 0,!0)]),_:3},16,["groupBtnsAttrs","loading","cols","rows","total","sort","index","selection","groupBtns","currPage","pageSize","disabled","size"])],!0),t.pagination&&t.showPagination?(B(),M(ln,T({key:1},t.pageAttrs,{currPage:k[L(u).curr_page],"onUpdate:currPage":v[3]||(v[3]=_=>k[L(u).curr_page]=_),pageSize:k[L(u).page_size],"onUpdate:pageSize":v[4]||(v[4]=_=>k[L(u).page_size]=_),total:A.total,onSizeChange:H,onCurrentChange:X,small:t.size==="small"}),null,16,["currPage","pageSize","total","small"])):se("",!0)],512)}}});const gn=ue(an,[["__scopeId","data-v-8c9bee4f"]]);export{gn as default};

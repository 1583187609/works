var e,t;import{M as a,ak as s,c5 as o,c6 as n,c9 as r,aa as u,aM as l,aK as i,b_ as p,q as c,aR as m,aS as g,aE as d,u as _,I as v,bx as f,aQ as y,am as B,bc as h,af as b,s as j,t as x,bz as $,F as S,aP as A,cg as w,ce as P,ca as k,cf as z,bH as F}from"./index-050c1617.js";import{_ as I}from"./Index.vue_vue_type_script_setup_true_lang-ea962dba.js";import M from"./Index-5c65fe41.js";import{_ as D}from"./Pagination.vue_vue_type_script_setup_true_lang-81e58ff8.js";import{b as C}from"./_config-0a862e30.js";import{g as G}from"./index-605a54c6.js";import O from"./AvatarItem-4b874f33.js";import V from"./AboutItem-bd0e2b0e.js";import q from"./FaceItem-e0eb6032.js";import K from"./PhotoItem-982fc7fe.js";import{a as L}from"./_utils-7ca22de1.js";import{b as R,a as E,h as U}from"./_utils-181b344e.js";import"./SetTable.vue_vue_type_script_setup_true_lang-91ae7ef9.js";import"./BaseTable-1312f7af.js";import"./Column.vue_vue_type_script_name_Column_setup_true_lang-ee0cdc53.js";import"./GroupBtns-72c692b1.js";import"./cascader-daf6f425.js";import"./BaseRender.vue_vue_type_script_setup_true_lang-e9b7b22d.js";import"./_utils-0baae99f.js";import"./SetPrint-9cca4432.js";import"./BatchBtns.vue_vue_type_script_setup_true_lang-ba720868.js";import"./QueryFields-3e16080e.js";import"./QueryBtns.vue_vue_type_style_index_0_lang-b13b55da.js";import"./_utils-775776d1.js";import"./_config-c0994392.js";import"./BarsImg-94d5036c.js";const Q={class:"card-crud f-fs-s-c"},T={class:"list-box f-fs-fs-w f-1"},W="status",Y=F(a({__name:"IndexOld",props:s({modelValue:{},formAttrs:{},pageAttrs:{},pagination:{type:[Boolean,Object]},type:{},rowKey:{},fields:{},fetch:{},fetchSuccess:{},fetchFail:{type:Function},groupBtns:{type:[Array,Function]},immediate:{type:Boolean},extraBtns:{},reqMap:{},resMap:{},batchBtn:{type:Boolean},extraParams:{},log:{type:Boolean},debug:{type:Boolean},isOmit:{type:Boolean},exportLimit:{},changeFetch:{type:Boolean},inputDebounce:{type:Boolean},filterByAuth:{type:Function},colSpanAttrs:{},compact:{type:Boolean}},Object.assign({fields:()=>[],immediate:!0,type:"avatar-audit",changeFetch:!0,batchBtn:!1,log:!o,isOmit:!0,inputDebounce:!0,exportLimit:1e4,pageAttrs:()=>({pageSizes:[10,15,20,25,30]}),pagination:()=>({currPage:1,pageSize:15}),rowKey:"id",reqMap:n,resMap:n,filterByAuth:e=>!0,colSpanAttrs:C,compact:e=>e.colSpanAttrs.xl<6},null==(t=null==(e=r)?void 0:e.BaseCrud)?void 0:t.Index)),emits:["update:modelValue","extraBtn","groupBtn","selectionChange"],setup(e,{expose:t,emit:a}){const s=u("closePopup"),o=e,n=a,r=l(null),{immediate:F,exportLimit:C,pagination:Y,fetch:H,fetchSuccess:X,fetchFail:Z,extraParams:J,log:N,debug:ee}=o;let{reqMap:te,resMap:ae}=o;const se=Y?{[`${te.curr_page}`]:Y.currPage,[`${te.page_size}`]:Y.pageSize}:{},oe={...se,...J},ne=i(p.cloneDeep(se)),re=l(!1),ue=l([]);let le=c({get:()=>o.modelValue,set(e){n("update:modelValue",e)}});const ie=c((()=>{var e;return(null==(e=ue.value)?void 0:e.filter(((e,t)=>2===e[W])))??[]})),pe=c((()=>ie.value.map((e=>e[o.rowKey])))),ce=c((()=>ue.value.map(((e,t)=>e[W]))));let me=l(0),ge=p.cloneDeep(oe);const de=c((()=>{var e;return!(null==(e=ue.value)?void 0:e.length)})),_e=c((()=>{var e;return(null==(e=o.extraBtns)?void 0:e.map((e=>{var t,a;const s=G(e);return(null==(t=R)?void 0:t.includes(s.name))&&(s.popconfirm=!1,s.attrs.disabled=!(null==(a=ie.value)?void 0:a.length)),s})))||[]}));function ve(e,t){const{groupBtns:a}=o;return Se(E(e,t,a))}function fe(e){const{text:t}=e;U({btnObj:e,seledRows:ie.value,seledKeys:pe.value,total:me.value,exportLimit:C,emits:n,next:(e=`${t||"操作"}成功`,a,o)=>{w(e),s(a),Ae(),null==o||o()}})}function ye(e,t){const{name:a,text:o}=e,{$index:r}=t;n("groupBtn",a,t,((e=`${o||"操作"}成功！`,t,n)=>{w(e),s(t);Ae([r,{pass:0,reject:1}[a]]),null==n||n()}),ge)}function Be(){p.merge(ne,se),ge=p.cloneDeep(oe),$e(ge)}function he(e){ge=p.merge({},ge,{[`${te.curr_page}`]:1}),ne[te.curr_page]=1,$e(ge)}function be(e){ne[te.curr_page]=1,p.merge(ge,{[`${te.curr_page}`]:1,[`${te.page_size}`]:e}),$e(ge)}function je(e){ne[te.curr_page]=e,ge=p.merge({},ge,{[`${te.curr_page}`]:e}),$e(ge)}function xe(e,t){if(e=P(e),t)p.merge(ge,e),Object.assign(oe,ge);else{if(!o.changeFetch)return;Object.assign(ge,e,{[`${te.curr_page}`]:1}),ne[te.curr_page]=1}F&&$e(ge)}function $e(e=ge,t){H&&(re.value=!0,o.isOmit&&(e=k(e)),(N||ee)&&(z(e,"req"),ee)||H(e).then((e=>{const a=e[ae.records];N&&z(a,"res"),me.value=e[ae.total_num],ue.value=a,null==X||X(e),null==t||t()})).catch((e=>{null==Z||Z(e)})).finally((()=>{re.value=!1})))}function Se(e=[]){const{filterByAuth:t}=o;return t?e.filter((({auth:e})=>!(null==e?void 0:e.length)||t(e))):e}function Ae(e,t){var a;const{type:s}=o;if("avatar-audit"===s){if(e){const[t,a]=e;ue.value[t][W]=a}!(null==(a=ue.value.filter((e=>2===e[W])))?void 0:a.length)&&$e(ge,t)}else $e(ge,t)}return t({refreshList:Ae}),(e,t)=>{var a,s;const o=m("BaseEmpty"),n=g("loading");return d(),_("div",Q,[v(M,B({class:"f-0"},e.formAttrs,{fields:e.fields,modelValue:h(le),"onUpdate:modelValue":t[0]||(t[0]=e=>b(le)?le.value=e:le=e),loading:re.value,inputDebounce:e.inputDebounce,colSpanAttrs:e.colSpanAttrs,compact:e.compact,onReset:Be,onSearch:he,onChange:xe}),{custom:f((({field:t,form:a})=>[y(e.$slots,t.prop,{field:t,formData:a},void 0,!0)])),_:3},16,["fields","modelValue","loading","inputDebounce","colSpanAttrs","compact"]),y(e.$slots,"middle",{},void 0,!0),(null==(a=_e.value)?void 0:a.length)?(d(),j(I,B({key:0,class:"mb-h f-0",btns:Se(_e.value),isEmpty:de.value,onClick:fe,total:h(me),toolBtns:[]},r.value),null,16,["btns","isEmpty","total"])):x("",!0),$((d(),_("div",T,[(d(!0),_(S,null,A(ue.value,((t,a)=>(d(),_(S,{key:a},[["avatar-audit","avatar-patrol"].includes(e.type)?(d(),j(O,{key:0,class:"item",row:h(L)({...t,$index:a}),withMask:"avatar-audit"===e.type&&[2,""].includes(h(le).status),status:ce.value[a],groupBtns:ve(t,a),onGroupBtn:e=>ye(e,{...t,$index:a}),isPatrol:"avatar-patrol"===e.type},null,8,["row","withMask","status","groupBtns","onGroupBtn","isPatrol"])):"about"===e.type?(d(),j(V,{key:1,class:"item",row:{...t,$index:a},status:ce.value[a],groupBtns:ve(t,a),onGroupBtn:e=>ye(e,{...t,$index:a}),bottomBar:1===ce.value[a]?t.reason||"~原因为空~":""},null,8,["row","status","groupBtns","onGroupBtn","bottomBar"])):"face"===e.type?(d(),j(q,{key:2,class:"item",row:{...t,$index:a},status:ce.value[a],groupBtns:ve(t,a),onGroupBtn:e=>ye(e,{...t,$index:a}),bottomBar:1===ce.value[a]?t.rejectReason||"~原因为空~":""},null,8,["row","status","groupBtns","onGroupBtn","bottomBar"])):"photo"===e.type?(d(),j(K,{key:3,class:"item",row:{...t,$index:a},status:ce.value[a],groupBtns:ve(t,a),onGroupBtn:e=>ye(e,{...t,$index:a})},null,8,["row","status","groupBtns","onGroupBtn"])):x("",!0)],64)))),128)),re.value||(null==(s=ue.value)?void 0:s.length)?x("",!0):(d(),j(o,{key:0}))])),[[n,re.value]]),h(Y)?(d(),j(D,B({key:1},e.pageAttrs,{currPage:ne[h(te).curr_page],"onUpdate:currPage":t[1]||(t[1]=e=>ne[h(te).curr_page]=e),pageSize:ne[h(te).page_size],"onUpdate:pageSize":t[2]||(t[2]=e=>ne[h(te).page_size]=e),total:h(me),onSizeChange:be,onCurrentChange:je}),null,16,["currPage","pageSize","total"])):x("",!0)])}}}),[["__scopeId","data-v-d6501c63"]]);export{Y as default};

var e,t,s;import"./dayjs-21617033.js";import{A as o,c as r,t as n,B as a,C as l,_ as i}from"./index-8cf28f90.js";import"./lodash-8dc1f9dc.js";import{bf as p,d as u,bd as c,a2 as m,e as d,_ as j,w as h,j as g,Q as f,o as y,O as v,aa as _,P as B,L as b,u as x,S,ah as w,ap as A,V as C,c as k,a8 as z,I as F,ac as L,ad as $,F as E}from"./@vue-022d9836.js";import"./nprogress-b5e58671.js";import{_ as M}from"./Column.vue_vue_type_script_name_Column_setup_true_lang-92dec00d.js";import{n as O,a as R}from"./_utils-c39af746.js";import{g as T,a as q}from"./_utils-e8eebd93.js";import{d as G}from"./_config-0a862e30.js";import"./call-bind-ada3a9fc.js";import"./get-intrinsic-176af07e.js";import"./es-errors-c8ed318b.js";import"./has-symbols-456daba2.js";import"./has-proto-c2a23985.js";import"./function-bind-afbcd6f2.js";import"./hasown-c3b72c9b.js";import"./set-function-length-968dc075.js";import"./define-data-property-9d7bf764.js";import"./es-define-property-c2edbfb6.js";import"./gopd-16a4ddf0.js";import"./has-property-descriptors-52e43c9d.js";import"./xlsx-c1bdd32b.js";import"./element-plus-6dad9269.js";import"./lodash-es-d4f5f48c.js";import"./@vueuse-c70f8764.js";import"./@element-plus-91223246.js";import"./@popperjs-b78c3215.js";import"./@ctrl-91de2ec7.js";import"./async-validator-cf877c1f.js";import"./memoize-one-63ab667a.js";import"./normalize-wheel-es-3222b0a2.js";import"./@floating-ui-3c499e77.js";import"./qs-fd29a741.js";import"./side-channel-5a41c40a.js";import"./object-inspect-0d550a97.js";import"./axios-86de682d.js";import"./pinia-f80f4126.js";import"./mock-ada1f893.js";import"./mockjs-217213d3.js";import"./vue-router-e17d6507.js";import"./vite-plugin-mock-6db8ade2.js";import"./path-to-regexp-83a43451.js";import"./GroupBtns-dfbc2150.js";import"./index-0a44dd7a.js";import"./UserInfo-6031a43f.js";import"./cascader-082fe68e.js";import"./BaseRender.vue_vue_type_script_setup_true_lang-100cb175.js";const Q=i(u({name:"QueryTable",__name:"QueryTable",props:c({tableAttrs:{},groupBtnsAttrs:{},loading:{type:Boolean},cols:{},rows:{},groupBtns:{type:[Array,Function]},sort:{type:Boolean},index:{type:Boolean},disabled:{type:Boolean},selection:{type:Boolean},showSummary:{type:Boolean},currPage:{},pageSize:{},refreshList:{type:Function},summaryMethod:{type:Function},filterBtnsByAuth:{type:Function}},Object.assign({cols:()=>[],rows:()=>[],summaryMethod:o},null==(s=null==(t=null==(e=r)?void 0:e.BaseCrud)?void 0:t._components)?void 0:s.QueryTable)),emits:["update:cols","selectionChange","groupBtn","change"],setup(e,{expose:t,emit:s}){const o=e,r=s,i=m(),{handleScroll:u}=(()=>{let e=null,t=0;return p((()=>{null==e||e.scrollTo(0,t)})),{handleScroll:function(s,o){let r=s.target;if(o&&(r=r.querySelector(o)),!r)return;const{scrollTop:n}=r;!e&&(e=r),t=n}}})();let c=0,Q=o.showSummary?2:1;const I=d(null),N=d([]),P=j([]);h((()=>{const{cols:e,currPage:t,pageSize:s}=o,a=T(t,s),{index:l,sort:p,selection:u,operate:c}=a;O("index",o)&&e.unshift(l),O("sort",o)&&e.unshift(p),O("selection",o)&&e.unshift(u),O("operate",o)&&e.push(c);const m=e.map((e=>{if("Object"!==n(e))return 1;const{col:t,level:s}=q(e,1,a,"small"===i.size);return P.push(t),s})),d=Math.max(...m);Q+=d-1,r("update:cols",P)}))();const V=g((()=>{const{showSummary:e,summaryMethod:t}=o;return Object.assign({maxHeight:`calc(100% + ${40*Q}px)`,cellClassName(e){if("$sort"===e.column.property)return"sort-cell"}},G,{showSummary:e,summaryMethod:t})}));function W(e,{row:t,col:s,$index:o},n){r("groupBtn",e,{$index:o,...t},n)}function D(e){N.value=e;const t=e.map((e=>e[V.value.rowKey]));r("selectionChange",e,t)}function H(e,t){const{groupBtns:s=[],rows:r,filterBtnsByAuth:n}=o,a=n(R(e,t,s)),l=J(a);return c<l&&(c=l,P.slice(-1)[0].minWidth=c),c<30&&t===r.length-1&&(c=J(),P.slice(-1)[0].minWidth=c),a}function J(e){if(!e)return 66;let t=0,s=0;const{groupBtnsAttrs:r={}}=o,{vertical:n,maxNum:i=l}=r;return e.length>i&&(e=e.slice(0,i-1).concat([{text:"更多"}])),n?e.forEach((e=>{t=a(e.text)+1;const o=12*t+6+24;o>s&&(s=o)})):(e.forEach((e=>{t+=a(e.text)+1})),s=12*t+3*e.length*2+12*(e.length-1)+24),s}return t({tableRef:I,clearSelection(){var e;return null==(e=null==I?void 0:I.value)?void 0:e.clearSelection()},allSelection(){var e;return null==(e=null==I?void 0:I.value)?void 0:e.toggleAllSelection()},invertSelection(){var e;null==(e=null==N?void 0:N.value)||e.forEach(((e,t)=>{var s;null==(s=null==I?void 0:I.value)||s.toggleRowSelection(e,!1)}))}}),(e,t)=>{const s=w("BaseEmpty"),o=w("el-table"),r=A("loading");return P.length?f((y(),v(o,b({key:0,class:"query-table",data:e.rows,onSelectionChange:D,onScrollCapture:x(u)},V.value,{ref_key:"tableRef",ref:I}),_({default:B((()=>[(y(!0),k(E,null,z(P,((t,s)=>(y(),v(M,{col:t,selection:e.selection,refreshList:e.refreshList,groupBtnsAttrs:e.groupBtnsAttrs,getGroupBtnsOfRow:H,onGroupBtn:W,disabled:e.disabled,key:s},{custom:B((({row:t,col:s,ind:o})=>[F(e.$slots,"custom",L($({row:t,col:s,$index:o})),void 0,!0)])),_:2},1032,["col","selection","refreshList","groupBtnsAttrs","disabled"])))),128))])),_:2},[e.loading?void 0:{name:"empty",fn:B((()=>[C(s)])),key:"0"}]),1040,["data","onScrollCapture"])),[[r,e.loading]]):S("",!0)}}}),[["__scopeId","data-v-90fa350c"]]);export{Q as default};

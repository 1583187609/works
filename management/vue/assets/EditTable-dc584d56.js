import{M as e,aa as a,aM as l,aK as t,b_ as s,bs as o,aR as d,aS as i,aE as n,s as u,bx as r,am as c,I as p,u as f,F as m,aP as b,ap as v,A as y,v as x,t as k,H as h,b3 as g,aQ as _,bc as w,cP as $,bz as B,ao as P,cJ as j,bN as q,bH as C}from"./index-050c1617.js";import{d as R,b as T}from"./_config-0a862e30.js";const A={key:0,class:"required"},E={key:1,class:"f-c-c"},I={key:2,class:"f-c-c f-0 pt-h pb-h",style:{width:"100%"}},V=C(e({__name:"EditTable",props:{cols:{default:()=>[]},rows:{default:()=>[]},footer:{type:Boolean,default:!0},text:{type:Boolean,default:!1},request:{},total:{},currPage:{},pageSize:{},pageAttrs:{},submitText:{default:"提交"},resetText:{default:"重置"},index:{type:Boolean},extraParams:{},autoAddRow:{type:Boolean,default:!1},submitCb:{}},emits:["submit","update:rows"],setup(e,{expose:C,emit:V}){const F=e,H=V,O=a("closePopup"),z=l(null),M=l(!1),S=l(F.rows),{extraParams:U,submitText:J,submitCb:K,index:L,cols:N}=F,Q=t(s.merge({maxHeight:"calc(100% + 36px)"},R));L&&(N.slice(0,2).find((e=>"index"===e.type))||N.unshift({prop:"$index",label:"序号",type:"index",fixed:"left",width:58,index:1}));const D=t(N.map((e=>{const{type:a}=(null==e?void 0:e.field)||{};let l={};return"operate"===a&&(l={prop:"$operate",fixed:"right",width:80}),e=s.merge(l,T,e)})));function G(e,a){const{field:l,label:t,prop:s="",...o}=e,d=`${a}[${s}]`;return l.prop=d,l}o(S,((e=[])=>{if(!e.length&&F.autoAddRow){if(!Object.values(e.slice(-1)[0]).every((e=>""===e))){const a={};Object.keys(e.slice(-1)[0]).forEach((e=>{a[e]=""})),e.push(a)}}H("update:rows",e)}),{immediate:!0,deep:!0});const W=()=>{const e=z.value;e&&e.validate(((e,a)=>{if(e){const e=S.value.slice(0,-1);(null==F?void 0:F.request)?(M.value=!0,F.request(e).then((e=>{q.success(J+"成功"),K?K():O()})).finally((()=>{M.value=!1}))):H("submit",e)}else{const e=Object.values(a)[0][0];q.error(e.message)}}))},X=()=>{const e=z.value;e&&e.resetFields()};return C({formRef:z}),(e,a)=>{const l=d("el-button"),t=d("BaseFormItem"),s=d("el-table-column"),o=d("BaseEmpty"),q=d("el-table"),C=d("BaseIcon"),R=d("el-form"),T=i("debounce");return n(),u(R,{ref_key:"formRef",ref:z,class:"edit-table f-fs-s-c",model:S.value},{default:r((()=>[D.length?(n(),u(q,c({key:0,data:S.value},Q,{class:"table"}),{empty:r((()=>[p(o)])),default:r((()=>[(n(!0),f(m,null,b(D,((a,o)=>(n(),u(s,v(c({key:o},a)),y({header:r((({row:e,colum:l,$index:t})=>[x("span",null,[a.required?(n(),f("span",A,"*")):k("",!0),h(" "+g(a.label),1)])])),_:2},[a.field?{name:"default",fn:r((({row:s,column:o,$index:d})=>{var i,p;return["custom"===(null==(i=null==a?void 0:a.field)?void 0:i.type)?_(e.$slots,a.prop,v(c({key:0},{row:s,col:a,$index:d})),void 0,!0):"operate"===(null==(p=null==a?void 0:a.field)?void 0:p.type)?(n(),f(m,{key:1},[d<S.value.length-1?(n(),u(l,{key:0,icon:w($),type:"danger",link:"",onClick:e=>{return a=d,void S.value.splice(a,1);var a}},{default:r((()=>[h("删除")])),_:2},1032,["icon","onClick"])):(n(),f(m,{key:1},[h("-")],64))],64)):(n(),u(t,{key:2,field:G(a,d),modelValue:s[a.prop],"onUpdate:modelValue":e=>s[a.prop]=e},null,8,["field","modelValue","onUpdate:modelValue"]))]})),key:"0"}:void 0]),1040)))),128))])),_:3},16,["data"])):(n(),f("div",E,"空空如也~")),!e.text&&e.footer?(n(),f("div",I,[B((n(),u(l,{type:"primary",disabled:M.value},{icon:r((()=>[p(C,{class:P({rotate:M.value}),name:M.value?"Loading":"Promotion"},null,8,["class","name"])])),default:r((()=>[h(" "+g(w(J)),1)])),_:1},8,["disabled"])),[[T,W,void 0,{immediate:!0}]]),p(l,{icon:w(j),onClick:X,disabled:M.value},{default:r((()=>[h(g(e.resetText),1)])),_:1},8,["icon","disabled"])])):k("",!0)])),_:3},8,["model"])}}}),[["__scopeId","data-v-c7366af1"]]);export{V as default};

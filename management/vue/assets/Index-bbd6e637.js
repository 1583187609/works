import{M as Be,ak as ve,c3 as Ce,c4 as ze,c5 as Pe,c6 as we,c7 as Ae,aM as d,aK as J,c8 as w,q as M,bs as Re,ax as Se,c9 as G,ca as H,cb as Fe,c2 as W,cc as Me,u as Oe,I as X,bx as Y,am as D,bc as b,af as $e,aQ as O,s as Z,t as ee,cd as je,ce as te,cf as qe,aa as _e,aE as I,ap as ke,a3 as Ee,bH as Le}from"./index-346f95fe.js";import{_ as Ve}from"./Index.vue_vue_type_script_setup_true_lang-f55d7293.js";import De from"./QueryTable-9209cc1d.js";import Ie from"./Index-90bef514.js";import{g as Ke}from"./index-6d0323cd.js";import{_ as Ne}from"./Pagination.vue_vue_type_script_setup_true_lang-01fa1961.js";import{g as Qe,h as xe,b as ae}from"./_utils-aee21659.js";import"./SetTable.vue_vue_type_script_setup_true_lang-33a097b7.js";import"./BaseTable-25ca9d4f.js";import"./Column.vue_vue_type_script_name_Column_setup_true_lang-c479b511.js";import"./GroupBtns-9cd08886.js";import"./cascader-cbb71516.js";import"./BaseRender.vue_vue_type_script_setup_true_lang-9d3c192b.js";import"./_utils-a8d3f342.js";import"./_config-a971499b.js";import"./SetPrint-6f6cb011.js";import"./BatchBtns.vue_vue_type_script_setup_true_lang-d34dfe55.js";import"./QueryFields-7db98284.js";import"./QueryBtns.vue_vue_type_script_setup_true_lang-42b46820.js";import"./_utils-e1c645e6.js";import"./_config-c76f4e31.js";var oe,se;const Ue=Be({__name:"Index",props:ve({modelValue:{},rowKey:{},formAttrs:{},tableAttrs:{},pageAttrs:{},disabled:{type:Boolean},groupBtnsAttrs:{},pagination:{type:[Boolean,Object]},fields:{},sections:{},cols:{},selectAll:{type:Boolean},fetch:{},fetchSuccess:{type:Function},fetchFail:{type:Function},immediate:{type:Boolean},extraBtns:{},groupBtns:{type:[Array,Function]},reqMap:{},resMap:{},showPagination:{type:Boolean},summaryList:{type:[Boolean,Function]},sort:{type:Boolean},index:{type:Boolean},selection:{type:Boolean},batchBtn:{type:Boolean},exportLimit:{},extraParams:{},log:{type:Boolean},debug:{type:Boolean},isOmit:{type:Boolean},changeFetch:{type:Boolean},inputDebounce:{type:Boolean},filterByAuth:{type:Function},colSpanAttrs:{},isCompact:{type:Boolean},size:{},rowNum:{},handleReq:{type:Function},handleRes:{type:Function}},Object.assign({rowKey:"id",log:!Ce,fields:()=>[],cols:()=>[],immediate:!0,changeFetch:!0,batchBtn:!1,isOmit:!0,inputDebounce:!0,exportLimit:1e4,pagination:()=>({currPage:1,pageSize:20}),reqMap:ze,resMap:Pe,showPagination:!0,colSpanAttrs:we,isCompact:A=>A.colSpanAttrs.xl<6,filterByAuth:A=>!0},(se=(oe=Ae)==null?void 0:oe.BaseCrud)==null?void 0:se.Index)),emits:["update:modelValue","extraBtn","groupBtn","selectionChange","rows"],setup(A,{expose:ne,emit:re}){const $=d([]),u=A,C=re,le=_e("closePopup"),K=d(null),N=d(null),ie=d(null),ue=d(null),{reqMap:l,resMap:j,extraParams:pe={}}=u,q=u.pagination?{[`${l.curr_page}`]:u.pagination.currPage,[`${l.page_size}`]:u.pagination.pageSize}:{},_={...q,...pe},f=J(w.cloneDeep(q)),g=J({total:0,hasMore:!0}),z=d(!1),y=d([]),P=d([]);let R=M({get(){return u.modelValue},set(e){C("update:modelValue",e)}}),s=w.cloneDeep(_);const k=M(()=>{const{extraBtns:e,disabled:t}=u,n=(e==null?void 0:e.map(a=>{var c;const o=Ke(a),{name:i,attrs:r,customRules:p}=o;return(c=ae)!=null&&c.includes(i)&&(o.popconfirm=!1,p?r.disabled=!g.total:r.disabled=!P.value.length),t&&(r.disabled=t),o}))||[];return U(n)}),ce=M(()=>!!k.value.find(e=>ae.includes(e.name)&&!e.customRules)),Q=M(()=>u.selection||ce.value),E=d(u.cols.slice());Re(()=>u.extraParams,e=>{w.merge(s,e),h(s)},{deep:!0}),Se(()=>{});function me(){Object.assign(f,q),s=w.cloneDeep(_),h(s)}function de(e){Object.assign(s,{[`${l.curr_page}`]:1}),h(s)}function fe(e){Object.assign(s,{[`${l.curr_page}`]:1,[`${l.page_size}`]:e}),h(s)}function ge(e){Object.assign(s,{[`${l.curr_page}`]:e}),h(s)}function ye(e,t){const{immediate:n,changeFetch:a}=u;if(e=je(e),t)w.merge(s,e),Object.assign(_,s);else{if(!a)return;Object.assign(s,e,{[`${l.curr_page}`]:1})}n&&h(s)}function h(e=s,t){const{fetch:n,handleReq:a,isOmit:o,handleRes:i,selectAll:r,summaryList:p,fetchSuccess:c,fetchFail:v,log:F}=u;n&&(z.value=!0,a&&(e=a(e)),o&&(e=G(e)),F&&te(e,"req"),n(e).then(m=>{if(!m)return;i&&(m=i(m));let B=m[j.records];if(!B){console.error("响应数据不是标准的分页数据结构，请自测：",m);return}F&&te(B,"res");const L=e[l.curr_page];if(p){const V=W(p),T=y.value;if(V==="Boolean")y.value=L===1?B:[...T,...B];else if(V==="Function")y.value=p(L,T,B);else throw new Error(`暂未处理此种类型：${V}`)}else y.value=B;Object.assign(g,{total:m[j.total_num],hasMore:m[j.has_more]}),Object.assign(f,{[l.curr_page]:L,[l.page_size]:e[l.page_size]}),r&&(P.value=B),c==null||c(m),C("rows",y.value,e),t==null||t()}).catch(m=>{v==null||v(m)}).finally(()=>{z.value=!1}))}function he(e){const{rowKey:t,exportLimit:n}=u,{text:a}=e;xe({btnObj:e,cols:$.value,seledRows:P.value,seledKeys:P.value.map(o=>o[t]),total:g.total,exportLimit:n,emits:C,next:(o=`${a||"操作"}成功`,i,r,p=!0)=>{qe(o),le(i),p&&S(),Q.value&&K.value.clearSelection(),r==null||r()}})}function x(e,t,n,a=!0){const{name:o,text:i}=e;C("groupBtn",o,t,(r,p,c)=>{n(r,p,c),a&&S()})}function be(e,t){P.value=e,C("selectionChange",e,t)}function U(e=[]){const{filterByAuth:t}=u;return t?e.filter(({auth:n})=>n!=null&&n.length?t(n):!0):e}function S(e){h(s,e)}return ne({refreshList:S,getList:h,getQueryParams(e=u.isOmit){return e?G(s):s},getQueryFields(e=[l.curr_page,l.page_size]){const t=[],n=[],a=N.value.getFields();a.forEach(o=>{var i;(i=o.prop)!=null&&i.includes(H)&&n.push(o.prop)});for(const o in s)if(e&&!e.includes(o)){const i=a.find(r=>r.prop===o);if(i){const r=s[o];!Fe.includes(r)&&(W(r)!=="Array"||r.some(c=>c!==""))&&t.push({label:i.label,value:Qe(i,r)})}}return n.forEach(o=>{const[i,r]=o.split(H),p=s[i],c=s[r],v=a.find(F=>F.prop.includes(o));v&&(p||c)&&t.push({label:v.label,value:[p,c].join(Me)})}),t}}),(e,t)=>{var n;return I(),Oe("div",{class:"base-crud f-fs-s-c",ref_key:"baseCrudRef",ref:ue},[X(Ie,D({class:["f-0",e.size==="small"?"mb-6":"mb-h"],modelValue:b(R),"onUpdate:modelValue":t[0]||(t[0]=a=>$e(R)?R.value=a:R=a),disabled:e.disabled,fields:e.fields,sections:e.sections,loading:z.value,inputDebounce:e.inputDebounce,colSpanAttrs:e.colSpanAttrs,isCompact:e.isCompact,onReset:me,onSearch:de,onChange:ye,size:e.size,rowNum:e.rowNum},e.formAttrs,{ref_key:"queryFormRef",ref:N}),{custom:Y(({field:a,form:o})=>[O(e.$slots,a.prop,{field:a,form:o},void 0,!0)]),_:3},16,["class","modelValue","disabled","fields","sections","loading","inputDebounce","colSpanAttrs","isCompact","size","rowNum"]),O(e.$slots,"middle",{},void 0,!0),k.value.length?(I(),Z(Ve,{key:0,class:"f-0",columns:E.value,allColumns:$.value,btns:k.value,isEmpty:!((n=y.value)!=null&&n.length),"onUpdate:cols":t[1]||(t[1]=a=>{E.value=a}),onClick:he,total:g.total,batchBtn:e.batchBtn&&e.selection,size:e.size,ref_key:"extraBtnsRef",ref:ie},null,8,["columns","allColumns","btns","isEmpty","total","batchBtn","size"])):ee("",!0),O(e.$slots,"default",{loading:z.value,rows:y.value,total:g.total,hasMore:g.hasMore,params:b(s),onGroupBtn:x},()=>[X(De,D({groupBtnsAttrs:e.groupBtnsAttrs,loading:z.value,cols:E.value,rows:y.value,total:g.total,sort:e.sort,index:e.index,selection:Q.value,groupBtns:e.groupBtns,currPage:e.pagination?f[b(l).curr_page]:1,pageSize:e.pagination?f[b(l).page_size]:20,filterBtnsByAuth:U,refreshList:S,onGroupBtn:x,onSelectionChange:be,"onUpdate:cols":t[2]||(t[2]=a=>{$.value=a}),disabled:e.disabled},e.tableAttrs,{size:e.size,ref_key:"queryTableRef",ref:K}),{custom:Y(({row:a,col:o,$index:i})=>[O(e.$slots,o.prop,ke(Ee({row:a,col:o,$index:i})),void 0,!0)]),_:3},16,["groupBtnsAttrs","loading","cols","rows","total","sort","index","selection","groupBtns","currPage","pageSize","disabled","size"])],!0),e.pagination&&e.showPagination?(I(),Z(Ne,D({key:1},e.pageAttrs,{currPage:f[b(l).curr_page],"onUpdate:currPage":t[3]||(t[3]=a=>f[b(l).curr_page]=a),pageSize:f[b(l).page_size],"onUpdate:pageSize":t[4]||(t[4]=a=>f[b(l).page_size]=a),total:g.total,onSizeChange:fe,onCurrentChange:ge,small:e.size==="small"}),null,16,["currPage","pageSize","total","small"])):ee("",!0)],512)}}});const dt=Le(Ue,[["__scopeId","data-v-ebfb2e6d"]]);export{dt as default};

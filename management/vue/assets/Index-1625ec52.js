var e,l,a;import{M as s,ak as o,aK as t,c8 as n,bd as u,aM as i,q as c,bs as r,bZ as d,bL as m,cC as v,s as f,bx as p,am as g,bA as h,t as b,cp as y,aR as _,aE as F,u as w,F as x,aP as N,v as V,b3 as B,bc as j,aQ as k,aq as z,I as q,bN as D,bH as S}from"./index-f41eb58a.js";import A from"./QueryFields-6ed704cf.js";import{_ as H}from"./QueryBtns.vue_vue_type_style_index_0_lang-40031a64.js";import{h as R}from"./_utils-79770003.js";import{d as C}from"./_config-c0994392.js";const Q={class:"f-fs-fs"},I={class:"sec-label f-0"},M={class:"sec-fields f-fs-fs-w f-1"},O=S(s({__name:"Index",props:o({modelValue:{},fields:{},sections:{},loading:{type:Boolean},rowNum:{},extraParams:{},inputDebounce:{type:Boolean},colSpanAttrs:{},compact:{type:Boolean},noFieldsHide:{type:Boolean}},Object.assign({rowNum:2,fields:()=>[],modelValue:()=>t({}),noFieldsHide:!0},null==(a=null==(l=null==(e=n)?void 0:e.BaseCrud)?void 0:l._components)?void 0:a.QueryForm)),emits:["update:modelValue","search","change","reset"],setup(e,{expose:l,emit:a}){var s;const o=e,t=a;let n=!0;const S=u(),O=i(),P=i(2),K=i(!0),U=i([]),$=i([]),E="small"===S.size,L=c((()=>{if(!K.value)return;const{sections:e,rowNum:l}=o;return e?e=>{const a=$.value.length,s=e===a-1;return a<=l?P.value>1?P.value-(s?1:0):1:P.value-(e===l-1?1:0)}:P.value>1?P.value*l-1:1*l})),W=c((()=>{const{sections:e,rowNum:l}=o;if(e){const e=$.value.map(((e,l)=>{const a=l===$.value.length-1;return e.fields.length<=P.value-(a?1:0)?1:2}));let a=0;for(let s=0;s<e.length;s++)if(a+=e[s],a>l)return!0;return!1}return U.value.length>P.value*l-1})),Z=c({get:()=>o.modelValue,set(e){t("update:modelValue",e)}});function G(){if(!K.value)return"35vh";return(P.value>1?o.rowNum:o.rowNum+1)*(E?28:40)+"px"}function J(e){const{colSpanAttrs:l}=o,{span:a,type:s}=e;return a?{span:a}:l}function T(){const e=O.value;e&&e.validate(((e,l)=>{if(e){const{extraParams:e}=o;t("search",d.merge({},e,Z.value))}else{const e=Object.values(l)[0][0];D.error(e.message)}}))}function X(){var e;null==(e=O.value)||e.resetFields(),t("reset")}return r((()=>o.fields),(e=>{var l;if(null==(l=o.sections)?void 0:l.length)return;const{modelValue:a}=o,s=R(e,void 0,a),{data:u,fields:i}=s;U.value=i,d.merge(Z.value,u),t("change",Z.value,!!n&&!!a),n=!1}),{immediate:!0,deep:!0,once:!!(null==(s=null==o?void 0:o.sections)?void 0:s.length)}),r((()=>o.sections),(e=>{if(!e)return;const{modelValue:l}=o;$.value=(null==e?void 0:e.map((e=>{const{label:a,fields:s}=e,o=R(s,void 0,l),{data:t,fields:n}=o;return e.fields=n,d.merge(Z.value,t),e})))??[],t("change",Z.value,!!n&&!!l),n=!1}),{immediate:!0,deep:!0,once:!o.sections}),m("resize",(()=>P.value=function(){const{colSpanAttrs:e}=o,l={},a=v();for(const s in e)l[s]=24/e[s];return l[a]}()),!0),l({formRef:O,getFields(){var e;return(null==(e=o.sections)?void 0:e.length)?$.value.map((e=>e.fields)).flat(1):U.value}}),(e,l)=>{const a=_("el-form");return!e.noFieldsHide||U.value.length||$.value.length?(F(),f(a,g({key:0,class:["query-form",{compact:e.compact,small:E}],model:Z.value},function(){const{fields:e,compact:l,sections:a}=o;let s=1;if(a){const e=a.map((e=>y(e.fields,E?.5:l?1:void 0)));s=Math.max(...e)}else s=y(e,E?.5:l?1:void 0);return Object.assign({labelWidth:s+"em"},C)}(),{onKeyup:h(T,["enter"]),ref_key:"formRef",ref:O}),{default:p((()=>[$.value.length?(F(),w("div",{key:0,class:"all-hide-scroll wrap-box",style:z({maxHeight:G()})},[(F(!0),w(x,null,N($.value.slice(0,K.value?e.rowNum:void 0),((a,s)=>{var o;return F(),w("div",Q,[V("div",I,B(a.label),1),V("div",M,[(F(!0),w(x,null,N(a.fields.slice(0,null==(o=L.value)?void 0:o.call(L,s)),((a,s)=>(F(),f(A,g({modelValue:Z.value,"onUpdate:modelValue":l[0]||(l[0]=e=>Z.value=e),field:a,className:E?"mb-qtr":"mb-half",inputDebounce:e.inputDebounce,size:j(S).size,onChange:l[1]||(l[1]=(e,l)=>t("change",{[e]:l}))},J(a),{key:s}),{custom:p((({field:l})=>[k(e.$slots,"custom",{field:l,form:Z.value},void 0,!0)])),_:2},1040,["modelValue","field","className","inputDebounce","size"])))),128)),($.value.length<=e.rowNum?s===$.value.length-1:K.value?s===e.rowNum-1:s===$.value.length-1)?(F(),f(H,g({key:0,class:[E?"mb-qtr":"mb-half"],small:E,compact:e.compact,loading:e.loading,isFold:K.value,showFoldBtn:W.value,onSubmit:T,onFold:l[2]||(l[2]=e=>K.value=!K.value),onReset:X},e.colSpanAttrs),null,16,["class","compact","loading","isFold","showFoldBtn"])):b("",!0)])])})),256))],4)):(F(),w("div",{key:1,class:"f-fs-fs-w wrap-box all-hide-scroll",style:z({maxHeight:G()})},[(F(!0),w(x,null,N(U.value.slice(0,L.value),((a,s)=>(F(),f(A,g({modelValue:Z.value,"onUpdate:modelValue":l[3]||(l[3]=e=>Z.value=e),field:a,className:E?"mb-qtr":"mb-half",inputDebounce:e.inputDebounce,size:j(S).size,onChange:l[4]||(l[4]=(e,l)=>t("change",{[e]:l}))},J(a),{key:s}),{custom:p((({field:l})=>[k(e.$slots,"custom",{field:l,form:Z.value},void 0,!0)])),_:2},1040,["modelValue","field","className","inputDebounce","size"])))),128)),q(H,g({class:[E?"mb-qtr":"mb-half"],small:E,compact:e.compact,loading:e.loading,isFold:K.value,showFoldBtn:W.value,onSubmit:T,onFold:l[5]||(l[5]=e=>K.value=!K.value),onReset:X},e.colSpanAttrs),null,16,["class","compact","loading","isFold","showFoldBtn"])],4))])),_:3},16,["class","model"])):b("",!0)}}}),[["__scopeId","data-v-3d692fbf"]]);export{O as default};

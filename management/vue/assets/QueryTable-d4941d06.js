var e,t,s;import{ar as o,M as a,ak as n,cA as l,c9 as r,bd as u,aM as i,aK as c,bt as p,q as d,bz as m,s as g,A as h,bx as f,am as y,bc as v,t as _,aR as B,aS as b,aE as S,I as x,u as w,aP as j,aQ as A,ap as C,a3 as M,F as R,c4 as $,cB as k,cC as E,bH as F}from"./index-050c1617.js";import{_ as z}from"./Column.vue_vue_type_script_name_Column_setup_true_lang-ee0cdc53.js";import{n as L,a as O}from"./_utils-181b344e.js";import{g as T,a as q}from"./_utils-0baae99f.js";import{d as G}from"./_config-0a862e30.js";import"./GroupBtns-72c692b1.js";import"./index-605a54c6.js";import"./cascader-daf6f425.js";import"./BaseRender.vue_vue_type_script_setup_true_lang-e9b7b22d.js";const P=F(a({__name:"QueryTable",props:n({tableAttrs:{},groupBtnsAttrs:{},loading:{type:Boolean},cols:{},rows:{},groupBtns:{type:[Array,Function]},sort:{type:Boolean},index:{type:Boolean},disabled:{type:Boolean},selection:{type:Boolean},showSummary:{type:Boolean},currPage:{},pageSize:{},refreshList:{type:Function},summaryMethod:{type:Function},filterBtnsByAuth:{type:Function}},Object.assign({cols:()=>[],rows:()=>[],summaryMethod:l},null==(s=null==(t=null==(e=r)?void 0:e.BaseCrud)?void 0:t._components)?void 0:s.QueryTable)),emits:["update:cols","selectionChange","groupBtn","change"],setup(e,{expose:t,emit:s}){const a=e,n=s,l=u(),{handleScroll:r}=(()=>{let e=null,t=0;return o((()=>{null==e||e.scrollTo(0,t)})),{handleScroll:function(s,o){let a=s.target;if(o&&(a=a.querySelector(o)),!a)return;const{scrollTop:n}=a;!e&&(e=a),t=n}}})();let F=0,P=a.showSummary?2:1;const Q=i(null),W=i([]),H=c([]);p((()=>{const{cols:e,currPage:t,pageSize:s}=a,o=T(t,s),{index:r,sort:u,selection:i,operate:c}=o;L("index",a)&&e.unshift(r),L("sort",a)&&e.unshift(u),L("selection",a)&&e.unshift(i),L("operate",a)&&e.push(c);const p=e.map((e=>{if("Object"!==$(e))return 1;const{col:t,level:s}=q(e,1,o,"small"===l.size);return H.push(t),s})),d=Math.max(...p);P+=d-1,n("update:cols",H)}))();const I=d((()=>{const{showSummary:e,summaryMethod:t}=a;return Object.assign({maxHeight:`calc(100% + ${40*P}px)`},G,{showSummary:e,summaryMethod:t})}));function K(e,{row:t,col:s,$index:o},a){n("groupBtn",e,{$index:o,...t},a)}function N(e){W.value=e;const t=e.map((e=>e[I.value.rowKey]));n("selectionChange",e,t)}function V(e,t){const{groupBtns:s=[],rows:o,filterBtnsByAuth:n}=a,l=O(e,t,s),r=X(l);return F<r&&(F=r,H.slice(-1)[0].minWidth=F),t===o.length-1&&F<30&&(F=X(),H.slice(-1)[0].minWidth=F),n(l)}function X(e){if(!e){return 66}let t=0,s=0;const{groupBtnsAttrs:o={}}=a,{vertical:n,maxNum:l=E}=o;return e.length>l&&(e=e.slice(0,l-1).concat([{text:"更多"}])),n?e.forEach((e=>{t=k(e.text)+1;const o=12*t+6+24;o>s&&(s=o)})):(e.forEach((e=>{t+=k(e.text)+1})),s=12*t+3*e.length*2+12*(e.length-1)+24),s}return t({tableRef:Q,clearSelection(){var e;return null==(e=null==Q?void 0:Q.value)?void 0:e.clearSelection()},allSelection(){var e;return null==(e=null==Q?void 0:Q.value)?void 0:e.toggleAllSelection()},invertSelection(){var e;null==(e=null==W?void 0:W.value)||e.forEach(((e,t)=>{var s;null==(s=null==Q?void 0:Q.value)||s.toggleRowSelection(e,!1)}))}}),(e,t)=>{const s=B("BaseEmpty"),o=B("el-table"),a=b("loading");return H.length?m((S(),g(o,y({key:0,class:"query-table",data:e.rows,onSelectionChange:N,onScrollCapture:v(r)},I.value,{ref_key:"tableRef",ref:Q}),h({default:f((()=>[(S(!0),w(R,null,j(H,((t,s)=>(S(),g(z,{col:t,selection:e.selection,refreshList:e.refreshList,groupBtnsAttrs:e.groupBtnsAttrs,getGroupBtnsOfRow:V,onGroupBtn:K,disabled:e.disabled,key:s},{custom:f((({row:t,col:s,ind:o})=>[A(e.$slots,"custom",C(M({row:t,col:s,$index:o})),void 0,!0)])),_:2},1032,["col","selection","refreshList","groupBtnsAttrs","disabled"])))),128))])),_:2},[e.loading?void 0:{name:"empty",fn:f((()=>[x(s)])),key:"0"}]),1040,["data","onScrollCapture"])),[[a,e.loading]]):_("",!0)}}}),[["__scopeId","data-v-c9cd8beb"]]);export{P as default};

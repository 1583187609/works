import{c0 as P,bJ as k,bO as w,bK as n,c1 as U,bP as V,M as q,aa as B,bI as $,aM as I,aK as H,q as T,aR as S,aE as z,u as E,v,b3 as F,bc as i,I as m,bx as g,af as O,H as x,c2 as D,bH as G}from"./index-0bf49a0e.js";import{a as C,b as K,G as j}from"./user-77be9afe.js";import{_ as A}from"./FindPassword.vue_vue_type_script_setup_true_lang-62b51e6e.js";import{_ as J}from"./Register.vue_vue_type_script_setup_true_lang-700fe6b1.js";import Q from"./Captcha-dfd2a0f0.js";import{p as W}from"./package-bccd9f55.js";const X=P("user",()=>{const f=k(),u=w();async function _(p){const{user:a,navs:d}=p;return C(p).then(async r=>{var t;n.setItem("token",(a==null?void 0:a.token)??""),n.setItem("userInfo",a),n.setItem("allNavs",d.filter(h=>h.path!=="demo")),await u.initMap(),f.push("/"),U({type:"success",title:"登录成功",duration:2e3,dangerouslyUseHTMLString:!0,message:`欢迎回来，<b>${(t=V(a))==null?void 0:t._title}</b>`})})}async function b(p=f.currentRoute.value.fullPath){K().then(()=>{n.removeItem("token"),n.removeItem("userInfo"),n.removeItem("allNavs"),u.clearMap()})}return{login:_,logout:b}}),Y={class:"wrap f-c-c"},Z={class:"bounce-in login-box"},ee={class:"head f-c-c"},te={class:"foot f-sb-c"},oe=q({__name:"index",setup(f){const u=B("openPopup");X();const _=w(),b=k(),p=$(),a=I(!1),d=I([]),r=n.getItem("store_account");let t=H({phone:(r==null?void 0:r.phone)??"superAdmin_1",psd:(r==null?void 0:r.psd)??"superAdmin123456",captcha:"",remember:!!r});const h=T(()=>[{prop:"phone",label:"账号",valid:/^\d/.test(t.phone)?"phone":void 0,required:!0,type:"autocomplete",attrs:{placeholder:"请输入账号 / 手机号",autocomplete:"off",onSelect:N,fetchSuggestions:R}},{prop:"psd",label:"密码",valid:"password",required:!0,attrs:{type:"password",autocomplete:"off"}},{prop:"captcha",label:"验证码",type:"custom",required:!0},{prop:"remember",label:"记住我",type:"checkbox"}]);L();function L(){j().then(l=>{d.value=l.map(e=>{const{account:o,...c}=e;return{value:o,...c}})})}function M(l){const{remember:e,...o}=l;a.value=!0,e?n.setItem("store_account",{phone:o.phone,psd:o.psd}):n.removeItem("store_account"),C(o).then(c=>{var y;D(c),_.initMap();const s=((y=p.query.redirect)==null?void 0:y.toString())??"/";b.push(s),U({type:"success",title:"登录成功",duration:2e3,dangerouslyUseHTMLString:!0,message:`欢迎回来，<b>${V()._title}</b>`})}).finally(()=>{a.value=!1})}function R(l,e){let o=d.value;l&&(o=d.value.filter(c=>s=>s.value.toLowerCase().indexOf(c.toLowerCase())===0)),e(o)}function N(l){t.psd=l.psd}return(l,e)=>{const o=S("BaseForm"),c=S("el-button");return z(),E("div",Y,[v("div",Z,[v("h1",ee,F(i(W).name),1),m(o,{class:"body",modelValue:i(t),"onUpdate:modelValue":e[1]||(e[1]=s=>O(t)?t.value=s:t=s),size:"large",loading:a.value,fields:h.value,onSubmit:M,submitText:"登录",ref:"formRef"},{captcha:g(()=>[m(Q,{modelValue:i(t).captcha,"onUpdate:modelValue":e[0]||(e[0]=s=>i(t).captcha=s),prop:"captcha"},null,8,["modelValue"])]),_:1},8,["modelValue","loading","fields"]),v("div",te,[m(c,{onClick:e[2]||(e[2]=s=>i(u)({title:"免费注册",direction:"ltr"},J,"drawer")),class:"btn",type:"info",size:"small",link:""},{default:g(()=>[x(" 免费注册 ")]),_:1}),m(c,{onClick:e[3]||(e[3]=s=>i(u)("找回密码",A,"drawer")),class:"btn",type:"info",size:"small",link:""},{default:g(()=>[x(" 找回密码 ")]),_:1})])])])}}});const ie=G(oe,[["__scopeId","data-v-fd3dc40f"]]);export{ie as default};

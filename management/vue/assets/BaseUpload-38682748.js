var e;import{M as a,ak as s,c8 as l,aM as t,cq as i,cn as o,q as c,u as n,I as r,bx as u,ao as d,b3 as p,t as v,bN as m,aR as f,bf as h,co as g,aE as b,F as w,s as y,bC as z,bc as k,aI as F,aF as S,v as B,bH as I}from"./index-31bd5f7b.js";const j={class:"base-upload"},$={key:0,class:"f-c-c-c upload-err-mask"},x=(e=>(F("data-v-47efca98"),e=e(),S(),e))((()=>B("div",null,"上传失败",-1))),L={key:0,class:"tips"},R=I(a({__name:"BaseUpload",props:s({modelValue:{},size:{},fit:{},showFileList:{type:Boolean},drag:{type:Boolean},accept:{},limitSize:{},headers:{},action:{},showTips:{type:Boolean},handleSuccessResponse:{type:Function}},Object.assign({size:100,fit:"cover",showFileList:!1,showTips:!0,accept:"image/png,image/jpg,image/jpeg",limitSize:10485760},null==(e=l)?void 0:e.BaseUpload)),emits:["update:modelValue","change"],setup(e,{emit:a}){h((e=>({"0ca550ec":k(I)})));const s=e,l=a,F=t(0),{formItem:S}=g(),B=t(i().value),I=o(s.size),R=t(""),_=c({get:()=>s.modelValue||"",set(e){l("update:modelValue",e),null==S||S.validate("blur")}}),C=c((()=>{const{accept:e,limitSize:a}=s;return`仅支持${O(e)}，不超过${P(a)}`})),M=e=>{const{limitSize:a,accept:l}=s,{type:t,size:i}=e,o=function(e,a){let s="";const l=e.split(",");l.includes(a)||(s=`仅支持上传${O(e)}格式的图片`);return s}(l,t)||function(e,a){return a>e?`图片大小不能超过${P(e)}`:""}(a,i);return!o||(m.error(o),!1)},U=e=>{const{loaded:a,total:s}=e;F.value=Math.floor(a/s*100)},V=(e,a)=>{s.handleSuccessResponse(e,a).then((e=>{_.value=e,l("change",e)})).catch((e=>{m.error(e)}))},T=(e,a,s)=>{m.error("文件上传失败"),R.value=URL.createObjectURL(a.raw)};function q(){B.value||(_.value="")}function O(e){return e.split(",").map((e=>e.split("/")[1])).join("，")}function P(e){let a=e/1024,s="";return a<1024?s=`${a.toFixed(1)}kb`:(a/=1024,s=`${a.toFixed(1)}Mb`),s}return(e,a)=>{const s=f("BaseIcon"),l=f("BaseImg"),t=f("el-progress"),i=f("el-upload");return b(),n("div",j,[r(i,{class:d(["upload f-c-c",{disabled:B.value}]),action:e.action,"show-file-list":e.showFileList,"before-upload":M,"on-progress":U,"on-success":V,"on-error":T,headers:e.headers},{default:u((()=>[R.value?(b(),n("div",$,[r(s,{size:"26",name:"Picture"}),x])):v("",!0),_.value||R.value?(b(),n(w,{key:1},[B.value||R.value?v("",!0):(b(),y(s,{key:0,onClick:z(q,["stop"]),class:d(["icon-del",{disabled:B.value}]),size:"24",name:"CircleCloseFilled"},null,8,["class"])),r(l,{class:"img",src:_.value||R.value,fit:e.fit,preview:B.value},null,8,["src","fit","preview"])],64)):(b(),n(w,{key:2},[F.value>0&&F.value<100?(b(),y(t,{key:0,type:"circle",width:.8*parseInt(e.size.toString()),percentage:F.value,"stroke-width":4},null,8,["width","percentage"])):(b(),y(s,{key:1,class:"icon-add",size:parseFloat(k(I).toString())/4,name:"Plus"},null,8,["size"]))],64))])),_:1},8,["class","action","show-file-list","headers"]),e.showTips?(b(),n("div",L,p(C.value),1)):v("",!0)])}}}),[["__scopeId","data-v-47efca98"]]);export{R as default};
